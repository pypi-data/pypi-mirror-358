var Lt=Object.defineProperty;var Vt=(a,t,e)=>t in a?Lt(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e;var k=(a,t,e)=>Vt(a,typeof t!="symbol"?t+"":t,e);import{j as Pt,k as Ut,m as Rt,n as Wt,o as qt,C as et,p as ht,q as Ot,s as Bt}from"../chunks/Dg9aec3R.mjs";import{aB as Kt,aC as Nt,aD as xt,T as at,aE as Yt,aF as Jt,aG as Qt,aH as Xt,aI as Zt,aJ as te,aK as ee,aL as ae,aM as le,aN as se,aO as oe,aP as re,aQ as ie,aR as ne,aS as ue,aT as de,aU as ce,aV as pe,aW as Tt,aX as me,aY as ve,aZ as ge,a_ as fe,a$ as $e,b0 as he,b1 as be,b2 as ye,b3 as _e,b4 as ke,J as wt}from"../chunks/uloFpcoK.mjs";import{w as mt,r as St}from"../chunks/CAXUivPC.mjs";import{c as ot}from"../chunks/DOfr5EWW.mjs";import{i as pt,S as Ce}from"../chunks/BQL56UQq.mjs";import"../chunks/Bg9kRutz.mjs";import{i as Q}from"../chunks/DTpo0kgr.mjs";import{p as X,l as yt,a as jt,f as R,t as W,b as F,c as p,g as u,d as Z,i as x,n as q,r as S,V as M,m as Y,s as J,T as _t,K as C,e as kt,al as E,h as rt}from"../chunks/DvQPdglG.mjs";import{p as D,i as Ct}from"../chunks/jy7gnWqU.mjs";import{R as ut,e as vt,i as gt}from"../chunks/BN8ot3Mp.mjs";import{I as Ne}from"../chunks/DBB41Fwi.mjs";import{a as Ie}from"../chunks/BYtXoaoj.mjs";import{s as dt,d as B,a as A,b as Ft,m as zt}from"../chunks/B2Ge_TJA.mjs";import{T as It}from"../chunks/DfsVf2Y0.mjs";import{s as z}from"../chunks/DWmaQdPb.mjs";import{C as ft}from"../chunks/kTG67CLb.mjs";import{H as G,a as At}from"../chunks/KuQ1EX1Y.mjs";import{E as nt,a as K,S as Pe,C as Oe,R as Te}from"../chunks/C1F3eHdt.mjs";import{W as we}from"../chunks/xxJToNBY.mjs";import{T as Se}from"../chunks/B5OF-950.mjs";function Mt(){}function tt(a){return a.notetype.case==="globalNotetype"?a.notetype.value:null}function bt(a){return a.deck.case==="deckId"?a.deck.value:null}class Me{constructor(t,e,l,s){k(this,"path");k(this,"deckNameIds");k(this,"notetypeNameIds");k(this,"defaultDelimiter");k(this,"defaultIsHtml");k(this,"defaultNotetypeId");k(this,"defaultDeckId");k(this,"metadata");k(this,"globalNotetype");k(this,"deckId");k(this,"fieldNames");k(this,"columnOptions");k(this,"lastMetadata");k(this,"lastGlobalNotetype");k(this,"lastDeckId");k(this,"fieldNamesSetter",Mt);k(this,"columnOptionsSetter",Mt);var i;this.path=t,this.deckNameIds=l.entries,this.notetypeNameIds=e.entries,this.lastMetadata=ot(s),this.metadata=mt(s),this.metadata.subscribe(this.onMetadataChanged.bind(this));const o=tt(s);this.lastGlobalNotetype=ot(tt(s)),this.globalNotetype=mt(ot(o)),this.globalNotetype.subscribe(this.onGlobalNotetypeChanged.bind(this)),this.lastDeckId=bt(s),this.deckId=mt(bt(s)),this.deckId.subscribe(this.onDeckIdChanged.bind(this)),this.fieldNames=St(o===null?Promise.resolve([]):Pt({ntid:o.id}).then(r=>r.vals),r=>{this.fieldNamesSetter=r}),this.columnOptions=St(Dt(s),r=>{this.columnOptionsSetter=r}),this.defaultDelimiter=s.delimiter,this.defaultIsHtml=s.isHtml,this.defaultNotetypeId=((i=this.lastGlobalNotetype)==null?void 0:i.id)||null,this.defaultDeckId=this.lastDeckId}doImport(){return Ut({path:this.path,metadata:{...this.lastMetadata,preview:[]}},{alertOnError:!1})}async onMetadataChanged(t){var s,o,i;if(pt(t,this.lastMetadata))return;const e=this.shouldRefetchMetadata(t);if(e){const{globalTags:r,updatedTags:v}=t;t=await Rt({path:this.path,delimiter:t.delimiter,notetypeId:(s=tt(t))==null?void 0:s.id,deckId:(o=bt(t))!=null?o:void 0,isHtml:t.isHtml}),t.globalTags=r,t.updatedTags=v}const l=tt(t);this.globalNotetype.set(l),l!==null&&l.id!==((i=tt(this.lastMetadata))==null?void 0:i.id)&&this.fieldNamesSetter(Pt({ntid:l.id}).then(r=>r.vals)),this.shouldRebuildColumnOptions(t)&&this.columnOptionsSetter(Dt(t)),this.lastMetadata=ot(t),e&&this.metadata.set(t)}shouldRefetchMetadata(t){var e,l;return t.delimiter!==this.lastMetadata.delimiter||t.isHtml!==this.lastMetadata.isHtml||((e=tt(t))==null?void 0:e.id)!==((l=tt(this.lastMetadata))==null?void 0:l.id)}shouldRebuildColumnOptions(t){return!pt(t.columnLabels,this.lastMetadata.columnLabels)||!pt(t.preview[0],this.lastMetadata.preview[0])}onGlobalNotetypeChanged(t){pt(t,this.lastGlobalNotetype)||(this.lastGlobalNotetype=ot(t),t!==null&&this.metadata.update(e=>(e.notetype.value=t,e)))}onDeckIdChanged(t){t!==this.lastDeckId&&(this.lastDeckId=t,t!==null&&this.metadata.update(e=>(e.deck.value=t,e)))}}function Dt(a){const t=He(a),e=De(a);return[{label:Kt(),value:0,disabled:!1}].concat(a.columnLabels.map((l,s)=>(s+=1,s===t?it(Nt(),!0,s):s===e?it(xt(),!0,s):s===a.guidColumn?it("GUID",!0,s):l===""?it(a.preview[0].vals[s-1],!1,s,!0):it(l,!1,s))))}function it(a,t,e,l){return{label:a?`${e}: ${a}`:e.toString(),shortLabel:l?e.toString():void 0,value:e,disabled:t}}function De(a){return a.deck.case==="deckColumn"?a.deck.value:null}function He(a){return a.notetype.case==="notetypeColumn"?a.notetype.value:null}const Ee=async({params:a})=>{const[t,e,l]=await Promise.all([Wt({}),qt({skipEmptyDefault:!1,includeFiltered:!1}),Rt({path:a.path},{alertOnError:!1})]);return{state:new Me(a.path,t,e,l)}},ka=Object.freeze(Object.defineProperty({__proto__:null,load:Ee},Symbol.toStringTag,{value:"Module"}));var Re=x('<svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper> <svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper>',1),xe=x('<svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper>',1);function Ht(a,t){X(t,!1);const e=Y();let l=D(t,"label",8),s=D(t,"columnOptions",8),o=D(t,"value",12);yt(()=>(_t(s()),_t(o())),()=>{var v;J(e,(v=s().find(m=>m.value===o()))==null?void 0:v.label)}),jt(),Q();var i=xe(),r=R(i);at(r,()=>({"--cols":2})),ut(r.lastChild,{children:(v,m)=>{var n=Re(),I=R(n);at(I,()=>({"--col-size":1})),ft(I.lastChild,{children:(b,g)=>{q();var c=W();F(()=>z(c,l())),p(b,c)},$$slots:{default:!0}}),S(I);var h=M(I,2);at(h,()=>({"--col-size":1})),ft(h.lastChild,{children:(b,g)=>{Ce(b,{get label(){return u(e)},get list(){return s()},parser:c=>({content:c.label,value:c.value,disabled:c.disabled}),get value(){return o()},set value(c){o(c)},$$legacy:!0})},$$slots:{default:!0}}),S(h),p(v,n)},$$slots:{default:!0}}),S(r),p(a,i),Z()}var je=x("<!> <!>",1);function Fe(a,t){X(t,!1);const e=dt(),l=()=>A(m,"$globalNotetype",e),s=()=>A(n,"$fieldNamesPromise",e),o=()=>A(I,"$columnOptions",e),i=()=>A(v,"$metadata",e);let r=D(t,"state",8);const v=r().metadata,m=r().globalNotetype,n=r().fieldNames,I=r().columnOptions;Q();var h=E(()=>Yt());It(a,{get title(){return u(h)},children:(b,g)=>{var c=je(),P=R(c);{var O=y=>{var N=kt(),H=R(N);Ie(H,s,null,(_,L)=>{var j=kt(),lt=R(j);vt(lt,1,()=>u(L),gt,(ct,$t,d)=>{var V=E(()=>d===0?o().slice(1):o());Ht(ct,{get label(){return u($t)},get columnOptions(){return u(V)},get value(){return l().fieldColumns[d]},set value($){B(m,C(l).fieldColumns[d]=$,C(l))},$$legacy:!0})}),p(_,j)}),p(y,N)};Ct(P,y=>{l()!==null&&y(O)})}var T=M(P,2),f=E(()=>Jt());Ht(T,{get label(){return u(f)},get columnOptions(){return o()},get value(){return i().tagsColumn},set value(y){B(v,C(i).tagsColumn=y,C(i))},$$legacy:!0}),p(b,c)},$$slots:{default:!0}}),Z()}function ze(){return[{label:Qt(),value:et.TAB},{label:Xt(),value:et.PIPE},{label:Zt(),value:et.SEMICOLON},{label:te(),value:et.COLON},{label:ee(),value:et.COMMA},{label:ae(),value:et.SPACE}]}function Ae(){return[{label:le(),value:ht.UPDATE},{label:se(),value:ht.PRESERVE},{label:oe(),value:ht.DUPLICATE}]}function Ge(){return[{label:Nt(),value:Ot.NOTETYPE},{label:re(),value:Ot.NOTETYPE_AND_DECK}]}var Le=x('<th class="svelte-ezvffl"> </th>'),Ve=x('<td class="svelte-ezvffl"> </td>'),Ue=x('<tr class="svelte-ezvffl"></tr>'),We=x('<div class="outer svelte-ezvffl"><table class="preview svelte-ezvffl"><thead><tr class="svelte-ezvffl"></tr></thead><tbody></tbody></table></div> <!>',1);function qe(a,t){X(t,!1);const e=dt(),l=()=>A(v,"$metadata",e),s=()=>A(m,"$columnOptions",e),o=Y();let i=D(t,"state",8),r=D(t,"maxColumns",8,1e3);const v=i().metadata,m=i().columnOptions;let n=Y(),I=Y(!1);function h(y){let N=!1;return{rows:y.map(_=>_.vals.length>r()?(N=!0,_.vals.slice(0,r())):_.vals),truncated:N}}yt(()=>(u(n),u(I),l()),()=>{(y=>(J(n,y.rows),J(I,y.truncated)))(h(l().preview))}),yt(()=>(u(I),_t(r())),()=>{J(o,u(I)?ie({count:r()}):"")}),jt(),Q();var b=We(),g=R(b),c=rt(g),P=rt(c),O=rt(P);vt(O,5,()=>s().slice(1),gt,(y,N)=>{let H=()=>u(N).label,_=()=>u(N).shortLabel;var L=Le(),j=rt(L,!0);S(L),F(()=>z(j,_()||H())),p(y,L)}),S(O),S(P);var T=M(P);vt(T,5,()=>u(n),gt,(y,N)=>{var H=Ue();vt(H,5,()=>u(N),gt,(_,L)=>{var j=Ve(),lt=rt(j,!0);S(j),F(()=>z(lt,u(L))),p(_,j)}),S(H),p(y,H)}),S(T),S(c),S(g);var f=M(g,2);we(f,{get warning(){return u(o)}}),p(a,b),Z()}var Be=x("<!> <!> <!>",1);function Ke(a,t){X(t,!1);const e=dt(),l=()=>A(o,"$metadata",e);let s=D(t,"state",8);const o=s().metadata,i={delimiter:{title:ne(),help:ue(),url:G.TextImporting.root},isHtml:{title:de(),help:ce(),url:G.TextImporting.html}},r=Object.values(i);let v=Y(),m=Y();function n(h){u(v).show(),u(m).to(h)}Q();var I=E(()=>Tt());It(a,{get title(){return u(I)},children:(h,b)=>{var g=Be(),c=R(g),P=E(ze);nt(c,{get defaultValue(){return s().defaultDelimiter},get choices(){return u(P)},get disabled(){return l().forceDelimiter},get value(){return l().delimiter},set value(f){B(o,C(l).delimiter=f,C(l))},children:(f,y)=>{K(f,{$$events:{click:()=>n(Object.keys(i).indexOf("delimiter"))},children:(N,H)=>{q();var _=W();F(()=>z(_,l().forceDelimiter?i.delimiter.title:pe())),p(N,_)},$$slots:{default:!0}})},$$slots:{default:!0},$$legacy:!0});var O=M(c,2);Pe(O,{get defaultValue(){return s().defaultIsHtml},get disabled(){return l().forceIsHtml},get value(){return l().isHtml},set value(f){B(o,C(l).isHtml=f,C(l))},children:(f,y)=>{K(f,{$$events:{click:()=>n(Object.keys(i).indexOf("isHtml"))},children:(N,H)=>{q();var _=W();F(()=>z(_,i.isHtml.title)),p(N,_)},$$slots:{default:!0}})},$$slots:{default:!0},$$legacy:!0});var T=M(O,2);qe(T,{get state(){return s()}}),p(h,g)},$$slots:{default:!0,tooltip:(h,b)=>{var g=E(()=>Tt());At(h,{get title(){return u(g)},get url(){return G.TextImporting.root},slot:"tooltip",helpSections:r,$$events:{mount:c=>{J(v,c.detail.modal),J(m,c.detail.carousel)}}})}}}),Z()}var Ye=x('<svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper> <svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper>',1),Je=x('<svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper>',1);function Et(a,t){X(t,!1);const e=dt(),l=()=>A(r,"$tagsWritable",e);let s=D(t,"tags",12),o=D(t,"keyCombination",8,void 0),i=D(t,"breakpoint",8,"md");const r=mt(s());Q();var v=Je(),m=R(v);at(m,()=>({"--cols":13})),ut(m.lastChild,{children:(n,I)=>{var h=Ye(),b=R(h);at(b,()=>({"--col-size":7})),ft(b.lastChild,{get breakpoint(){return i()},children:(c,P)=>{var O=kt(),T=R(O);Bt(T,t,"default",{}),p(c,O)},$$slots:{default:!0}}),S(b);var g=M(b,2);at(g,()=>({"--col-size":6})),ft(g.lastChild,{get breakpoint(){return i()},children:(c,P)=>{Oe(c,{children:(O,T)=>{Se(O,{tags:r,get keyCombination(){return o()},$$events:{tagsupdate:({detail:f})=>s(f.tags)}})},$$slots:{default:!0,revert:(O,T)=>{Te(O,{slot:"revert",defaultValue:[],get value(){return zt(),l()},set value(f){Ft(r,f)},$$legacy:!0})}}})},$$slots:{default:!0}}),S(g),p(n,h)},$$slots:{default:!0}}),S(m),p(a,v),Z()}var Qe=x("<!> <!> <!> <!> <!> <!>",1);function Xe(a,t){X(t,!1);const e=dt(),l=()=>A(v,"$globalNotetype",e),s=()=>A(m,"$deckId",e),o=()=>A(r,"$metadata",e);let i=D(t,"state",8);const r=i().metadata,v=i().globalNotetype,m=i().deckId,n={notetype:{title:Nt(),help:me(),url:G.TextImporting.root},deck:{title:xt(),help:ve(),url:G.TextImporting.root},dupeResolution:{title:ge(),help:fe(),url:G.TextImporting.updating},matchScope:{title:$e(),help:he(),url:G.TextImporting.updating},globalTags:{title:be(),help:ye(),url:G.TextImporting.root},updatedTags:{title:_e(),help:ke(),url:G.TextImporting.root}},I=Object.values(n);let h=Y(),b=Y();function g(P){u(h).show(),u(b).to(P)}Q();var c=E(()=>wt());It(a,{get title(){return u(c)},children:(P,O)=>{var T=Qe(),f=R(T);{var y=d=>{var V=E(()=>i().notetypeNameIds.map(({id:$,name:U})=>({label:U,value:$})));nt(d,{get defaultValue(){return i().defaultNotetypeId},get choices(){return u(V)},get value(){return l().id},set value($){B(v,C(l).id=$,C(l))},children:($,U)=>{K($,{$$events:{click:()=>g(Object.keys(n).indexOf("notetype"))},children:(w,Gt)=>{q();var st=W();F(()=>z(st,n.notetype.title)),p(w,st)},$$slots:{default:!0}})},$$slots:{default:!0},$$legacy:!0})};Ct(f,d=>{l()!==null&&d(y)})}var N=M(f,2);{var H=d=>{var V=E(()=>i().deckNameIds.map(({id:$,name:U})=>({label:U,value:$})));nt(d,{get defaultValue(){return i().defaultDeckId},get choices(){return u(V)},get value(){return zt(),s()},set value($){Ft(m,$)},children:($,U)=>{K($,{$$events:{click:()=>g(Object.keys(n).indexOf("deck"))},children:(w,Gt)=>{q();var st=W();F(()=>z(st,n.deck.title)),p(w,st)},$$slots:{default:!0}})},$$slots:{default:!0},$$legacy:!0})};Ct(N,d=>{s()!==null&&d(H)})}var _=M(N,2),L=E(Ae);nt(_,{defaultValue:0,get choices(){return u(L)},get value(){return o().dupeResolution},set value(d){B(r,C(o).dupeResolution=d,C(o))},children:(d,V)=>{K(d,{$$events:{click:()=>g(Object.keys(n).indexOf("dupeResolution"))},children:($,U)=>{q();var w=W();F(()=>z(w,n.dupeResolution.title)),p($,w)},$$slots:{default:!0}})},$$slots:{default:!0},$$legacy:!0});var j=M(_,2),lt=E(Ge);nt(j,{defaultValue:0,get choices(){return u(lt)},get value(){return o().matchScope},set value(d){B(r,C(o).matchScope=d,C(o))},children:(d,V)=>{K(d,{$$events:{click:()=>g(Object.keys(n).indexOf("matchScope"))},children:($,U)=>{q();var w=W();F(()=>z(w,n.matchScope.title)),p($,w)},$$slots:{default:!0}})},$$slots:{default:!0},$$legacy:!0});var ct=M(j,2);Et(ct,{keyCombination:"Control+T",get tags(){return o().globalTags},set tags(d){B(r,C(o).globalTags=d,C(o))},children:(d,V)=>{K(d,{$$events:{click:()=>g(Object.keys(n).indexOf("globalTags"))},children:($,U)=>{q();var w=W();F(()=>z(w,n.globalTags.title)),p($,w)},$$slots:{default:!0}})},$$slots:{default:!0},$$legacy:!0});var $t=M(ct,2);Et($t,{keyCombination:"Control+Shift+T",get tags(){return o().updatedTags},set tags(d){B(r,C(o).updatedTags=d,C(o))},children:(d,V)=>{K(d,{$$events:{click:()=>g(Object.keys(n).indexOf("updatedTags"))},children:($,U)=>{q();var w=W();F(()=>z(w,n.updatedTags.title)),p($,w)},$$slots:{default:!0}})},$$slots:{default:!0},$$legacy:!0}),p(P,T)},$$slots:{default:!0,tooltip:(P,O)=>{var T=E(()=>wt());At(P,{get title(){return u(T)},get url(){return G.TextImporting.root},slot:"tooltip",helpSections:I,$$events:{mount:f=>{J(h,f.detail.modal),J(b,f.detail.carousel)}}})}}}),Z()}var Ze=x("<!> <!> <!>",1);function ta(a,t){X(t,!1);let e=D(t,"state",8);Q(),Ne(a,{get path(){return e().path},get importer(){return e()},children:(l,s)=>{var o=Ze(),i=R(o);ut(i,{children:(m,n)=>{Ke(m,{get state(){return e()}})},$$slots:{default:!0}});var r=M(i,2);ut(r,{children:(m,n)=>{Xe(m,{get state(){return e()}})},$$slots:{default:!0}});var v=M(r,2);ut(v,{children:(m,n)=>{Fe(m,{get state(){return e()}})},$$slots:{default:!0}}),p(l,o)},$$slots:{default:!0}}),Z()}function Ca(a,t){X(t,!1);let e=D(t,"data",8);Q(),ta(a,{get state(){return e().state}}),Z()}export{Ca as component,ka as universal};
