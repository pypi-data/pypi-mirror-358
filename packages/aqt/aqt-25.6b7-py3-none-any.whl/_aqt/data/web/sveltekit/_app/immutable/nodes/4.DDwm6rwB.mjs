var xt=Object.defineProperty;var It=(l,t,e)=>t in l?xt(l,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):l[t]=e;var z=(l,t,e)=>It(l,typeof t!="symbol"?t+"":t,e);import{r as yt,u as Ct,n as St,s as Pt}from"../chunks/D1yVOiR4.mjs";import{aA as Tt,T as E,u as st,q as kt,b5 as Ft,b6 as Ot,b7 as zt,b8 as ot,b9 as Bt,ba as Et,bb as Lt,bc as At,U as jt,bd as qt,be as Dt,bf as Mt}from"../chunks/BVoZyvfW.mjs";import{r as lt}from"../chunks/CAXUivPC.mjs";import{i as it,S as rt}from"../chunks/C4XEJ8_1.mjs";import"../chunks/Bg9kRutz.mjs";import{i as G}from"../chunks/DTpo0kgr.mjs";import{c as p,i as _,p as M,l as T,a as J,f as O,g as o,V as C,n as Rt,t as $t,b as A,d as R,m as P,s as b,T as j,al as tt,e as Wt,r as h,h as L,Z as Ht}from"../chunks/DvQPdglG.mjs";import{p as x,i as U}from"../chunks/jy7gnWqU.mjs";import{s as Y,a as Z,e as Nt}from"../chunks/B2Ge_TJA.mjs";import{r as Gt}from"../chunks/CcaWrs5J.mjs";import{C as nt}from"../chunks/BBeIjo2R.mjs";import{R as V,e as wt,i as bt}from"../chunks/BHETkb4X.mjs";import{L as Ut,S as Vt}from"../chunks/DrU-pqQX.mjs";import{T as dt}from"../chunks/D5HGIOn1.mjs";import{s as q,e as ct}from"../chunks/DWmaQdPb.mjs";import{C as et}from"../chunks/Bk5eIai5.mjs";import{B as Zt}from"../chunks/C-Y2HJse.mjs";import{a as at,d as Jt,e as Kt,f as Qt,m as ut}from"../chunks/ytsETe_u.mjs";import{S as Xt,g as Yt,o as te}from"../chunks/CInVtgem.mjs";import{t as pt,s as ft}from"../chunks/Cm9Qw0cw.mjs";import{B as ee}from"../chunks/DO5oavOX.mjs";function vt(l){return l.map(t=>t!=null?t:-1)}function mt(l){return l.map(t=>t===-1?null:t)}class gt{constructor(t){z(this,"fields");z(this,"templates");z(this,"oldNotetypeName");z(this,"isCloze");z(this,"info");var s,a,i,d,n,r;this.info=t;const e=(a=(s=t.input)==null?void 0:s.newTemplates)!=null?a:[];this.isCloze=(d=(i=t.input)==null?void 0:i.isCloze)!=null?d:!1,e.length>0&&(this.templates=mt(e)),this.fields=mt((r=(n=t.input)==null?void 0:n.newFields)!=null?r:[]),this.oldNotetypeName=t.oldNotetypeName}mapForContext(t){var e;return t==1?(e=this.templates)!=null?e:[]:this.fields}getOldIndex(t,e){const a=this.mapForContext(t)[e];return a!=null?a:this.getOldNamesIncludingNothing(t).length-1}getOldNamesIncludingNothing(t){return[...this.getOldNames(t),Tt()]}getOldNames(t){return t==1?this.info.oldTemplateNames:this.info.oldFieldNames}getOldNotetypeName(){return this.info.oldNotetypeName}getNewName(t,e){return(t==1?this.info.newTemplateNames:this.info.newFieldNames)[e]}unusedItems(t){const e=new Set(this.mapForContext(t).filter(d=>d!==null)),s=this.getOldNames(t);return[...Array(s.length).keys()].filter(d=>!e.has(d)).map(d=>s[d])}unchanged(){var t,e;return this.input().newNotetypeId===this.input().oldNotetypeId&&it(this.fields,[...Array(this.fields.length).keys()])&&it(this.templates,[...Array((e=(t=this.templates)==null?void 0:t.length)!=null?e:0).keys()])}input(){return this.info.input}intoInput(){const t=this.info.input;return t.newFields=vt(this.fields),this.templates&&(t.newTemplates=vt(this.templates)),t}}var D=(l=>(l[l.Field=0]="Field",l[l.Template=1]="Template",l))(D||{});class se{constructor(t,e){z(this,"info");z(this,"notetypes");z(this,"info_");z(this,"infoSetter");z(this,"notetypeNames");z(this,"notetypesSetter");this.info_=new gt(e),this.info=lt(this.info_,s=>{this.infoSetter=s}),this.notetypeNames=t,this.notetypes=lt(this.buildNotetypeList(),s=>{this.notetypesSetter=s})}async setTargetNotetypeIndex(t){this.info_.input().newNotetypeId=this.notetypeNames.entries[t].id,this.notetypesSetter(this.buildNotetypeList());const{oldNotetypeId:e,newNotetypeId:s}=this.info_.input(),a=await yt({oldNotetypeId:e,newNotetypeId:s});this.info_=new gt(a),this.info_.unusedItems(0),this.infoSetter(this.info_)}setOldIndex(t,e,s){const a=this.info_.mapForContext(t),i=this.info_.getOldNames(t),d=s<i.length?s:null;if(!(t==0)&&d!==null)for(let r=0;r<a.length;r++)a[r]===d&&(a[r]=null);a[e]=d,this.infoSetter(this.info_)}dataForSaving(){return this.info_.intoInput()}async save(){if(this.info_.unchanged()){alert("No changes to save");return}await Ct(this.dataForSaving())}buildNotetypeList(){const t=this.info_.input().newNotetypeId;return this.notetypeNames.entries.map((e,s)=>({idx:s,name:e.name,current:e.id===t}))}}const re=async({params:l})=>{const[t,e]=l.notetypeIds.split("/"),s=BigInt(t),a=e?BigInt(e):s,i=St({}),d=yt({oldNotetypeId:s,newNotetypeId:a}),[n,r]=await Promise.all([i,d]);return{state:new se(n,r)}},ss=Object.freeze(Object.defineProperty({__proto__:null,load:re},Symbol.toStringTag,{value:"Module"}));var ae=_('<div class="svelte-1xardfc"></div>');function ne(l){var t=ae();p(l,t)}var oe=_("<!> <!>",1);function le(l,t){M(t,!1);const e=Y(),s=()=>Z(c,"$info",e),a=P(),i=P();let d=x(t,"state",8),n=x(t,"ctx",8),r=x(t,"newIndex",8);const c=d().info;function $(y){b(a,y.detail.value),d().setOldIndex(n(),r(),o(a))}T(()=>(s(),j(n()),j(r())),()=>{b(a,s().getOldIndex(n(),r()))}),T(()=>(s(),j(n()),o(a)),()=>{b(i,s().getOldNamesIncludingNothing(n())[o(a)])}),J(),G(),V(l,{children:(y,S)=>{var f=oe(),N=O(f);et(N,{children:(u,g)=>{var w=tt(()=>s().getOldNamesIncludingNothing(n()));rt(u,{get value(){return o(a)},get label(){return o(i)},get list(){return o(w)},$$events:{change:$}})},$$slots:{default:!0}});var k=C(N,2);et(k,{children:(u,g)=>{Rt();var w=$t();A(()=>q(w,s().getNewName(n(),r()))),p(u,w)},$$slots:{default:!0}}),p(y,f)},$$slots:{default:!0}}),R()}var ie=_('<svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper> <svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper>',1);function ht(l,t){M(t,!1);const e=Y(),s=()=>Z(d,"$info",e);let a=x(t,"state",8),i=x(t,"ctx",8);const d=a().info;G();var n=ie(),r=O(n);E(r,()=>({"--height":"0.5rem"})),ne(r.lastChild),h(r);var c=C(r,2);E(c,()=>({"--gutter-inline":"0.5rem","--gutter-block":"0.15rem"})),nt(c.lastChild,{children:($,y)=>{var S=Wt(),f=O(S);wt(f,1,()=>s().mapForContext(i()),bt,(N,k,u)=>{le(N,{get state(){return a()},get ctx(){return i()},newIndex:u})}),p($,S)},$$slots:{default:!0}}),h(c),p(l,n),R()}var de=_('<div dir="ltr" role="group"><!></div>');function ce(l,t){M(t,!1);const e=P(),s=P();let a=x(t,"id",8,void 0),i=x(t,"class",8,""),d=x(t,"size",8,void 0),n=x(t,"wrap",8,void 0),r=P();T(()=>j(d()),()=>{b(e,d()?`--buttons-size: ${d()}rem; `:"")}),T(()=>j(n()),()=>{n()===void 0?b(r,""):b(r,n()?"--buttons-wrap: wrap; ":"--buttons-wrap: nowrap; ")}),T(()=>(o(e),o(r)),()=>{b(s,o(e)+o(r))}),J();var c=de(),$=L(c);Pt($,t,"default",{}),h(c),A(()=>{var y;st(c,"id",a()),kt(c,`button-group btn-group ${(y=i())!=null?y:""} svelte-svn7mu`),st(c,"style",o(s)),c.dir=c.dir}),p(l,c),R()}var ue=_('<div class="save svelte-1polrdz"> </div>'),pe=_('<svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper> <!>',1);function fe(l,t){M(t,!1);let e=x(t,"state",8);function s(){document.activeElement instanceof HTMLElement&&document.activeElement.blur(),e().save()}const a="Control+Enter";G(),ce(l,{children:(i,d)=>{var n=pe(),r=O(n),c=tt(()=>Yt(a));E(r,()=>({"--border-left-radius":"5px","--border-right-radius":"5px"})),Ut(r.lastChild,{primary:!0,get tooltip(){return o(c)},$$events:{click:s},children:(y,S)=>{var f=ue(),N=L(f,!0);A(()=>q(N,Ft())),h(f),p(y,f)},$$slots:{default:!0}}),h(r);var $=C(r,2);Xt($,{keyCombination:a,$$events:{action:s}}),p(i,n)},$$slots:{default:!0}}),R()}var ve=_('<div class="d-flex flex-row w-100"><!> <div class="arrow-container svelte-ng49hq"><!></div> <!></div> <!>',1);function me(l,t){M(t,!1);const e=Y(),s=()=>Z(r,"$notetypes",e),a=()=>Z(c,"$info",e),i=P(),d=P();let n=x(t,"state",8);const r=n().notetypes,c=n().info;let $=P(s().findIndex(y=>y.current));T(()=>s(),()=>{b(i,Array.from(s(),y=>y.name))}),T(()=>(o(i),o($)),()=>{b(d,o(i)[o($)])}),T(()=>(j(n()),o($)),()=>{n().setTargetNotetypeIndex(o($))}),J(),G(),Zt(l,{class:"justify-content-between",wrap:!1,children:(y,S)=>{var f=ve(),N=O(f),k=L(N);rt(k,{get label(){return a().oldNotetypeName},value:1,list:[1],disabled:!0});var u=C(k,2),g=L(u);{var w=m=>{at(m,{icon:Jt})},I=m=>{at(m,{icon:Kt})};U(g,m=>{window.getComputedStyle(document.body).direction=="rtl"?m(w):m(I,!1)})}h(u);var F=C(u,2);rt(F,{get list(){return o(i)},get label(){return o(d)},get value(){return o($)},set value(m){b($,m)},$$legacy:!0}),h(N);var v=C(N,2);fe(v,{get state(){return n()}}),p(y,f)},$$slots:{default:!0}}),R()}var ge=_('<div class="clickable svelte-18ivrjn" role="button" tabindex="0"><!> </div>'),he=_("<div> <!></div>"),_e=_("<li> </li>"),ye=_("<ul></ul>"),$e=_('<div class="alert alert-warning"><!> <!></div>');function Ne(l,t){M(t,!1);const e=P(),s=P();let a=x(t,"unused",8),i=x(t,"ctx",8),d=P();const n=3;let r=P(!0);T(()=>(j(i()),ot),()=>{b(d,i()===D.Field?Ot():zt())}),T(()=>(o(r),ot),()=>{b(e,o(r)?Bt():Et())}),T(()=>(o(r),ut),()=>{b(s,o(r)?Qt:ut)}),J(),G();var c=$e(),$=L(c);{var y=u=>{var g=ge(),w=Ht(()=>te(()=>b(r,!o(r)))),I=L(g);ee(I,{iconSize:80,children:(v,m)=>{at(v,{get icon(){return o(s)}})},$$slots:{default:!0}});var F=C(I);h(g),A(()=>{var v;st(g,"aria-expanded",!o(r)),q(F,` ${(v=o(e))!=null?v:""}`)}),ct("click",g,()=>b(r,!o(r))),ct("keydown",g,function(...v){var m;(m=o(w))==null||m.apply(this,v)}),p(u,g)};U($,u=>{a().length>n&&u(y)})}var S=C($),f=C(S);{var N=u=>{var g=he(),w=L(g);A(()=>{var v;return q(w,`${(v=a().slice(0,n).join(", "))!=null?v:""} `)});var I=C(w);{var F=v=>{var m=$t();A(()=>q(m,`... (+${a().length-n})`)),p(v,m)};U(I,v=>{a().length>n&&v(F)})}h(g),p(u,g)},k=u=>{var g=ye();wt(g,5,a,bt,(w,I)=>{var F=_e(),v=L(F,!0);h(F),A(()=>q(v,o(I))),p(w,F)}),h(g),p(u,g)};U(f,u=>{o(r)?u(N):u(k,!1)})}h(c),A(()=>{var u;return q(S,` ${(u=o(d))!=null?u:""} `)}),pt(1,c,()=>ft),pt(2,c,()=>ft),p(l,c),R()}var we=_("<b> </b>"),be=_("<b> </b>"),xe=_('<svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper> <svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper>',1),Ie=_('<svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper>',1),Ce=_('<svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper>',1),Se=_("<!> <!>",1);function _t(l,t){M(t,!1);const e=Y(),s=()=>Z(o(a),"$info",e),a=P(),i=P();let d=x(t,"state",8),n=x(t,"ctx",8);T(()=>j(d()),()=>{Nt(b(a,d().info),"$info",e)}),T(()=>(s(),j(n()),D),()=>{b(i,s().isCloze&&n()===D.Template?[]:s().unusedItems(n()))}),J(),G();var r=Se(),c=O(r);{var $=f=>{Ne(f,{get unused(){return o(i)},get ctx(){return n()}})};U(c,f=>{o(i).length>0&&f($)})}var y=C(c,2);{var S=f=>{var N=Ce(),k=O(N);E(k,()=>({"--gutter-inline":"0.5rem","--gutter-block":"0.2rem"})),nt(k.lastChild,{children:(u,g)=>{var w=Ie(),I=O(w);E(I,()=>({"--cols":2})),V(I.lastChild,{children:(F,v)=>{var m=xe(),W=O(m);E(W,()=>({"--col-size":1})),et(W.lastChild,{children:(Q,H)=>{var B=we(),X=L(B,!0);A(()=>q(X,Lt())),h(B),p(Q,B)},$$slots:{default:!0}}),h(W);var K=C(W,2);E(K,()=>({"--col-size":1})),et(K.lastChild,{children:(Q,H)=>{var B=be(),X=L(B,!0);A(()=>q(X,At())),h(B),p(Q,B)},$$slots:{default:!0}}),h(K),p(F,m)},$$slots:{default:!0}}),h(I),p(u,w)},$$slots:{default:!0}}),h(k),p(f,N)};U(y,f=>{(s().templates||n()===D.Field)&&f(S)})}p(l,r),R()}var Pe=_("<!> <!>",1),Te=_("<div><!></div>"),ke=_("<!> <!>",1),Fe=_('<svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper> <svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper>',1),Oe=_('<svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper> <svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper>',1);function ze(l,t){M(t,!1);const e=Y(),s=()=>Z(o(a),"$info",e),a=P();let i=x(t,"state",8);T(()=>j(i()),()=>{Nt(b(a,i().info),"$info",e)}),J(),G();var d=Oe(),n=O(d);E(n,()=>({"--gutter-block":"0.5rem","--gutter-inline":"0.25rem","--sticky-borders":"0 0 1px"})),Vt(n.lastChild,{breakpoint:"sm",children:(c,$)=>{me(c,{get state(){return i()}})},$$slots:{default:!0}}),h(n);var r=C(n,2);E(r,()=>({"--gutter-inline":"0.25rem","--gutter-block":"0.75rem"})),nt(r.lastChild,{breakpoint:"sm",children:(c,$)=>{var y=Fe(),S=O(y);E(S,()=>({"--cols":2})),V(S.lastChild,{children:(N,k)=>{var u=tt(()=>Dt());dt(N,{get title(){return o(u)},children:(g,w)=>{V(g,{children:(I,F)=>{var v=Pe(),m=O(v);_t(m,{get state(){return i()},get ctx(){return D.Field}});var W=C(m,2);ht(W,{get state(){return i()},get ctx(){return D.Field}}),p(I,v)},$$slots:{default:!0}})},$$slots:{default:!0}})},$$slots:{default:!0}}),h(S);var f=C(S,2);E(f,()=>({"--cols":2})),V(f.lastChild,{children:(N,k)=>{var u=tt(()=>Mt());dt(N,{get title(){return o(u)},children:(g,w)=>{V(g,{children:(I,F)=>{var v=ke(),m=O(v);_t(m,{get state(){return i()},get ctx(){return D.Template}});var W=C(m,2);{var K=H=>{ht(H,{get state(){return i()},get ctx(){return D.Template}})},Q=H=>{var B=Te(),X=L(B);jt(X,()=>Gt(qt()),!1,!1),h(B),p(H,B)};U(W,H=>{s().templates?H(K):H(Q,!1)})}p(I,v)},$$slots:{default:!0}})},$$slots:{default:!0}})},$$slots:{default:!0}}),h(f),p(c,y)},$$slots:{default:!0}}),h(r),p(l,d),R()}function rs(l,t){M(t,!1);let e=x(t,"data",8);G(),ze(l,{get state(){return e().state}}),R()}export{rs as component,ss as universal};
