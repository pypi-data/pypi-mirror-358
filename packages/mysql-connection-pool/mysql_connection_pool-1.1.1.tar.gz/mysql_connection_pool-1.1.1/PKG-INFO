Metadata-Version: 2.4
Name: mysql-connection-pool
Version: 1.1.1
Summary: Una clase para manejar conexiones a MySQL con un pool de conexiones y soporte para mÃºltiples hilos.
Home-page: https://github.com/cursland/mysql_connection_pool
Author: Cursland
Author-email: 
Project-URL: Author, https://cursland.com
Project-URL: GitHub, https://github.com/cursland/mysql_connection_pool
Keywords: mysql database connection pool threading
Classifier: Programming Language :: Python :: 3
Classifier: Programming Language :: Python :: 3.8
Classifier: Programming Language :: Python :: 3.9
Classifier: Programming Language :: Python :: 3.10
Classifier: Programming Language :: Python :: 3.11
Classifier: Programming Language :: Python :: 3.12
Classifier: License :: OSI Approved :: MIT License
Classifier: Operating System :: OS Independent
Classifier: Development Status :: 4 - Beta
Classifier: Intended Audience :: Developers
Classifier: Topic :: Database
Classifier: Topic :: Software Development :: Libraries :: Python Modules
Requires-Python: >=3.8
Description-Content-Type: text/markdown
License-File: LICENSE
Requires-Dist: mysql-connector-python>=8.4.0
Requires-Dist: sqlglot>=25.0.0
Dynamic: author
Dynamic: classifier
Dynamic: description
Dynamic: description-content-type
Dynamic: home-page
Dynamic: keywords
Dynamic: license-file
Dynamic: project-url
Dynamic: requires-dist
Dynamic: requires-python
Dynamic: summary

# ğŸ¬âœ¨ MySQL Connection Pool - Gestor de conexiones para MySQL âœ¨ğŸ¬

Este mÃ³dulo proporciona una clase `MySQLConnectionPool` que gestiona un pool de conexiones a MySQL de forma segura para hilos, con capacidades avanzadas de logging y manejo de transacciones.

## ğŸš€ CaracterÃ­sticas principales

- âœ… **Pool de conexiones thread-safe**  
- ğŸ”„ **ReconexiÃ³n automÃ¡tica**  
- ğŸ“ **Logging detallado con soporte multilingÃ¼e (espaÃ±ol/inglÃ©s)**  
- ğŸ”„ **Cambio de base de datos dinÃ¡mico**  
- ğŸ“‚ **EjecuciÃ³n de archivos SQL con parsing avanzado**  
- ğŸ”’ **Manejo seguro de recursos (cierre automÃ¡tico de conexiones)**  
- ğŸ“Š **MÃºltiples mÃ©todos de ejecuciÃ³n segÃºn necesidades**  

## ğŸ“¦ InstalaciÃ³n

```bash
pip install mysql-connection-pool
```

## ğŸ› ï¸ Uso bÃ¡sico

### âš™ï¸ InicializaciÃ³n

```python
from mysql_connection_pool import MySQLConnectionPool

# ConfiguraciÃ³n inicial
db = MySQLConnectionPool(
    host='localhost',
    user='tu_usuario',
    password='tu_contraseÃ±a',
    database='base_inicial',
    pool_size=5,
    logs='logs/mysql.log',  # Ruta relativa o absoluta
    log_language='es',      # 'es' o 'en'
    clear_logs=True         # Limpiar archivo de log al iniciar
)
```

### ğŸ” EjecuciÃ³n de consultas

```python
# ğŸ‘¥ Consulta SELECT simple
usuarios = db.fetchall("SELECT * FROM usuarios")

# ğŸ” Consulta con parÃ¡metros
usuario = db.fetchone("SELECT * FROM usuarios WHERE id = %s", (1,))

# ğŸ“ InserciÃ³n con commit automÃ¡tico
filas_afectadas, ultimo_id = db.commit_execute(
    "INSERT INTO productos (nombre, precio) VALUES (%s, %s)",
    ("Laptop", 999.99)
)

# ğŸ”„ Cambiar de base de datos
db.switch_database('otra_base_datos')
```

## ğŸ§© MÃ©todos principales

### 1ï¸âƒ£ `execute(query, params=None, database=None, enable_logging=False)`
Ejecuta una consulta y devuelve cursor y conexiÃ³n (debes cerrarla manualmente).

```python
cursor, conn = db.execute("SELECT * FROM tabla")
try:
    resultados = cursor.fetchall()
finally:
    conn.close()  # Â¡Importante cerrar la conexiÃ³n! ğŸ”’
```

### 2ï¸âƒ£ `execute_safe(query, params=None, database=None, enable_logging=False)`
Ejecuta una consulta y cierra los recursos automÃ¡ticamente.

```python
resultados = db.execute_safe("SELECT * FROM productos WHERE precio > %s", (100,))
```

### 3ï¸âƒ£ `fetchone(query, params=None, database=None, enable_logging=False)`
Obtiene una sola fila.

```python
usuario = db.fetchone("SELECT * FROM usuarios WHERE email = %s", ("user@example.com",))
```

### 4ï¸âƒ£ `fetchall(query, params=None, database=None, enable_logging=False)`
Obtiene todas las filas.

```python
productos = db.fetchall("SELECT * FROM productos")
```

### 5ï¸âƒ£ `commit_execute(query, params=None, database=None, enable_logging=False)`
Ejecuta una consulta de escritura (INSERT/UPDATE/DELETE) con commit automÃ¡tico.

```python
filas, id_insertado = db.commit_execute(
    "INSERT INTO ventas (producto_id, cantidad) VALUES (%s, %s)",
    (5, 2)
)
```

### 6ï¸âƒ£ `switch_database(database)`
Cambia a otra base de datos.

```python
db.switch_database('base_de_datos_nueva')
```

### 7ï¸âƒ£ MÃ©todos con logging automÃ¡tico
Versiones con `_logged` que activan logging por defecto:

```python
db.execute_logged(...)
db.fetchone_logged(...)
# etc...
```

## ğŸ“‚ EjecuciÃ³n de archivos SQL

### ğŸ“„ Ejecutar un archivo SQL

```python
MySQLConnectionPool.run_sql_file('ruta/archivo.sql')
```

### ğŸ“š Ejecutar mÃºltiples archivos

```python
MySQLConnectionPool.run_multiple_sql_files([
    'ruta/archivo1.sql',
    'ruta/archivo2.sql'
])
```

### ğŸ—‚ï¸ Ejecutar archivos desde un directorio

```python
MySQLConnectionPool.run_multiple_sql_files_from_directory(
    'ruta/directorio',
    ['script1.sql', 'script2.sql']
)
```

## ğŸ† Ejemplo completo

```python
from mysql_connection_pool import MySQLConnectionPool
import os

# ConfiguraciÃ³n inicial
db = MySQLConnectionPool(
    host='localhost',
    user='root',
    password='password123',
    database='mi_negocio',
    pool_size=5,
    logs=os.path.join('logs', 'mysql.log'),
    log_language='es',
    clear_logs=True
)

try:
    # 1ï¸âƒ£ Crear tabla si no existe
    db.commit_execute_logged("""
        CREATE TABLE IF NOT EXISTS clientes (
            id INT AUTO_INCREMENT PRIMARY KEY,
            nombre VARCHAR(100) NOT NULL,
            email VARCHAR(100) UNIQUE NOT NULL,
            fecha_registro DATETIME DEFAULT CURRENT_TIMESTAMP
        )
    """)
    
    # 2ï¸âƒ£ Insertar datos
    filas_afectadas, ultimo_id = db.commit_execute_logged(
        "INSERT INTO clientes (nombre, email) VALUES (%s, %s)",
        ("Juan PÃ©rez", "juan@example.com")
    )
    print(f"ID insertado: {ultimo_id} ğŸ‰")
    
    # 3ï¸âƒ£ Consultar datos
    clientes = db.fetchall_logged("SELECT * FROM clientes")
    print("Clientes:", clientes)
    
    # 4ï¸âƒ£ Cambiar de base de datos y ejecutar script SQL
    db.switch_database('otra_base')
    MySQLConnectionPool.run_sql_file('scripts/migracion.sql')
    
except Exception as e:
    print("âŒ Error:", e)
```

## ğŸ“ Sistema de Logging

El sistema de logging registra:
- âœ… EjecuciÃ³n exitosa de consultas
- âŒ Errores con detalles completos
- ğŸ“ Cambios de base de datos
- ğŸ“‚ EjecuciÃ³n de archivos SQL

Ejemplo de entrada de log:
```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•[2023-07-20 14:30:45] RUN_SQL_FILEâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Action: Procesando archivo SQL: migracion.sql

Ejecutando sentencias SQL: 3

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

## ğŸ§  Manejo avanzado de SQL

El parser soporta:
- ğŸ”„ Sentencias con DELIMITER para procedimientos almacenados
- ğŸ“ Comentarios (-- y /* */)
- ğŸ“œ Multiples sentencias en un archivo

Ejemplo de archivo SQL complejo:

```sql
DELIMITER //
CREATE PROCEDURE calcular_total(IN cliente_id INT)
BEGIN
    SELECT SUM(monto) AS total 
    FROM pedidos 
    WHERE cliente_id = cliente_id;
END //
DELIMITER ;

-- Insertar datos iniciales
INSERT INTO config (parametro, valor) VALUES ('version', '1.0');
```
