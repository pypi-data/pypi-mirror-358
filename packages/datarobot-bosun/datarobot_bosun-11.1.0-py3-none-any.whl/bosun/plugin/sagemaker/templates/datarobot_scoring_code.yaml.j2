#  ---------------------------------------------------------------------------------
#  Copyright (c) 2023 DataRobot, Inc. and its affiliates. All rights reserved.
#  Last updated 2023.
#
#  DataRobot, Inc. Confidential.
#  This is proprietary source code of DataRobot, Inc. and its affiliates.
#
#  This file and its contents are subject to DataRobot Tool and Utility Agreement.
#  For details, see
#  https://www.datarobot.com/wp-content/uploads/2021/07/DataRobot-Tool-and-Utility-Agreement.pdf.
#  ---------------------------------------------------------------------------------
version: 0.2
phases:
  pre_build:
    commands:
    - apt-get update
    - apt-get install zip -y
    - echo Logging in to Amazon ECR...
    - tar -czvf model.tar.gz $MODEL_PACKAGE
    - aws s3 cp model.tar.gz $OUTPUT_MODEL_PATH
    - aws ecr get-login-password --region $AWS_REGION | docker login --username AWS
      --password-stdin $AWS_ECR
  build:
    commands:
    - echo Pull down the scoring code server base image...
    - docker pull $SCORING_CODE_SERVING
    - echo Build started on `date`
    - echo Tagging the image as $AWS_ECR/$ECR_REPO:scoringcode
    - docker tag $SCORING_CODE_SERVING $AWS_ECR/$ECR_REPO:scoringcode
  post_build:
    commands:
    - echo Build completed on `date`
    - echo Pushing the Docker image to $AWS_ECR/$ECR_REPO:scoringcode
    - docker push $AWS_ECR/$ECR_REPO:scoringcode
