#!/usr/bin/env python3
"""Compare our State8 with captured ones byte by byte."""

# Captured State8 from the app
captured_states = {
    0: "c10000000000c000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000",
    1: "c20000000000c000000000000000000000000000000000000000000000000000000000000000000000000000000000000101000000000000000000000000000000000000000000000000000000000000",
    2: "c30000000000c000000000000000000000000000000000000000000000000000000000000000000000000000000000000201000000000000000000000000000000000000000000000000000000000000",
    3: "c40000000000c000000000000000000000000000000000000000000000000000000000000000000000000000000000000301000000000000000000000000000000000000000000000000000000000000",
    4: "c50000000000c000000000000000000000000000000000000000000000000000000000000000000000000000000000000401000000000000000000000000000000000000000000000000000000000000",
    5: "c60000000000c000000000000000000000000000000000000000000000000000000000000000000000000000000000000501000000000000000000000000000000000000000000000000000000000000",
    7: "c80000000000c000000000000000000000000000000000000000000000000000000000000000000000000000000000000701000000000000000000000000000000000000000000000000000000000000",
}

# Our template
our_template = "c20000000000c000000000000000000000000000000000000000000000000000000000000000000000000000000000000101000000000000000000000000000000000000000000000000000000000000"

print("=== State8 Comparison ===\n")

# First, let's identify all the differences
print("Positions that change based on fan direction:")
for pos in range(0, 160, 2):
    values = set()
    for fan_dir, state in captured_states.items():
        values.add(state[pos:pos+2])
    
    if len(values) > 1:
        print(f"Position {pos}-{pos+1}: {values}")

print("\n\nDetailed analysis for each fan direction:")
for fan_dir, captured in captured_states.items():
    print(f"\nFan direction {fan_dir}:")
    print(f"  Position 0-1: {captured[0:2]} (0xC1 + {fan_dir} = 0x{0xC1 + fan_dir:02X})")
    print(f"  Position 96-97: {captured[96:98]} (fan direction as 2-digit: {fan_dir:02d})")
    print(f"  Position 98-99: {captured[98:100]}")

print("\n\n=== Our current implementation ===")
print("We're setting:")
print("  Position 0: 'c'")
print("  Position 1: str(fan_dir + 1)  <-- WRONG! Should be hex(0xC1 + fan_dir)")
print("  Position 96: str(fan_dir)     <-- WRONG! Should be 2-digit with leading zero")
print("  Position 97: Not set          <-- WRONG! Should be part of 2-digit fan_dir")

print("\n\n=== The fix needed ===")
print("1. Position 0-1: Should be hex(0xC1 + fan_dir) as a 2-character hex string")
print("2. Position 96-97: Should be fan_dir as 2-digit decimal with leading zero")
print("3. Position 98-99: Should remain '01'")