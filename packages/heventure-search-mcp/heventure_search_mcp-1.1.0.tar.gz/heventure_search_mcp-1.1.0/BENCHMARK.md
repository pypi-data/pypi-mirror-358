# MCP Web Search Server åŸºå‡†æµ‹è¯•æŒ‡å—

æœ¬æ–‡æ¡£è¯¦ç»†ä»‹ç»äº†å¦‚ä½•å¯¹MCP Web Search Serverè¿›è¡Œæ€§èƒ½åŸºå‡†æµ‹è¯•ã€‚

## ðŸ“‹ æµ‹è¯•å·¥å…·æ¦‚è§ˆ

### æµ‹è¯•è„šæœ¬

| è„šæœ¬åç§° | ç”¨é€” | ç‰¹ç‚¹ |
|----------|------|------|
| `quick_benchmark.py` | å¿«é€Ÿæ€§èƒ½æµ‹è¯• | è½»é‡çº§ï¼Œé€‚åˆæ—¥å¸¸æ£€æŸ¥ |
| `benchmark.py` | å®Œæ•´æ€§èƒ½æµ‹è¯• | å…¨é¢æµ‹è¯•ï¼ŒåŒ…å«ç³»ç»Ÿç›‘æŽ§ |
| `benchmark_report.py` | æŠ¥å‘Šç”Ÿæˆå™¨ | ç”Ÿæˆè¯¦ç»†çš„åˆ†æžæŠ¥å‘Š |
| `run_benchmark.sh` | ç»Ÿä¸€å¯åŠ¨è„šæœ¬ | ä¸€é”®è¿è¡Œå„ç§æµ‹è¯• |

### é…ç½®æ–‡ä»¶

- `benchmark_config.json` - æµ‹è¯•é…ç½®å‚æ•°
- `benchmark_results.csv` - CSVæ ¼å¼æµ‹è¯•ç»“æžœ
- `benchmark_report.md` - Markdownæ ¼å¼è¯¦ç»†æŠ¥å‘Š

## ðŸš€ å¿«é€Ÿå¼€å§‹

### 1. çŽ¯å¢ƒå‡†å¤‡

ç¡®ä¿å·²ç»è®¾ç½®å¥½MCPæœåŠ¡çŽ¯å¢ƒï¼š

```bash
# åˆ›å»ºè™šæ‹ŸçŽ¯å¢ƒå¹¶å®‰è£…ä¾èµ–
./start_server.sh
```

### 2. è¿è¡Œå¿«é€Ÿæµ‹è¯•

```bash
# ä½¿ç”¨ç»Ÿä¸€è„šæœ¬ï¼ˆæŽ¨èï¼‰
./run_benchmark.sh --quick

# æˆ–ç›´æŽ¥è¿è¡Œ
source venv/bin/activate
python quick_benchmark.py
```

### 3. æŸ¥çœ‹ç»“æžœ

æµ‹è¯•å®ŒæˆåŽä¼šè‡ªåŠ¨ç”Ÿæˆï¼š
- `benchmark_report.md` - è¯¦ç»†æŠ¥å‘Š
- `benchmark_results.csv` - æ•°æ®è¡¨æ ¼
- `quick_benchmark_results.json` - åŽŸå§‹æ•°æ®

## ðŸ“Š æµ‹è¯•ç±»åž‹è¯¦è§£

### å¿«é€ŸåŸºå‡†æµ‹è¯•

**ç”¨é€”**: æ—¥å¸¸æ€§èƒ½æ£€æŸ¥ï¼Œå¿«é€ŸéªŒè¯æœåŠ¡çŠ¶æ€

**æµ‹è¯•å†…å®¹**:
- æœç´¢åŠŸèƒ½æ€§èƒ½ (8æ¬¡è¯·æ±‚)
- å†…å®¹èŽ·å–æ€§èƒ½ (3æ¬¡è¯·æ±‚)
- å¹¶å‘å¤„ç†èƒ½åŠ› (3ä¸ªå¹¶å‘è¯·æ±‚)

**è¿è¡Œæ—¶é—´**: çº¦1-2åˆ†é’Ÿ

```bash
./run_benchmark.sh --quick
```

### å®Œæ•´åŸºå‡†æµ‹è¯•

**ç”¨é€”**: å…¨é¢æ€§èƒ½è¯„ä¼°ï¼ŒåŒ…å«ç³»ç»Ÿèµ„æºç›‘æŽ§

**æµ‹è¯•å†…å®¹**:
- é¡ºåºæ€§èƒ½æµ‹è¯• (30æ¬¡è¯·æ±‚)
- å¹¶å‘æ€§èƒ½æµ‹è¯• (5ä¸ªworkerï¼Œæ¯ä¸ª4æ¬¡è¯·æ±‚)
- åŽ‹åŠ›æµ‹è¯• (30ç§’æŒç»­è¯·æ±‚)
- ç³»ç»Ÿèµ„æºç›‘æŽ§ (å†…å­˜ã€CPUä½¿ç”¨çŽ‡)

**è¿è¡Œæ—¶é—´**: çº¦3-5åˆ†é’Ÿ

```bash
./run_benchmark.sh --full
```

### åŽ‹åŠ›æµ‹è¯•

**ç”¨é€”**: æžé™æ€§èƒ½æµ‹è¯•ï¼Œè¯„ä¼°æœåŠ¡ç¨³å®šæ€§

**æµ‹è¯•å†…å®¹**:
- æŒç»­é«˜é¢‘è¯·æ±‚ (2åˆ†é’Ÿ)
- å®žæ—¶ç³»ç»Ÿç›‘æŽ§
- é”™è¯¯çŽ‡ç»Ÿè®¡

**è¿è¡Œæ—¶é—´**: çº¦2åˆ†é’Ÿ

```bash
./run_benchmark.sh --stress
```

## ðŸ“ˆ æ€§èƒ½æŒ‡æ ‡è¯´æ˜Ž

### å“åº”æ—¶é—´æŒ‡æ ‡

| æŒ‡æ ‡ | è¯´æ˜Ž |
|------|------|
| å¹³å‡å“åº”æ—¶é—´ | æ‰€æœ‰è¯·æ±‚çš„å¹³å‡è€—æ—¶ |
| ä¸­ä½æ•°å“åº”æ—¶é—´ | 50%è¯·æ±‚çš„å“åº”æ—¶é—´ |
| 95ç™¾åˆ†ä½å“åº”æ—¶é—´ | 95%è¯·æ±‚çš„å“åº”æ—¶é—´ |
| æœ€å¤§å“åº”æ—¶é—´ | æœ€æ…¢è¯·æ±‚çš„å“åº”æ—¶é—´ |

### æˆåŠŸçŽ‡æŒ‡æ ‡

- **æˆåŠŸçŽ‡**: æˆåŠŸè¯·æ±‚æ•° / æ€»è¯·æ±‚æ•° Ã— 100%
- **é”™è¯¯çŽ‡**: å¤±è´¥è¯·æ±‚æ•° / æ€»è¯·æ±‚æ•° Ã— 100%

### åžåé‡æŒ‡æ ‡

- **QPS**: æ¯ç§’æŸ¥è¯¢æ•° (Queries Per Second)
- **å¹¶å‘å¤„ç†èƒ½åŠ›**: åŒæ—¶å¤„ç†çš„è¯·æ±‚æ•°é‡

### ç³»ç»Ÿèµ„æºæŒ‡æ ‡

- **å†…å­˜ä½¿ç”¨**: è¿›ç¨‹å†…å­˜å ç”¨ (MB)
- **CPUä½¿ç”¨çŽ‡**: è¿›ç¨‹CPUå ç”¨ç™¾åˆ†æ¯”

## ðŸŽ¯ æ€§èƒ½è¯„çº§æ ‡å‡†

### æœç´¢åŠŸèƒ½

| è¯„çº§ | å“åº”æ—¶é—´ | æˆåŠŸçŽ‡ | å›¾æ ‡ |
|------|----------|--------|----- |
| ä¼˜ç§€ | â‰¤ 1.5ç§’ | â‰¥ 90% | ðŸŸ¢ |
| è‰¯å¥½ | â‰¤ 3ç§’ | â‰¥ 75% | ðŸŸ¡ |
| å¯æŽ¥å— | â‰¤ 5ç§’ | â‰¥ 60% | ðŸŸ  |
| éœ€è¦æ”¹è¿› | > 5ç§’ | < 60% | ðŸ”´ |

### å†…å®¹èŽ·å–

| è¯„çº§ | å“åº”æ—¶é—´ | æˆåŠŸçŽ‡ | å›¾æ ‡ |
|------|----------|--------|----- |
| ä¼˜ç§€ | â‰¤ 2ç§’ | â‰¥ 90% | ðŸŸ¢ |
| è‰¯å¥½ | â‰¤ 5ç§’ | â‰¥ 75% | ðŸŸ¡ |
| å¯æŽ¥å— | â‰¤ 10ç§’ | â‰¥ 60% | ðŸŸ  |
| éœ€è¦æ”¹è¿› | > 10ç§’ | < 60% | ðŸ”´ |

## ðŸ”§ æ€§èƒ½ä¼˜åŒ–å»ºè®®

### ç½‘ç»œå±‚ä¼˜åŒ–

1. **è¿žæŽ¥æ± ä¼˜åŒ–**
   ```python
   # åœ¨server.pyä¸­è°ƒæ•´è¿žæŽ¥æ± å¤§å°
   connector = aiohttp.TCPConnector(
       limit=100,  # æ€»è¿žæŽ¥æ•°
       limit_per_host=30,  # æ¯ä¸ªä¸»æœºè¿žæŽ¥æ•°
       ttl_dns_cache=300,  # DNSç¼“å­˜æ—¶é—´
       use_dns_cache=True
   )
   ```

2. **è¶…æ—¶è®¾ç½®**
   ```python
   timeout = aiohttp.ClientTimeout(
       total=30,  # æ€»è¶…æ—¶æ—¶é—´
       connect=10,  # è¿žæŽ¥è¶…æ—¶
       sock_read=20  # è¯»å–è¶…æ—¶
   )
   ```

3. **è¯·æ±‚å¤´ä¼˜åŒ–**
   ```python
   headers = {
       'User-Agent': 'MCP-WebSearch/1.0',
       'Accept-Encoding': 'gzip, deflate',
       'Connection': 'keep-alive'
   }
   ```

### åº”ç”¨å±‚ä¼˜åŒ–

1. **ç¼“å­˜ç­–ç•¥**
   - å®žçŽ°æœç´¢ç»“æžœç¼“å­˜
   - ä½¿ç”¨Redisæˆ–å†…å­˜ç¼“å­˜
   - è®¾ç½®åˆç†çš„ç¼“å­˜è¿‡æœŸæ—¶é—´

2. **å¹¶å‘æŽ§åˆ¶**
   ```python
   # é™åˆ¶å¹¶å‘è¯·æ±‚æ•°é‡
   semaphore = asyncio.Semaphore(10)
   
   async def limited_request():
       async with semaphore:
           # æ‰§è¡Œè¯·æ±‚
           pass
   ```

3. **é”™è¯¯é‡è¯•**
   ```python
   # å®žçŽ°æŒ‡æ•°é€€é¿é‡è¯•
   for attempt in range(3):
       try:
           result = await make_request()
           break
       except Exception:
           await asyncio.sleep(2 ** attempt)
   ```

### ç³»ç»Ÿå±‚ä¼˜åŒ–

1. **å†…å­˜ç®¡ç†**
   - åŠæ—¶é‡Šæ”¾å¤§å¯¹è±¡
   - ä½¿ç”¨ç”Ÿæˆå™¨å¤„ç†å¤§æ•°æ®
   - ç›‘æŽ§å†…å­˜æ³„æ¼

2. **CPUä¼˜åŒ–**
   - ä½¿ç”¨å¼‚æ­¥I/O
   - é¿å…CPUå¯†é›†åž‹æ“ä½œ
   - åˆç†ä½¿ç”¨å¤šè¿›ç¨‹

## ðŸ“Š æŠ¥å‘Šè§£è¯»

### MarkdownæŠ¥å‘Šç»“æž„

```
# MCP Web Search Server æ€§èƒ½åŸºå‡†æµ‹è¯•æŠ¥å‘Š

## ðŸ“Š æµ‹è¯•æ¦‚è§ˆ
- æµ‹è¯•ç»“æžœæ±‡æ€»è¡¨æ ¼
- æ€§èƒ½è¯„çº§å›¾æ ‡

## ðŸ“ˆ è¯¦ç»†åˆ†æž
- å„æµ‹è¯•ç±»åž‹çš„è¯¦ç»†æŒ‡æ ‡
- æ€§èƒ½è¯„ä¼°å’Œå»ºè®®

## ðŸ’¡ ä¼˜åŒ–å»ºè®®
- é’ˆå¯¹æ€§çš„æ”¹è¿›å»ºè®®
- æ€§èƒ½è°ƒä¼˜æŒ‡å—
```

### CSVæ•°æ®åˆ†æž

å¯ä»¥å°†CSVæ–‡ä»¶å¯¼å…¥Excelæˆ–å…¶ä»–æ•°æ®åˆ†æžå·¥å…·ï¼š

1. **è¶‹åŠ¿åˆ†æž**: å¯¹æ¯”ä¸åŒæ—¶é—´çš„æµ‹è¯•ç»“æžœ
2. **æ€§èƒ½ç›‘æŽ§**: è®¾ç½®æ€§èƒ½é˜ˆå€¼å‘Šè­¦
3. **å®¹é‡è§„åˆ’**: åŸºäºŽæµ‹è¯•æ•°æ®è§„åˆ’èµ„æº

## ðŸ› ï¸ è‡ªå®šä¹‰æµ‹è¯•

### ä¿®æ”¹æµ‹è¯•å‚æ•°

ç¼–è¾‘ `benchmark_config.json`ï¼š

```json
{
  "test_configurations": {
    "custom_test": {
      "description": "è‡ªå®šä¹‰æµ‹è¯•é…ç½®",
      "search_iterations": 20,
      "content_iterations": 10,
      "concurrent_requests": 5,
      "request_delay": 0.1
    }
  }
}
```

### æ·»åŠ æµ‹è¯•ç”¨ä¾‹

åœ¨æµ‹è¯•è„šæœ¬ä¸­æ·»åŠ æ–°çš„æŸ¥è¯¢ï¼š

```python
test_queries = [
    "ä½ çš„è‡ªå®šä¹‰æŸ¥è¯¢1",
    "ä½ çš„è‡ªå®šä¹‰æŸ¥è¯¢2",
    # ...
]

test_urls = [
    "https://your-test-site1.com",
    "https://your-test-site2.com",
    # ...
]
```

### è‡ªå®šä¹‰æ€§èƒ½é˜ˆå€¼

ä¿®æ”¹ `benchmark_config.json` ä¸­çš„é˜ˆå€¼ï¼š

```json
{
  "performance_thresholds": {
    "search_response_time": {
      "excellent": 1000,  # 1ç§’
      "good": 2000,       # 2ç§’
      "acceptable": 4000  # 4ç§’
    }
  }
}
```

## ðŸ” æ•…éšœæŽ’é™¤

### å¸¸è§é—®é¢˜

1. **æµ‹è¯•å¤±è´¥**
   ```bash
   # æ£€æŸ¥ç½‘ç»œè¿žæŽ¥
   ping google.com
   
   # æ£€æŸ¥ä¾èµ–
   source venv/bin/activate
   pip list
   ```

2. **å“åº”æ—¶é—´è¿‡é•¿**
   - æ£€æŸ¥ç½‘ç»œå»¶è¿Ÿ
   - éªŒè¯ç›®æ ‡ç½‘ç«™å¯è®¿é—®æ€§
   - è°ƒæ•´è¶…æ—¶è®¾ç½®

3. **æˆåŠŸçŽ‡ä½Ž**
   - æ£€æŸ¥User-Agentè®¾ç½®
   - éªŒè¯è¯·æ±‚é¢‘çŽ‡é™åˆ¶
   - æŸ¥çœ‹é”™è¯¯æ—¥å¿—

### è°ƒè¯•æ¨¡å¼

å¯ç”¨è¯¦ç»†æ—¥å¿—ï¼š

```python
import logging
logging.basicConfig(level=logging.DEBUG)
```

### ç½‘ç»œè¯Šæ–­

```bash
# æµ‹è¯•DNSè§£æž
nslookup duckduckgo.com

# æµ‹è¯•HTTPè¿žæŽ¥
curl -I https://duckduckgo.com

# æ£€æŸ¥ä»£ç†è®¾ç½®
echo $http_proxy
echo $https_proxy
```

## ðŸ“… å®šæœŸæµ‹è¯•å»ºè®®

### æµ‹è¯•é¢‘çŽ‡

- **æ—¥å¸¸æ£€æŸ¥**: æ¯å¤©è¿è¡Œå¿«é€Ÿæµ‹è¯•
- **å‘¨åº¦è¯„ä¼°**: æ¯å‘¨è¿è¡Œå®Œæ•´æµ‹è¯•
- **æœˆåº¦å®¡æŸ¥**: æ¯æœˆè¿è¡ŒåŽ‹åŠ›æµ‹è¯•
- **ç‰ˆæœ¬å‘å¸ƒ**: æ¯æ¬¡æ›´æ–°åŽè¿è¡Œå…¨å¥—æµ‹è¯•

### è‡ªåŠ¨åŒ–æµ‹è¯•

ä½¿ç”¨cronå®šæ—¶ä»»åŠ¡ï¼š

```bash
# æ¯å¤©ä¸Šåˆ9ç‚¹è¿è¡Œå¿«é€Ÿæµ‹è¯•
0 9 * * * cd /path/to/mcp_dev && ./run_benchmark.sh --quick

# æ¯å‘¨ä¸€ä¸Šåˆ10ç‚¹è¿è¡Œå®Œæ•´æµ‹è¯•
0 10 * * 1 cd /path/to/mcp_dev && ./run_benchmark.sh --full
```

### ç»“æžœå½’æ¡£

```bash
# åˆ›å»ºç»“æžœå½’æ¡£ç›®å½•
mkdir -p benchmark_history/$(date +%Y-%m)

# å½’æ¡£æµ‹è¯•ç»“æžœ
cp benchmark_report.md benchmark_history/$(date +%Y-%m)/report_$(date +%Y%m%d_%H%M).md
```

## ðŸ“š å‚è€ƒèµ„æ–™

- [aiohttpæ€§èƒ½ä¼˜åŒ–æŒ‡å—](https://docs.aiohttp.org/en/stable/)
- [Pythonå¼‚æ­¥ç¼–ç¨‹æœ€ä½³å®žè·µ](https://docs.python.org/3/library/asyncio.html)
- [Webæ€§èƒ½æµ‹è¯•æ–¹æ³•è®º](https://web.dev/performance/)
- [MCPåè®®è§„èŒƒ](https://modelcontextprotocol.io/)

---

*æœ€åŽæ›´æ–°: 2024å¹´6æœˆ*