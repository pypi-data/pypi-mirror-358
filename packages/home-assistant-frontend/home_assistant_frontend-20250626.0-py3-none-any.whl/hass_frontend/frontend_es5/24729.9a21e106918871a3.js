"use strict";(self.webpackChunkhome_assistant_frontend=self.webpackChunkhome_assistant_frontend||[]).push([["24729"],{10388:function(t,e,n){n.a(t,async function(t,i){try{n.r(e),n.d(e,{computeStateDisplay:function(){return _},computeStateDisplayFromEntityAttributes:function(){return m}});n(39710),n(87799),n(56389);var s=n(16230),r=n(38763),o=n(93836),a=n(40142),c=n(74266),u=n(45691),l=n(28598),h=n(27417),d=n(44272),f=t([o,l,a,u,c]);[o,l,a,u,c]=f.then?(await f)():f;const _=(t,e,n,i,s,r,o)=>{const a=null==r?void 0:r[e.entity_id];return m(t,n,i,s,a,e.entity_id,e.attributes,void 0!==o?o:e.state)},m=(t,e,n,i,f,_,m,b)=>{if(b===s.lz||b===s.nZ)return t(`state.default.${b}`);const y=(0,d.M)(_),p="counter"===y||"number"===y||"input_number"===y;if((0,l.sJ)(m,"sensor"===y?n:[])||p){if("duration"===m.device_class&&m.unit_of_measurement&&o.a_.includes(m.unit_of_measurement))try{return(0,o.LU)(e,b,m.unit_of_measurement,null==f?void 0:f.display_precision)}catch(v){}if("monetary"===m.device_class)try{return(0,l.uf)(b,e,Object.assign({style:"currency",currency:m.unit_of_measurement,minimumFractionDigits:2},(0,l.l4)({state:b,attributes:m},f)))}catch(v){}const n=(0,l.uf)(b,e,(0,l.l4)({state:b,attributes:m},f)),i=(null==f?void 0:f.translation_key)&&t(`component.${f.platform}.entity.${y}.${f.translation_key}.unit_of_measurement`)||m.unit_of_measurement;return i?`${n}${(0,h.L)(i,e)}${i}`:n}if(["date","input_datetime","time"].includes(y))try{const t=b.split(" ");if(2===t.length)return(0,c.o0)(new Date(t.join("T")),Object.assign(Object.assign({},e),{},{time_zone:r.c_.local}),i);if(1===t.length){if(b.includes("-"))return(0,a.p6)(new Date(`${b}T00:00`),Object.assign(Object.assign({},e),{},{time_zone:r.c_.local}),i);if(b.includes(":")){const t=new Date;return(0,u.mr)(new Date(`${t.toISOString().split("T")[0]}T${b}`),Object.assign(Object.assign({},e),{},{time_zone:r.c_.local}),i)}}return b}catch(g){return b}if(["button","conversation","event","image","input_button","notify","scene","stt","tag","tts","wake_word","datetime"].includes(y)||"sensor"===y&&"timestamp"===m.device_class)try{return(0,c.o0)(new Date(b),e,i)}catch(v){return b}return(null==f?void 0:f.translation_key)&&t(`component.${f.platform}.entity.${y}.${f.translation_key}.state.${b}`)||m.device_class&&t(`component.${y}.entity_component.${m.device_class}.state.${b}`)||t(`component.${y}.entity_component._.state.${b}`)||b};i()}catch(_){i(_)}})},9224:function(t,e,n){n.d(e,{H:function(){return i}});var i=5},89166:function(t,e,n){n.a(t,async function(t,i){try{n.d(e,{Nu:function(){return O},V3:function(){return H},Vk:function(){return d},YA:function(){return j},xS:function(){return _},zP:function(){return Z}});n(39710),n(26847),n(2394),n(18574),n(73042),n(81738),n(94814),n(29981),n(22960),n(6989),n(72489),n(87799),n(56303),n(67886),n(65451),n(46015),n(38334),n(94880),n(75643),n(29761),n(56389),n(27530);var s=n(44272),r=n(10388),o=n(15459),a=t([r]);r=(a.then?(await a)():a)[0];const c=["climate","humidifier","water_heater"],u=["climate","humidifier","input_datetime","water_heater","person","device_tracker"],l=["temperature","current_temperature","target_temp_low","target_temp_high","hvac_action","humidity","mode","action","current_humidity"],h=(t,e)=>!t.states[e]||u.includes((0,s.M)(e)),d=(t,e,n,i,s)=>{const r={type:"history/stream",entity_ids:s,start_time:n.toISOString(),end_time:i.toISOString(),minimal_response:!0,no_attributes:!s.some(e=>h(t,e))},o=new f(t);return t.connection.subscribeMessage(t=>e(o.processMessage(t)),r)};class f{processMessage(t){if(!this.combinedHistory||!Object.keys(this.combinedHistory).length)return this.combinedHistory=t.states,this.combinedHistory;if(!Object.keys(t.states).length)return this.combinedHistory;const e=this.hoursToShow?((new Date).getTime()-3600*this.hoursToShow*1e3)/1e3:void 0,n={};for(const i of Object.keys(this.combinedHistory))n[i]=[];for(const i of Object.keys(t.states))n[i]=[];for(const i of Object.keys(n)){if(i in this.combinedHistory&&i in t.states){const e=this.combinedHistory[i],s=e[e.length-1];n[i]=e.concat(t.states[i]),t.states[i][0].lu<s.lu&&(n[i]=n[i].sort((t,e)=>t.lu-e.lu))}else i in this.combinedHistory?n[i]=this.combinedHistory[i]:n[i]=t.states[i];if(e&&i in this.combinedHistory){const t=n[i].filter(t=>t.lu<e);if(!t.length)continue;if(n[i]=n[i].filter(t=>t.lu>=e),n[i].length&&n[i][0].lu===e)continue;const s=t[t.length-1];s.lu=e,n[i].unshift(s)}}return this.combinedHistory=n,this.combinedHistory}constructor(t,e){this.hass=t,this.hoursToShow=e,this.combinedHistory={}}}const _=(t,e,n,i,s,r=!0,o=!0)=>{const a={type:"history/stream",entity_ids:i,start_time:new Date((new Date).getTime()-3600*n*1e3).toISOString(),minimal_response:r,significant_changes_only:o,no_attributes:null!=s?s:!i.some(e=>h(t,e))},c=new f(t,n);return t.connection.subscribeMessage(t=>e(c.processMessage(t)),a)},m=(t,e)=>t.state===e.state&&(!t.attributes||!e.attributes||l.every(n=>t.attributes[n]===e.attributes[n])),b=(t,e,n,i,s,a,c)=>{const u=[],l=a[0];for(const o of a){if(u.length>0&&o.s===u[u.length-1].state)continue;const a={};null!=c&&c.attributes.device_class&&(a.device_class=null==c?void 0:c.attributes.device_class),u.push({state_localize:(0,r.computeStateDisplayFromEntityAttributes)(t,e,[],n,i[s],s,Object.assign(Object.assign({},o.a||l.a),a),o.s),state:o.s,last_changed:1e3*(o.lc?o.lc:o.lu)})}return{name:(0,o.a)(s,(null==c?void 0:c.attributes)||l.a),entity_id:s,data:u}},y=(t,e,n,i)=>{const r=[];return Object.keys(n).forEach(t=>{const e=n[t],a=e[0],u=(0,s.M)(t),h=[];for(const n of e){let t;if(c.includes(u)){t={state:n.s,last_changed:1e3*n.lu,attributes:{}};for(const e of l)e in n.a&&(t.attributes[e]=n.a[e])}else t={state:n.s,last_changed:1e3*(n.lc?n.lc:n.lu),attributes:{}};h.length>1&&m(t,h[h.length-1])&&m(t,h[h.length-2])||h.push(t)}const d=t in i?i[t].attributes:"friendly_name"in a.a?a.a:void 0;r.push({domain:u,name:(0,o.a)(t,d||{}),entity_id:t,states:h})}),{unit:t,device_class:e,identifier:Object.keys(n).join(""),data:r}},p=["counter","input_number","number"],v=t=>p.includes(t),g=t=>"unit_of_measurement"in t||"state_class"in t,w=(t,e)=>null!=t.attributes.device_class&&e.includes(t.attributes.device_class),k=" ",j=(t,e,n,i,s=!1)=>{const r={};n.forEach(t=>{t in e&&(r[t]=e[t])});const o={};Object.entries(r).forEach(([t,e])=>{const n=e.map(t=>({s:null!=t.mean?t.mean.toString():t.state.toString(),lc:t.start/1e3,a:{},lu:t.start/1e3}));o[t]=n});const a=O(t,o,[],t.localize,i,s,!0);return((null==a?void 0:a.line)||[]).forEach(t=>{t.data.forEach(t=>{t.statistics=t.states,t.states=[]})}),a},O=(t,e,n,i,r,o=!1,a=!1)=>{const c={},u=[],l={};if(new Set([...n,...Object.keys(e)]).forEach(n=>{n in e?l[n]=e[n]:t.states[n]&&(l[n]=[{s:t.states[n].state,a:t.states[n].attributes,lu:new Date(t.states[n].last_updated).getTime()/1e3}])}),!l)return{line:[],timeline:[]};Object.keys(l).forEach(e=>{var n;const h=l[e];if(0===h.length)return;const d=(0,s.M)(e),f=e in t.states?t.states[e]:void 0,_=f||v(d)?void 0:h.find(t=>t.a&&g(t.a));let m;m=Z(d,f,_,r,a)?(null==f?void 0:f.attributes.unit_of_measurement)||(null==_?void 0:_.a.unit_of_measurement)||k:{zone:i("ui.dialogs.more_info_control.zone.graph_unit"),climate:t.config.unit_system.temperature,humidifier:"%",water_heater:t.config.unit_system.temperature}[d];const y={climate:"temperature",humidifier:"humidity",water_heater:"temperature"}[d]||(null===(n=(null==f?void 0:f.attributes)||(null==_?void 0:_.a))||void 0===n?void 0:n.device_class),p=S(m,y,o);m?p&&p in c&&e in c[p]?c[p][e].push(...h):p&&(p in c||(c[p]={}),c[p][e]=h):u.push(b(i,t.locale,t.config,t.entities,e,h,f))});return{line:Object.keys(c).map(e=>{const n=e.split("_"),i=n[0],s=n[1]||void 0;return y(i,s,c[e],t.states)}),timeline:u}},S=(t,e,n)=>n?`${t}_${e||""}`:t,Z=(t,e,n,i,s=!1)=>s||v(t)||null!=e&&g(e.attributes)||null!=e&&"sensor"===t&&w(e,i)||null!=n,H=(t,e,n=!0)=>{if(!e)return t;const i=Object.assign(Object.assign({},t),{},{line:[]}),s={};for(const c of t.line){const t=S(c.unit,c.device_class,n);t&&(s[t]={historyItem:c})}for(const c of e.line){var r,o;if(c.unit===k)c.unit=null!==(r=null===(o=t.line.find(t=>t.identifier===c.identifier))||void 0===o?void 0:o.unit)&&void 0!==r?r:k;const e=S(c.unit,c.device_class,n);e&&(e in s?s[e].ltsItem=c:s[e]={ltsItem:c})}for(const{historyItem:c,ltsItem:u}of Object.values(s)){if(!c||!u){i.line.push(c||u);continue}const t=Object.assign(Object.assign({},c),{},{data:[]}),e=new Set([...c.data.map(t=>t.entity_id),...u.data.map(t=>t.entity_id)]);for(const n of e){var a;const e=c.data.find(t=>t.entity_id===n),i=u.data.find(t=>t.entity_id===n);if(!e||!i){t.data.push(e||i);continue}const s=(null===(a=e.states[0])||void 0===a?void 0:a.last_changed)||i.statistics[i.statistics.length-1].last_changed+1,r=[];for(const t of i.statistics){if(t.last_changed>=s)break;r.push(t)}t.data.push(0===r.length?e:Object.assign(Object.assign({},e),{},{statistics:r}))}i.line.push(t)}return i};i()}catch(c){i(c)}})},13814:function(t,e,n){n.d(e,{g:function(){return c}});var i=n(42385),s=(n(25518),n(24819),n(2394),n(44438),n(81738),n(94814),n(22960),n(6989),n(93190),n(96821),n(99233),n(54480),n(15519),n(56303),n(67398),n(9224)),r=function(t){return t.reduce(function(t,e){return t+parseFloat(e.state)},0)/t.length},o=function(t){return parseFloat(t[t.length-1].state)||0},a=function(t,e,n,a,c){t.forEach(function(t){t.state=Number(t.state)}),t=t.filter(function(t){return!Number.isNaN(t.state)});var u=void 0!==(null==c?void 0:c.min)?c.min:Math.min.apply(Math,(0,i.Z)(t.map(function(t){return t.state}))),l=void 0!==(null==c?void 0:c.max)?c.max:Math.max.apply(Math,(0,i.Z)(t.map(function(t){return t.state}))),h=(new Date).getTime(),d=function(t,n,i){var s=h-new Date(n.last_changed).getTime(),r=Math.abs(s/36e5-e);return i?(r=60*(r-Math.floor(r)),r=Number((10*Math.round(r/10)).toString()[0])):r=Math.floor(r),t[r]||(t[r]=[]),t[r].push(n),t};if(t=t.reduce(function(t,e){return d(t,e,!1)},[]),a>1&&(t=t.map(function(t){return t.reduce(function(t,e){return d(t,e,!0)},[])})),t.length)return function(t,e,n,i,a,c){var u=[],l=(c-a)/80;l=0!==l?l:80;var h=n/(e-(1===i?1:0));h=isFinite(h)?h:n;var d=t.filter(Boolean)[0];i>1&&(d=d.filter(Boolean)[0]);for(var f=[r(d),o(d)],_=function(t){return 80+s.H/2-(t-a)/l},m=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;if(i>1&&t)return t.forEach(function(t,n){return m(t,e,n,i-1)});var s=h*(e+n/6);t&&(f=[r(t),o(t)]);var a=_(t?f[0]:f[1]);return u.push([s,a])},b=0;b<t.length;b+=1)m(t[b],b,0,i);return u.push([n,_(f[1])]),u}(t,e,n,a,u,l)},c=function(t,e,n,i,s){if(t){var r=t.map(function(t){return{state:Number(t.s),last_changed:1e3*t.lu}});return a(r,e,n,i,s)}}},88809:function(t,e,n){var i,s,r,o,a=n(54982),c=n(54521),u=n(4490),l=n(20129),h=n(85297),d=n(73742),f=n(59048),_=n(7616),m=n(9224),b=n(75706),y=(n(12212),n(25518),n(81738),n(94814),n(54480),function(t,e,n,i){return[(t-n)/2+n,(e-i)/2+i]}),p=function(t){function e(){return(0,c.Z)(this,e),(0,l.Z)(this,e,arguments)}return(0,h.Z)(e,t),(0,u.Z)(e,[{key:"render",value:function(){return(0,f.dy)(i||(i=(0,a.Z)([" "," "])),this._path?(0,f.YP)(s||(s=(0,a.Z)(['<svg width="100%" height="100%" viewBox="0 0 500 100"> <g> <mask id="fill"> <path class="fill" fill="white" d="',' L 500, 100 L 0, 100 z"/> </mask> <rect height="100%" width="100%" id="fill-rect" fill="var(--accent-color)" mask="url(#fill)"></rect> <mask id="line"> <path fill="none" stroke="var(--accent-color)" stroke-width="','" stroke-linecap="round" stroke-linejoin="round" d="','"></path> </mask> <rect height="100%" width="100%" id="rect" fill="var(--accent-color)" mask="url(#line)"></rect> </g> </svg>'])),this._path,m.H,this._path):(0,f.YP)(r||(r=(0,a.Z)(['<svg width="100%" height="100%" viewBox="0 0 500 100"></svg>']))))}},{key:"willUpdate",value:function(t){this.coordinates&&t.has("coordinates")&&(this._path=function(t){if(!t.length)return"";var e,n,i="",s=t.filter(Boolean)[0];i+="M ".concat(s[0],",").concat(s[1]);var r,o=(0,b.Z)(t);try{for(o.s();!(r=o.n()).done;)e=r.value,n=y(s[0],s[1],e[0],e[1]),i+=" ".concat(n[0],",").concat(n[1]),i+=" Q".concat(e[0],",").concat(e[1]),s=e}catch(a){o.e(a)}finally{o.f()}return i+" ".concat(e[0],",").concat(e[1])}(this.coordinates))}}])}(f.oi);p.styles=(0,f.iv)(o||(o=(0,a.Z)([":host{display:flex;width:100%}.fill{opacity:.1}"]))),(0,d.__decorate)([(0,_.Cb)()],p.prototype,"coordinates",void 0),(0,d.__decorate)([(0,_.SB)()],p.prototype,"_path",void 0),p=(0,d.__decorate)([(0,_.Mo)("hui-graph-base")],p)},8833:function(t,e,n){n.a(t,async function(t,i){try{n.r(e),n.d(e,{HuiGraphHeaderFooter:function(){return $}});var s,r,o,a,c,u=n(29694),l=n(75778),h=n(42385),d=n(54982),f=n(54521),_=n(4490),m=n(20129),b=n(53389),y=n(85297),p=(n(40777),n(39710),n(26847),n(96821),n(87799),n(54480),n(1455),n(48694),n(27530),n(73742)),v=n(59048),g=n(7616),w=n(37528),k=n(44272),j=n(6514),O=n(89166),S=n(45063),Z=n(13814),H=(n(88809),t([j,O]));[j,O]=H.then?(await H)():H;var M=["counter","input_number","number","sensor"],$=function(t){function e(){return(0,f.Z)(this,e),(0,m.Z)(this,e,arguments)}return(0,y.Z)(e,t),(0,_.Z)(e,[{key:"getCardSize",value:function(){return 3}},{key:"setConfig",value:function(t){if(null==t||!t.entity||!M.includes((0,k.M)(t.entity)))throw new Error("Specify an entity from within the sensor domain");var e=Object.assign({detail:1,hours_to_show:24},t);e.hours_to_show=Number(e.hours_to_show),e.detail=1===e.detail||2===e.detail?e.detail:1,this._config=e}},{key:"render",value:function(){return this._config&&this.hass?this._error?(0,v.dy)(s||(s=(0,d.Z)(['<div class="errors">',"</div>"])),this._error):this._coordinates?this._coordinates.length?(0,v.dy)(a||(a=(0,d.Z)([' <hui-graph-base .coordinates="','"></hui-graph-base> '])),this._coordinates):(0,v.dy)(o||(o=(0,d.Z)([' <div class="container"> <div class="info">No state history found.</div> </div> ']))):(0,v.dy)(r||(r=(0,d.Z)([' <div class="container"> <ha-spinner size="small"></ha-spinner> </div> ']))):v.Ld}},{key:"connectedCallback",value:function(){(0,b.Z)(e,"connectedCallback",this,3)([]),this.hasUpdated&&this._config&&this._subscribeHistory()}},{key:"disconnectedCallback",value:function(){(0,b.Z)(e,"disconnectedCallback",this,3)([]),this._unsubscribeHistory()}},{key:"_subscribeHistory",value:function(){var t=this;(0,w.p)(this.hass,"history")&&!this._subscribed&&this._config&&(this._subscribed=(0,O.xS)(this.hass,function(e){t._subscribed&&t._config&&(t._coordinates=(0,Z.g)(e[t._config.entity],t._config.hours_to_show,500,t._config.detail,t._config.limits)||[])},this._config.hours_to_show,[this._config.entity]).catch(function(e){t._subscribed=void 0,t._error=e}),this._setRedrawTimer())}},{key:"_redrawGraph",value:function(){this._coordinates&&(this._coordinates=(0,h.Z)(this._coordinates))}},{key:"_setRedrawTimer",value:function(){var t=this;clearInterval(this._interval),this._interval=window.setInterval(function(){return t._redrawGraph()},this._config.hours_to_show>24?36e5:6e4)}},{key:"_unsubscribeHistory",value:function(){clearInterval(this._interval),this._subscribed&&(this._subscribed.then(function(t){return null==t?void 0:t()}),this._subscribed=void 0)}},{key:"updated",value:function(t){if(this._config&&this.hass&&t.has("_config")){var e=t.get("_config");e&&this._subscribed&&e.entity===this._config.entity||(this._unsubscribeHistory(),this._subscribeHistory())}}}],[{key:"getConfigElement",value:(i=(0,l.Z)((0,u.Z)().m(function t(){return(0,u.Z)().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,Promise.all([n.e("73614"),n.e("11730"),n.e("15634"),n.e("26452"),n.e("16376"),n.e("2769"),n.e("19596"),n.e("88930")]).then(n.bind(n,65697));case 1:return t.a(2,document.createElement("hui-graph-footer-editor"))}},t)})),function(){return i.apply(this,arguments)})},{key:"getStubConfig",value:function(t,e,n){return{type:"graph",entity:(0,S.j)(t,1,e,n,M,function(t){return!isNaN(Number(t.state))&&!!t.attributes.unit_of_measurement})[0]||""}}}]);var i}(v.oi);$.styles=(0,v.iv)(c||(c=(0,d.Z)(["ha-spinner{position:absolute;top:calc(50% - 14px)}.container{display:flex;justify-content:center;position:relative;padding-bottom:20%}.info{position:absolute;top:calc(50% - 16px);color:var(--secondary-text-color)}"]))),(0,p.__decorate)([(0,g.Cb)({attribute:!1})],$.prototype,"hass",void 0),(0,p.__decorate)([(0,g.Cb)()],$.prototype,"type",void 0),(0,p.__decorate)([(0,g.SB)()],$.prototype,"_config",void 0),(0,p.__decorate)([(0,g.SB)()],$.prototype,"_coordinates",void 0),$=(0,p.__decorate)([(0,g.Mo)("hui-graph-header-footer")],$),i()}catch(D){i(D)}})}}]);
//# sourceMappingURL=24729.9a21e106918871a3.js.map