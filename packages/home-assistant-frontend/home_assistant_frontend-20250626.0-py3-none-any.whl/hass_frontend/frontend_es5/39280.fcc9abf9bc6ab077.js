"use strict";(self.webpackChunkhome_assistant_frontend=self.webpackChunkhome_assistant_frontend||[]).push([["39280"],{44548:function(t,e,r){r.a(t,async function(t,o){try{r.d(e,{AH:function(){return b},Ai:function(){return w},Al:function(){return A},vA:function(){return v}});var n=r(26306),a=r(34635),s=r(73228),i=r(11736),c=r(59085),l=r(46021),_=r(56858),u=r(7722),f=r(21343),g=r(29426),y=r(72937),d=r(27537),m=r(38763),h=t([d]);d=(h.then?(await h)():h)[0];var p=function(t,e,r,o){var n=r((0,d.zW)(t,e),o);return n instanceof Date?(0,d.Nm)(n,e):n},b=function(t,e,r,o,n){return r.time_zone===m.c_.server?p(t,o.time_zone,e,n):e(t,n)},v=function(t,e,r,o,n){return r.time_zone===m.c_.server?p(t,o.time_zone,e,n):e(t,n)},w=function(t,e,r,o,n){return v(t,r,o,n,o.time_zone===m.c_.server?(0,d.zW)(e,n.time_zone):e)},A=function(t,e,r,o,d){var m,h;if(v(t,n.b,o,d)&&v(e,a.h,o,d)){var p=(w(e,t,s.d,o,d)+1)*(r?1:-1);m=b(t,i.z,o,d,p),h=b(b(e,i.z,o,d,p),c.V,o,d)}else if(v(t,function(t){return(0,l.b)(t).getMilliseconds()===t.getMilliseconds()},o,d)&&v(e,function(t){return(0,_.i)(t).getMilliseconds()===t.getMilliseconds()},o,d)){var A=(w(e,t,u.j,o,d)+1)*(r?1:-1);m=b(t,f.E,o,d,A),h=b(e,f.E,o,d,A)}else{var H=(w(e,t,g._,o,d)+1)*(r?1:-1);m=b(t,y.n,o,d,H),h=b(e,y.n,o,d,H)}return{start:m,end:h}};o()}catch(H){o(H)}})},97711:function(t,e,r){r.a(t,async function(t,o){try{r.d(e,{p:function(){return w}});var n=r(46021),a=r(56858),s=r(21343),i=r(66233),c=r(90964),l=r(98853),_=r(59085),u=r(40635),f=r(66297),g=r(2061),y=r(68503),d=r(25025),m=r(20215),h=r(38039),p=r(44548),b=r(34302),v=t([b,p]);[b,p]=v.then?(await v)():v;var w=function(t,e){var r=new Date,o=(0,b.Bt)(t.locale);switch(e){case"today":return[(0,p.AH)(r,n.b,t.locale,t.config,{weekStartsOn:o}),(0,p.AH)(r,a.i,t.locale,t.config,{weekStartsOn:o})];case"yesterday":return[(0,p.AH)((0,s.E)(r,-1),n.b,t.locale,t.config,{weekStartsOn:o}),(0,p.AH)((0,s.E)(r,-1),a.i,t.locale,t.config,{weekStartsOn:o})];case"this_week":return[(0,p.AH)(r,i.z,t.locale,t.config,{weekStartsOn:o}),(0,p.AH)(r,c.v,t.locale,t.config,{weekStartsOn:o})];case"this_month":return[(0,p.AH)(r,l.N,t.locale,t.config),(0,p.AH)(r,_.V,t.locale,t.config)];case"this_quarter":return[(0,p.AH)(r,u.x,t.locale,t.config),(0,p.AH)(r,f.x,t.locale,t.config)];case"this_year":return[(0,p.AH)(r,g.e,t.locale,t.config),(0,p.AH)(r,y.w,t.locale,t.config)];case"now-7d":return[(0,p.AH)(r,d.k,t.locale,t.config,7),(0,p.AH)(r,d.k,t.locale,t.config,0)];case"now-30d":return[(0,p.AH)(r,d.k,t.locale,t.config,30),(0,p.AH)(r,d.k,t.locale,t.config,0)];case"now-12m":return[(0,p.AH)((0,m.W)(r,12),l.N,t.locale,t.config),(0,p.AH)((0,m.W)(r,1),_.V,t.locale,t.config)];case"now-1h":return[(0,p.AH)(r,h.b,t.locale,t.config,1),(0,p.AH)(r,h.b,t.locale,t.config,0)];case"now-12h":return[(0,p.AH)(r,h.b,t.locale,t.config,12),(0,p.AH)(r,h.b,t.locale,t.config,0)];case"now-24h":return[(0,p.AH)(r,h.b,t.locale,t.config,24),(0,p.AH)(r,h.b,t.locale,t.config,0)]}return[r,r]};o()}catch(A){o(A)}})},64564:function(t,e,r){r.d(e,{v:function(){return n}});var o=r(75706),n=(r(2394),function(t,e){var r,n={},a=(0,o.Z)(t);try{for(a.s();!(r=a.n()).done;){var s=r.value,i=e(s);i in n?n[i].push(s):n[i]=[s]}}catch(c){a.e(c)}finally{a.f()}return n})},6640:function(t,e,r){r.a(t,async function(t,o){try{r.d(e,{Bm:function(){return k},Cj:function(){return W},E4:function(){return Q},EH:function(){return U},G9:function(){return $},Jj:function(){return P},KU:function(){return D},P:function(){return E},ST:function(){return Y},UB:function(){return K},ZC:function(){return j},_Z:function(){return x},b:function(){return G},gy:function(){return O},iK:function(){return T},jB:function(){return N},kJ:function(){return J},mt:function(){return tt},o1:function(){return M},rl:function(){return S},vE:function(){return q},xZ:function(){return C},yH:function(){return Z}});r(40777),r(39710),r(26847),r(2394),r(18574),r(81738),r(22960),r(6989),r(87799),r(1455),r(67886),r(65451),r(46015),r(38334),r(94880),r(75643),r(29761),r(56389),r(44261),r(27530);var n=r(7722),a=r(26306),s=r(34635),i=r(11736),c=r(73228),l=r(21343),_=r(72937),u=r(46021),f=r(56858),g=r(46363),y=r(5657),d=r(28105),m=r(44548),h=r(45691),p=r(64564),b=r(7214),v=r(97711),w=r(28598),A=t([h,v,m,w]);[h,v,m,w]=A.then?(await A)():A;const H=[],k=()=>({stat_energy_from:"",stat_cost:null,entity_energy_price:null,number_energy_price:null}),M=()=>({stat_energy_to:"",stat_compensation:null,entity_energy_price:null,number_energy_price:null}),T=()=>({type:"grid",flow_from:[],flow_to:[],cost_adjustment_day:0}),S=()=>({type:"solar",stat_energy_from:"",config_entry_solar_forecast:null}),E=()=>({type:"battery",stat_energy_from:"",stat_energy_to:""}),D=()=>({type:"gas",stat_energy_from:"",stat_cost:null,entity_energy_price:null,number_energy_price:null}),W=()=>({type:"water",stat_energy_from:"",stat_cost:null,entity_energy_price:null,number_energy_price:null}),C=t=>t.callWS({type:"energy/info"}),O=async t=>(await t.loadBackendTranslation("issues","energy"),t.callWS({type:"energy/validate"})),j=t=>t.callWS({type:"energy/get_prefs"}),x=async(t,e)=>{const r=t.callWS(Object.assign({type:"energy/save_prefs"},e));return B(t),r},z=async(t,e,r,o,n,a="hour")=>t.callWS({type:"energy/fossil_energy_consumption",start_time:e.toISOString(),end_time:null==n?void 0:n.toISOString(),energy_statistic_ids:r,co2_statistic_id:o,period:a}),P=t=>(0,p.v)(t.energy_sources,t=>t.type),Z=(t,e,r)=>{const o=[];for(const n of t.energy_sources)if(!r||r.includes(n.type))if("solar"!==n.type){if("gas"===n.type||"water"===n.type){o.push(n.stat_energy_from),n.stat_cost&&o.push(n.stat_cost);const t=e.cost_sensors[n.stat_energy_from];t&&o.push(t);continue}if("battery"!==n.type){for(const t of n.flow_from){o.push(t.stat_energy_from),t.stat_cost&&o.push(t.stat_cost);const r=e.cost_sensors[t.stat_energy_from];r&&o.push(r)}for(const t of n.flow_to){o.push(t.stat_energy_to),t.stat_compensation&&o.push(t.stat_compensation);const r=e.cost_sensors[t.stat_energy_to];r&&o.push(r)}}else o.push(n.stat_energy_from),o.push(n.stat_energy_to)}else o.push(n.stat_energy_from);return r&&!r.includes("device")||o.push(...t.device_consumption.map(t=>t.stat_consumption)),o},L=async(t,e,r,o,u)=>{const f=await C(t);let g;for(const n of Object.values(t.entities)){if("co2signal"!==n.platform)continue;const e=t.states[n.entity_id];if(e&&"%"===e.attributes.unit_of_measurement){g=e.entity_id;break}}const y=[];for(const n of e.energy_sources)if("grid"===n.type)for(const t of n.flow_from)y.push(t.stat_energy_from);const d=Z(e,f,["grid","solar","battery","gas","device"]),h=Z(e,f,["water"]),p=[...d,...h],v=(0,n.j)(o||new Date,r),w=(0,a.b)(r)&&(!o||(0,s.h)(o))&&v>35?"month":v>2?"day":"hour",A=t.config.unit_system.length||"",H={energy:"kWh",volume:"km"===A?"m続":"ft続"},k={volume:"km"===A?"L":"gal"},M=d.length?(0,b.dL)(t,r,o,d,w,H,["change"]):{},T=h.length?(0,b.dL)(t,r,o,h,w,k,["change"]):{};let S,E,D,W,O,j={},x={};u&&(E=(0,m.vA)(r,a.b,t.locale,t.config)&&(0,m.vA)(o||new Date,s.h,t.locale,t.config)?(0,m.AH)(r,i.z,t.locale,t.config,-(0,m.Ai)(o||new Date,r,c.d,t.locale,t.config)-1):(0,m.AH)(r,l.E,t.locale,t.config,-1*(v+1)),D=(0,_.n)(r,-1),d.length&&(j=(0,b.dL)(t,E,D,d,w,H,["change"])),h.length&&(x=(0,b.dL)(t,E,D,h,w,k,["change"]))),void 0!==g&&(W=z(t,r,y,g,o,v>35?"month":v>2?"day":"hour"),u&&(O=z(t,E,y,g,D,v>35?"month":v>2?"day":"hour")));const P={},L=p.length?(0,b.Py)(t,p):[],[B,I,K,N,V,$,q]=await Promise.all([M,T,j,x,L,W,O]),G=Object.assign(Object.assign({},B),I);u&&(S=Object.assign(Object.assign({},K),N)),p.length&&V.forEach(t=>{P[t.statistic_id]=t});return{start:r,end:o,startCompare:E,endCompare:D,info:f,prefs:e,stats:G,statsMetadata:P,statsCompare:S,co2SignalEntity:g,fossilEnergyConsumption:$,fossilEnergyConsumptionCompare:q}},B=t=>{H.forEach(e=>{const r=K(t,{key:e});r.clearPrefs(),r._active&&r.refresh()})},I=t=>{if(t._refreshTimeout&&clearTimeout(t._refreshTimeout),t._active&&(!t.end||t.end>new Date)){const e=new Date;e.getMinutes()>=20&&e.setHours(e.getHours()+1),e.setMinutes(20,0,0),t._refreshTimeout=window.setTimeout(()=>t.refresh(),e.getTime()-Date.now())}},K=(t,e={})=>{let r="_energy";if(e.key){if(!e.key.startsWith("energy_"))throw new Error("Key need to start with energy_");r=`_${e.key}`}if(t.connection[r])return t.connection[r];H.push(e.key);const o=(0,y._)(t.connection,r,async()=>(o.prefs||(o.prefs=await j(t)),I(o),L(t,o.prefs,o.start,o.end,o.compare))),n=o.subscribe;o.subscribe=t=>{const e=n(t);return o._active++,void 0===o._refreshTimeout&&I(o),()=>{o._active--,o._active<1&&(clearTimeout(o._refreshTimeout),o._refreshTimeout=void 0),e()}},o._active=0,o.prefs=e.prefs;const a=new Date,s=(0,h.Zs)(a,t.locale,t.config).split(":")[0],i=localStorage.getItem(`energy-default-period-${r}`)||"today",c="today"===i&&"0"===s?"yesterday":i,[l,_]=(0,v.p)(t,c);o.start=(0,m.AH)(l,u.b,t.locale,t.config),o.end=(0,m.AH)(_,f.i,t.locale,t.config);const d=()=>{o._updatePeriodTimeout=window.setTimeout(()=>{o.start=(0,m.AH)(new Date,u.b,t.locale,t.config),o.end=(0,m.AH)(new Date,f.i,t.locale,t.config),d()},(0,g.T)((0,m.AH)(new Date,f.i,t.locale,t.config),1).getTime()-Date.now())};return d(),o.clearPrefs=()=>{o.prefs=void 0},o.setPeriod=(e,r)=>{var n;o._updatePeriodTimeout&&(clearTimeout(o._updatePeriodTimeout),o._updatePeriodTimeout=void 0),o.start=e,o.end=r,o.start.getTime()===(0,m.AH)(new Date,u.b,t.locale,t.config).getTime()&&(null===(n=o.end)||void 0===n?void 0:n.getTime())===(0,m.AH)(new Date,f.i,t.locale,t.config).getTime()&&d()},o.setCompare=t=>{o.compare=t},o},N=t=>t.callWS({type:"energy/solar_forecast"}),V=["volume","energy"],$=(t,e,r={})=>{for(const o of t.energy_sources){if("gas"!==o.type)continue;if(e&&e===o.stat_energy_from)continue;const t=r[o.stat_energy_from];if(V.includes(null==t?void 0:t.unit_class))return t.unit_class}},q=(t,e,r={})=>"energy"===$(e,void 0,r)?"kWh":"km"===t.config.unit_system.length?"m続":"ft続",G=t=>"km"===t.config.unit_system.length?"L":"gal",J="/docs/energy/faq/#troubleshooting-missing-entities",U=(0,d.Z)(t=>({summedData:F(t),compareSummedData:t.statsCompare?F(t,!0):void 0})),F=(t,e)=>{const r={};for(const a of t.prefs.energy_sources)if("solar"!==a.type)if("battery"!==a.type){if("grid"===a.type){for(const t of a.flow_from)r.from_grid?r.from_grid.push(t.stat_energy_from):r.from_grid=[t.stat_energy_from];for(const t of a.flow_to)r.to_grid?r.to_grid.push(t.stat_energy_to):r.to_grid=[t.stat_energy_to]}}else r.to_battery?(r.to_battery.push(a.stat_energy_to),r.from_battery.push(a.stat_energy_from)):(r.to_battery=[a.stat_energy_to],r.from_battery=[a.stat_energy_from]);else r.solar?r.solar.push(a.stat_energy_from):r.solar=[a.stat_energy_from];const o={total:{},timestamps:[]},n=new Set;return Object.entries(r).forEach(([r,a])=>{const s={},i={};let c=0;a.forEach(r=>{const o=e?t.statsCompare[r]:t.stats[r];if(!o)return;o.forEach(t=>{if(null===t.change||void 0===t.change)return;const e=t.change;c+=e,s[t.start]=t.start in s?s[t.start]+e:e,n.add(t.start)}),i[r]={}}),o[r]=s,o.total[r]=c}),o.timestamps=Array.from(n).sort(),o},Q=(0,d.Z)((t,e)=>({consumption:R(t),compareConsumption:e?R(e):void 0})),R=t=>{const e={used_total:{},grid_to_battery:{},battery_to_grid:{},solar_to_battery:{},solar_to_grid:{},used_solar:{},used_grid:{},used_battery:{},total:{used_total:0,grid_to_battery:0,battery_to_grid:0,solar_to_battery:0,solar_to_grid:0,used_solar:0,used_grid:0,used_battery:0}};return t.timestamps.forEach(r=>{var o,n,a,s,i;const{grid_to_battery:c,battery_to_grid:l,used_solar:_,used_grid:u,used_battery:f,used_total:g,solar_to_battery:y,solar_to_grid:d}=X({from_grid:t.from_grid&&(null!==(o=t.from_grid[r])&&void 0!==o?o:0),to_grid:t.to_grid&&(null!==(n=t.to_grid[r])&&void 0!==n?n:0),solar:t.solar&&(null!==(a=t.solar[r])&&void 0!==a?a:0),to_battery:t.to_battery&&(null!==(s=t.to_battery[r])&&void 0!==s?s:0),from_battery:t.from_battery&&(null!==(i=t.from_battery[r])&&void 0!==i?i:0)});e.used_total[r]=g,e.total.used_total+=g,e.grid_to_battery[r]=c,e.total.grid_to_battery+=c,e.battery_to_grid[r]=l,e.total.battery_to_grid+=l,e.used_battery[r]=f,e.total.used_battery+=f,e.used_grid[r]=u,e.total.used_grid+=u,e.used_solar[r]=_,e.total.used_solar+=_,e.solar_to_battery[r]=y,e.total.solar_to_battery+=y,e.solar_to_grid[r]=d,e.total.solar_to_grid+=d}),e},X=t=>{let e=Math.max(t.to_grid||0,0),r=Math.max(t.to_battery||0,0),o=Math.max(t.solar||0,0),n=Math.max(t.from_grid||0,0),a=Math.max(t.from_battery||0,0);const s=(n||0)+(o||0)+(a||0)-(e||0)-(r||0);let i=0,c=0,l=0,_=0,u=0,f=0,g=0,y=Math.max(s,0);const d=Math.max(0,Math.min(r,n-y));c+=d,r-=d,n-=d,_=Math.min(o,r),r-=_,o-=_,u=Math.min(o,e),e-=u,o-=u,l=Math.min(a,e),a-=l,e-=l;const m=Math.min(n,r);return c+=m,n-=m,r-=m,i=Math.min(y,o),y-=i,o-=i,f=Math.min(a,y),a-=f,y-=f,g=Math.min(y,n),n-=g,y-=n,{used_solar:i,used_grid:g,used_battery:f,used_total:s,grid_to_battery:c,battery_to_grid:l,solar_to_battery:_,solar_to_grid:u}},Y=(t,e,r)=>{if(!e)return`0 ${r}`;const o=["Wh","kWh","MWh","GWh","TWh"];let n=r,a=e,s=o.findIndex(t=>t===r);if(s>=0){for(;Math.abs(a)<1&&s>0;)a*=1e3,s--;for(;Math.abs(a)>=1e3&&s<o.length-1;)a/=1e3,s++;n=o[s]}return(0,w.uf)(a,t.locale,{maximumFractionDigits:Math.abs(a)<10?2:Math.abs(a)<100?1:0})+" "+n},tt=(t,e)=>{if(!e.total.solar)return;const{consumption:r,compareConsumption:o}=Q(e,void 0);if(!t){const t=e.total.solar;return r.total.used_solar/t*100}let n=0,a=0;const s=[];e.timestamps.forEach(t=>{var e,o,i,c;n+=null!==(e=r.used_solar[t])&&void 0!==e?e:0,a+=null!==(o=r.solar_to_grid[t])&&void 0!==o?o:0,r.grid_to_battery[t]&&s.push({type:"grid",value:r.grid_to_battery[t]}),r.solar_to_battery[t]&&s.push({type:"solar",value:r.solar_to_battery[t]});let l=null!==(i=r.battery_to_grid[t])&&void 0!==i?i:0,_=null!==(c=r.used_battery[t])&&void 0!==c?c:0;const u=function(t){const e=s[s.length-1],r=e.type;if(t>=e.value){const t=e.value;return s.pop(),{energy:t,type:r}}return e.value-=t,{energy:t,type:r}};for(;_>0&&s.length;){const{energy:t,type:e}=u(_);"solar"===e&&(n+=t),_-=t}for(;l>0&&s.length;){const{energy:t,type:e}=u(l);"solar"===e&&(a+=t),l-=t}});const i=n+a;return!!i?n/i*100:void 0};o()}catch(H){o(H)}})}}]);
//# sourceMappingURL=39280.fcc9abf9bc6ab077.js.map