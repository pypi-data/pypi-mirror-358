# main.py - –Ø–¥—Ä–æ MCP —Å–µ—Ä–≤–µ—Ä–∞

## üéØ –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–û—Å–Ω–æ–≤–Ω–æ–π –º–æ–¥—É–ª—å SuperDocs, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π —è–¥—Ä–æ MCP —Å–µ—Ä–≤–µ—Ä–∞ –∏ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–µ–π. –û—Ç–≤–µ—á–∞–µ—Ç –∑–∞ —Å–æ–∑–¥–∞–Ω–∏–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫—É —Å–µ—Ä–≤–µ—Ä–∞, —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é MCP –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤, –æ–±—Ä–∞–±–æ—Ç–∫—É –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏.

## üìã –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### 1. –¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö

#### DocSource
```python
class DocSource(TypedDict):
    name: NotRequired[str]        # –ò–º—è –∏—Å—Ç–æ—á–Ω–∏–∫–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
    llms_txt: str                 # URL –∏–ª–∏ –ø—É—Ç—å –∫ llms.txt —Ñ–∞–π–ª—É
    description: NotRequired[str] # –û–ø–∏—Å–∞–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
```

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –û–ø–∏—Å—ã–≤–∞–µ—Ç –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ —Å –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–º–∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏.

### 2. –£—Ç–∏–ª–∏—Ç–∞—Ä–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

#### extract_domain(url: str) -> str
```python
def extract_domain(url: str) -> str:
    """–ò–∑–≤–ª–µ–∫–∞–µ—Ç –¥–æ–º–µ–Ω –∏–∑ URL —Å –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–º –∏ —Å–ª–µ—à–µ–º"""
    parsed = urlparse(url)
    return f"{parsed.scheme}://{parsed.netloc}/"
```

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ù–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç URL –¥–ª—è —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è —Å–ø–∏—Å–∫–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö –¥–æ–º–µ–Ω–æ–≤.

#### _is_http_or_https(url: str) -> bool
```python
def _is_http_or_https(url: str) -> bool:
    """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ URL HTTP/HTTPS —Å—Å—ã–ª–∫–æ–π"""
    return url.startswith(("http:", "https:"))
```

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –†–∞–∑–ª–∏—á–∞–µ—Ç HTTP URL –æ—Ç –ª–æ–∫–∞–ª—å–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤.

#### _normalize_path(path: str) -> str
```python
def _normalize_path(path: str) -> str:
    """–ù–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç file:// URL –∏ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–µ –ø—É—Ç–∏ –∫ –∞–±—Å–æ–ª—é—Ç–Ω—ã–º"""
    return (
        os.path.abspath(path[7:])
        if path.startswith("file://")
        else os.path.abspath(path)
    )
```

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã –ø—É—Ç–µ–π –∫ –ª–æ–∫–∞–ª—å–Ω—ã–º —Ñ–∞–π–ª–∞–º.

### 3. –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–µ—Ä–≤–µ—Ä–∞

#### create_server() -> FastMCP
```python
def create_server(
    doc_sources: list[DocSource],
    *,
    follow_redirects: bool = False,
    timeout: float = 10,
    settings: dict | None = None,
    allowed_domains: list[str] | None = None,
) -> FastMCP
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**:
- `doc_sources`: –°–ø–∏—Å–æ–∫ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
- `follow_redirects`: –°–ª–µ–¥–æ–≤–∞—Ç—å –ª–∏ HTTP —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞–º
- `timeout`: –¢–∞–π–º–∞—É—Ç HTTP –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
- `settings`: –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ FastMCP
- `allowed_domains`: –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ –¥–æ–º–µ–Ω—ã

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç**: –ù–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä FastMCP —Å–µ—Ä–≤–µ—Ä–∞

## üõ†Ô∏è MCP –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã

### 1. list_doc_sources() -> str

**–û–ø–∏—Å–∞–Ω–∏–µ**: –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏.

**–õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã**:
1. –ü–µ—Ä–µ–±–∏—Ä–∞–µ—Ç –≤—Å–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –∏–∑ `doc_sources`
2. –†–∞–∑–ª–∏—á–∞–µ—Ç HTTP URL –∏ –ª–æ–∫–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã
3. –§–æ—Ä–º–∏—Ä—É–µ—Ç —á–∏—Ç–∞–µ–º—ã–π —Å–ø–∏—Å–æ–∫ —Å –∏–º–µ–Ω–∞–º–∏ –∏ –ø—É—Ç—è–º–∏
4. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—É—é —Å—Ç—Ä–æ–∫—É

**–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞**:
```
LangGraph
URL: https://langchain-ai.github.io/langgraph/llms.txt

LocalDocs
Path: /path/to/local/docs.txt
```

### 2. fetch_docs(url: str) -> str

**–û–ø–∏—Å–∞–Ω–∏–µ**: –ó–∞–≥—Ä—É–∂–∞–µ—Ç –∏ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –≤ Markdown —Ñ–æ—Ä–º–∞—Ç.

**–õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã –¥–ª—è –ª–æ–∫–∞–ª—å–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤**:
1. –ù–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É
2. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ —Ñ–∞–π–ª –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –±–µ–ª–æ–º —Å–ø–∏—Å–∫–µ
3. –ß–∏—Ç–∞–µ—Ç —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞
4. –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç –≤ Markdown —á–µ—Ä–µ–∑ `markdownify()`
5. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏–ª–∏ –æ—à–∏–±–∫—É

**–õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã –¥–ª—è HTTP URL**:
1. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –¥–æ–º–µ–Ω —Ä–∞–∑—Ä–µ—à–µ–Ω
2. –í—ã–ø–æ–ª–Ω—è–µ—Ç HTTP –∑–∞–ø—Ä–æ—Å —á–µ—Ä–µ–∑ `httpx_client`
3. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞
4. –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç HTML –≤ Markdown
5. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏–ª–∏ –æ—à–∏–±–∫—É

**–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**:
- –ü—Ä–æ–≤–µ—Ä–∫–∞ allowed_domains –¥–ª—è HTTP
- –ü—Ä–æ–≤–µ—Ä–∫–∞ allowed_local_files –¥–ª—è –ª–æ–∫–∞–ª—å–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π –∏ —Ç–∞–π–º–∞—É—Ç–æ–≤
- –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—É—Ç–µ–π

## üîß –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

### 1. –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
```python
local_sources = []
remote_sources = []

for entry in doc_sources:
    url = entry["llms_txt"]
    if _is_http_or_https(url):
        remote_sources.append(entry)
    else:
        local_sources.append(entry)
```

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ**: –†–∞–∑–Ω–∞—è –ª–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ª–æ–∫–∞–ª—å–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ –∏ HTTP URL.

### 2. –í–∞–ª–∏–¥–∞—Ü–∏—è –ª–æ–∫–∞–ª—å–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
```python
for entry in local_sources:
    path = entry["llms_txt"]
    abs_path = _normalize_path(path)
    if not os.path.exists(abs_path):
        raise FileNotFoundError(f"Local file not found: {abs_path}")
```

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ**: –†–∞–Ω–Ω–µ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º —Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π.

### 3. –°–∏—Å—Ç–µ–º–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π
```python
domains = set(extract_domain(entry["llms_txt"]) for entry in remote_sources)
allowed_local_files = set(_normalize_path(entry["llms_txt"]) for entry in local_sources)
```

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ**: –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å —á–µ—Ä–µ–∑ –±–µ–ª—ã–µ —Å–ø–∏—Å–∫–∏.

### 4. HTTP –∫–ª–∏–µ–Ω—Ç
```python
httpx_client = httpx.AsyncClient(follow_redirects=follow_redirects, timeout=timeout)
```

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ**: –û–¥–∏–Ω –∫–ª–∏–µ–Ω—Ç –¥–ª—è –≤—Å–µ—Ö HTTP –∑–∞–ø—Ä–æ—Å–æ–≤ —Å –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏.

## üìä –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### HTTP –æ—à–∏–±–∫–∏
```python
try:
    response = await httpx_client.get(url, timeout=timeout)
    response.raise_for_status()
    return markdownify(response.text)
except (httpx.HTTPStatusError, httpx.RequestError) as e:
    return f"Encountered an HTTP error: {str(e)}"
```

### –û—à–∏–±–∫–∏ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã
```python
try:
    with open(abs_path, "r", encoding="utf-8") as f:
        content = f.read()
    return markdownify(content)
except Exception as e:
    return f"Error reading local file: {str(e)}"
```

## üéØ –†–∞—Å—à–∏—Ä–µ–Ω–∏—è –∏ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏

### –¢–µ–∫—É—â–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
1. –ù–µ—Ç –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
2. –ù–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –∏–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–æ–π –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
3. –ü—Ä–æ—Å—Ç–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
4. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –º–µ—Ç—Ä–∏–∫ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

### –ü–ª–∞–Ω–∏—Ä—É–µ–º—ã–µ —É–ª—É—á—à–µ–Ω–∏—è
1. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ**: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–ª–æ—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è —á–∞—Å—Ç–æ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
2. **–ò–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è**: –ù–æ–≤—ã–µ MCP –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è –æ–±—Ö–æ–¥–∞ –∏–Ω–¥–µ–∫—Å–æ–≤
3. **–†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**: –ë–æ–ª–µ–µ –¥–µ—Ç–∞–ª—å–Ω–∞—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –æ—à–∏–±–æ–∫
4. **–ú–µ—Ç—Ä–∏–∫–∏**: –°–±–æ—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
5. **–í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞**: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ llms.txt —Ñ–∞–π–ª–æ–≤

## üîó –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

### –í–Ω–µ—à–Ω–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
- `httpx`: –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π HTTP –∫–ª–∏–µ–Ω—Ç
- `markdownify`: –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è HTML –≤ Markdown
- `mcp.server.fastmcp`: MCP —Å–µ—Ä–≤–µ—Ä —Ñ—Ä–µ–π–º–≤–æ—Ä–∫
- `typing_extensions`: –†–∞—Å—à–∏—Ä–µ–Ω–∏—è —Ç–∏–ø–∏–∑–∞—Ü–∏–∏

### –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –º–æ–¥—É–ª–∏
- `urllib.parse`: –ü–∞—Ä—Å–∏–Ω–≥ URL
- `os`: –†–∞–±–æ—Ç–∞ —Å —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–æ–π

## üìà –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `httpx.AsyncClient` –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ HTTP –∫–ª–∏–µ–Ω—Ç–∞
- –†–∞–Ω–Ω–µ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

### –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ —É–∑–∫–∏–µ –º–µ—Å—Ç–∞
- –ë–ª–æ–∫–∏—Ä—É—é—â–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
- –°–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ Markdown

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
1. –î–æ–±–∞–≤–∏—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ —á—Ç–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤
3. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø—É–ª —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –¥–ª—è HTTP –∑–∞–ø—Ä–æ—Å–æ–≤
4. –î–æ–±–∞–≤–∏—Ç—å compression –¥–ª—è –±–æ–ª—å—à–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ 