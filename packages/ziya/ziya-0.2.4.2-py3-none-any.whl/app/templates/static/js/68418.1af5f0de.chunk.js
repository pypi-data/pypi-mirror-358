/*! For license information please see 68418.1af5f0de.chunk.js.LICENSE.txt */
"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[68418],{68418:(e,n,t)=>{t.r(n),t.d(n,{default:()=>_});var s=t(89379),o=t(65043),a=t(6381),l=t(46100),r=t(36011),i=t(27210),c=t(6051),d=t(97606),g=t(4015),m=t(57721),h=t(53727),u=t(58168);const x={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M893.3 293.3L730.7 130.7c-7.5-7.5-16.7-13-26.7-16V112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V338.5c0-17-6.7-33.2-18.7-45.2zM384 184h256v104H384V184zm456 656H184V184h136v136c0 17.7 14.3 32 32 32h320c17.7 0 32-14.3 32-32V205.8l136 136V840zM512 442c-79.5 0-144 64.5-144 144s64.5 144 144 144 144-64.5 144-144-64.5-144-144-144zm0 224c-44.2 0-80-35.8-80-80s35.8-80 80-80 80 35.8 80 80-35.8 80-80 80z"}}]},name:"save",theme:"outlined"};var p=t(22172),v=function(e,n){return o.createElement(p.A,(0,u.A)({},e,{ref:n,icon:x}))};const f=o.forwardRef(v);var y=t(63390),C=t(67407),j=t(70579);const A=e=>{let{index:n,isInline:t=!1}=e;const{currentMessages:u,currentConversationId:x,addMessageToConversation:p,setIsStreaming:v,setConversations:A,streamingConversations:w,addStreamingConversation:b,setStreamedContentMap:M,removeStreamingConversation:z,editingMessageIndex:I,setEditingMessageIndex:S}=(0,a.v)(),[k,R]=(0,o.useState)(u[n].content),{checkedKeys:L}=(0,r.X)(),E=(0,o.useRef)(null),{TextArea:K}=i.A,N=I===n;(0,o.useEffect)((()=>{N&&E.current&&setTimeout((()=>{E.current&&E.current.focus()}),100)}),[N]);return(0,j.jsxs)("div",{children:[t&&N&&null,N&&!t&&(0,j.jsxs)("div",{style:{width:"100%"},children:[(0,j.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px",width:"100%"},children:[(0,j.jsx)("div",{className:"message-sender",children:"You:"}),(0,j.jsxs)(c.A,{children:[(0,j.jsx)(d.A,{title:"Cancel editing",children:(0,j.jsx)(g.Ay,{icon:(0,j.jsx)(h.A,{}),onClick:()=>{S(null),R(u[n].content)},size:"small",children:"Cancel"})}),(0,j.jsx)(d.A,{title:"Save changes to context",children:(0,j.jsx)(g.Ay,{icon:(0,j.jsx)(f,{}),onClick:()=>{A((e=>e.map((e=>{if(e.id===x){const t=e.messages.map(((e,t)=>t===n?(0,s.A)((0,s.A)({},e),{},{content:k,_timestamp:Date.now()}):e));return(0,s.A)((0,s.A)({},e),{},{messages:t,_version:Date.now()})}return e})))),S(null)},size:"small",children:"Save"})}),(0,j.jsx)(d.A,{title:"Send to model, remove newer responses",children:(0,j.jsx)(g.Ay,{icon:(0,j.jsx)(y.A,{}),onClick:async()=>{S(null),M(new Map);const e=u.slice(0,n+1);e[n]=(0,s.A)((0,s.A)({},e[n]),{},{content:k,_timestamp:Date.now(),_edited:!0,_truncatedAfter:!0}),A((n=>n.map((n=>n.id===x?(0,s.A)((0,s.A)({},n),{},{messages:e,_version:Date.now(),_editInProgress:!0}):n)))),b(x);try{const n=await(0,l.f)(e,k,(0,m.F)(L),x,M,v,z,p,w.has(x));if(n){p({content:n,role:"assistant"},x),A((e=>e.map((e=>e.id===x?(0,s.A)((0,s.A)({},e),{},{_editInProgress:!1}):e))))}}catch(t){console.error("Error sending message:",t),z(x)}finally{v(!1)}},size:"small",type:"primary",children:"Submit"})})]})]}),(0,j.jsx)(K,{ref:E,autoFocus:!0,style:{width:"100%",minHeight:"100px",resize:"vertical"},value:k,onChange:e=>R(e.target.value),autoSize:{minRows:3,maxRows:20},placeholder:"Edit your message..."})]}),!N&&(t||!N)&&(0,j.jsx)(d.A,{title:"Edit",children:(0,j.jsx)(g.Ay,{icon:(0,j.jsx)(C.A,{}),onClick:()=>{S(n)}})})]})};var w=t(91686);const b={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M758.2 839.1C851.8 765.9 912 651.9 912 523.9 912 303 733.5 124.3 512.6 124 291.4 123.7 112 302.8 112 523.9c0 125.2 57.5 236.9 147.6 310.2 3.5 2.8 8.6 2.2 11.4-1.3l39.4-50.5c2.7-3.4 2.1-8.3-1.2-11.1-8.1-6.6-15.9-13.7-23.4-21.2a318.64 318.64 0 01-68.6-101.7C200.4 609 192 567.1 192 523.9s8.4-85.1 25.1-124.5c16.1-38.1 39.2-72.3 68.6-101.7 29.4-29.4 63.6-52.5 101.7-68.6C426.9 212.4 468.8 204 512 204s85.1 8.4 124.5 25.1c38.1 16.1 72.3 39.2 101.7 68.6 29.4 29.4 52.5 63.6 68.6 101.7 16.7 39.4 25.1 81.3 25.1 124.5s-8.4 85.1-25.1 124.5a318.64 318.64 0 01-68.6 101.7c-9.3 9.3-19.1 18-29.3 26L668.2 724a8 8 0 00-14.1 3l-39.6 162.2c-1.2 5 2.6 9.9 7.7 9.9l167 .8c6.7 0 10.5-7.7 6.3-12.9l-37.3-47.9z"}}]},name:"redo",theme:"outlined"};var M=function(e,n){return o.createElement(p.A,(0,u.A)({},e,{ref:n,icon:b}))};const z=o.forwardRef(M);const I={icon:{tag:"svg",attrs:{"fill-rule":"evenodd",viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M771.91 115a31.65 31.65 0 00-17.42 5.27L400 351.97H236a16 16 0 00-16 16v288.06a16 16 0 0016 16h164l354.5 231.7a31.66 31.66 0 0017.42 5.27c16.65 0 32.08-13.25 32.08-32.06V147.06c0-18.8-15.44-32.06-32.09-32.06M732 221v582L439.39 611.75l-17.95-11.73H292V423.98h129.44l17.95-11.73z"}}]},name:"muted",theme:"outlined"};var S=function(e,n){return o.createElement(p.A,(0,u.A)({},e,{ref:n,icon:I}))};const k=o.forwardRef(S);const R={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M625.9 115c-5.9 0-11.9 1.6-17.4 5.3L254 352H90c-8.8 0-16 7.2-16 16v288c0 8.8 7.2 16 16 16h164l354.5 231.7c5.5 3.6 11.6 5.3 17.4 5.3 16.7 0 32.1-13.3 32.1-32.1V147.1c0-18.8-15.4-32.1-32.1-32.1zM586 803L293.4 611.7l-18-11.7H146V424h129.4l17.9-11.7L586 221v582zm348-327H806c-8.8 0-16 7.2-16 16v40c0 8.8 7.2 16 16 16h128c8.8 0 16-7.2 16-16v-40c0-8.8-7.2-16-16-16zm-41.9 261.8l-110.3-63.7a15.9 15.9 0 00-21.7 5.9l-19.9 34.5c-4.4 7.6-1.8 17.4 5.8 21.8L856.3 800a15.9 15.9 0 0021.7-5.9l19.9-34.5c4.4-7.6 1.7-17.4-5.8-21.8zM760 344a15.9 15.9 0 0021.7 5.9L892 286.2c7.6-4.4 10.2-14.2 5.8-21.8L878 230a15.9 15.9 0 00-21.7-5.9L746 287.8a15.99 15.99 0 00-5.8 21.8L760 344z"}}]},name:"sound",theme:"outlined"};var L=function(e,n){return o.createElement(p.A,(0,u.A)({},e,{ref:n,icon:R}))};const E=o.forwardRef(L);var K=t(55727);const N=(0,o.memo)((e=>{let{previousModel:n,newModel:t,changeKey:s}=e;const{isDarkMode:o}=(0,K.D)(),a={container:{padding:"12px 16px",borderRadius:"8px",backgroundColor:o?"rgba(25, 118, 210, 0.15)":"rgba(25, 118, 210, 0.08)",border:"1px solid ".concat(o?"#2c6cb0":"#90caf9"),marginBottom:"12px",marginTop:"4px",display:"flex",alignItems:"center",boxShadow:o?"0 2px 8px rgba(0, 0, 0, 0.15)":"0 1px 3px rgba(0, 0, 0, 0.1)"},icon:{fontSize:"20px",marginRight:"12px",color:o?"#90caf9":"#1976d2"},text:{color:o?"#e3f2fd":"#0d47a1",fontWeight:500,fontSize:"14px"},modelName:{fontWeight:600,color:o?"#bbdefb":"#1565c0"}};return(0,j.jsxs)("div",{style:a.container,children:[(0,j.jsx)("span",{style:a.icon,children:"\ud83d\udd04"}),(0,j.jsxs)("span",{style:a.text,children:["Model changed from ",(0,j.jsx)("span",{style:a.modelName,children:n})," to ",(0,j.jsx)("span",{style:a.modelName,children:t})]})]})}),((e,n)=>(!e.changeKey||!n.changeKey||e.changeKey===n.changeKey)&&(e.previousModel===n.previousModel&&e.newModel===n.newModel&&e.changeKey===n.changeKey)));N.displayName="ModelChangeNotification";const V=N;var H=t(8627);const T=o.lazy((()=>Promise.all([t.e(60544),t.e(79218),t.e(97326),t.e(15),t.e(63178),t.e(94645)]).then(t.bind(t,94645)))),_=(0,o.memo)((e=>{let{enableCodeApply:n}=e;const{currentMessages:t,editingMessageIndex:i,isTopToBottom:c,isLoadingConversation:h,addStreamingConversation:u,streamingConversations:x,currentConversationId:p,setIsStreaming:v,setStreamedContentMap:f,isStreaming:y,addMessageToConversation:C,removeStreamingConversation:b,streamedContentMap:M,userHasScrolled:I,updateProcessingState:S,setConversations:R,toggleMessageMute:L}=(0,a.v)(),K=(0,r.X)(),N=(null===K||void 0===K?void 0:K.checkedKeys)||[],{setQuestion:_}=(0,H.J)(),B=(0,o.useRef)(!0),D=c?t:[...t].reverse(),F=(0,o.useRef)(0),P=(0,o.useRef)(new Set),W=(0,o.useRef)(new Set),O=(0,o.useCallback)((e=>M.has(e)&&""!==M.get(e)),[M]);(0,o.useEffect)((()=>{}),[t.length,y,I,c]),(0,o.useEffect)((()=>{console.debug("Conversation messages updated:",{messageCount:t.length,previousCount:F.current,isVisible:B.current,displayOrder:c?"top-down":"bottom-up"}),t.length!==F.current&&(F.current=t.length,console.log("Rendered ".concat(t.length," messages")));const e=new IntersectionObserver((e=>{e.forEach((e=>{B.current=e.isIntersecting,console.debug("Conversation visibility changed:",{isVisible:e.isIntersecting,messageCount:t.length})}))}),{threshold:.1});return()=>e.disconnect()}),[c,t.length]),(0,o.useEffect)((()=>{const e=e=>{console.log("Conversation received model change event:",e.detail);const{previousModel:n,newModel:t}=e.detail,s="".concat(n,"->").concat(t);W.current.has(s)?console.log("Skipping duplicate model change:",s):(W.current.add(s),n&&t&&C({role:"system",content:"Model changed from ".concat(n," to ").concat(t),modelChange:{from:n,to:t,changeKey:s}},p))};return window.addEventListener("modelChanged",e),()=>{W.current.clear(),P.current.clear(),window.removeEventListener("modelChanged",e)}}),[p,C]);const X=h?t.length>0?"Loading messages (".concat(t.length," loaded)..."):"Loading conversation...":"",Y=h&&t.length>0,q=h&&0===t.length,J=e=>{const n=t[e],s=e===t.length-1,o=e+1,a=o<t.length?t[o]:null,l=o<t.length,r=x.has(p),i=O(p);return"human"===(null===n||void 0===n?void 0:n.role)&&!r&&!i&&(s||l&&"assistant"!==(null===a||void 0===a?void 0:a.role))},Q=e=>J(e)?(0,j.jsx)(d.A,{title:"The AI response may have failed. Click to retry.",children:(0,j.jsx)(g.Ay,{icon:(0,j.jsx)(z,{}),type:"primary",size:"small",onClick:async()=>{const n=t[e];u(p);try{await(0,l.f)(t,n.content,(0,m.F)(N||[]),p,f,v,b,C,x.has(p),(e=>S(p,e)))}catch(s){v(!1),b(p),console.error("Error retrying message:",s)}},children:"Retry AI Response"})}):null,U=e=>{if(i===e)return null;const n=t[e];return J(e)?null:n&&"system"!==n.role?(0,j.jsx)(d.A,{title:n.muted?"Unmute (include in context)":"Mute (exclude from context)",children:(0,j.jsx)(g.Ay,{icon:n.muted?(0,j.jsx)(k,{}):(0,j.jsx)(E,{}),type:"default",size:"small",style:{padding:"0 8px",minWidth:"32px",height:"32px"},onClick:()=>{console.log("Toggling mute for message ".concat(e,", current state:"),n.muted),L(p,e)}})}):null},G=e=>{if(i===e)return null;const n=t[e];if(J(e))return null;if(!n||"human"!==n.role)return null;return x.has(p)?null:(0,j.jsx)(d.A,{title:"Resubmit this question",children:(0,j.jsx)(g.Ay,{icon:(0,j.jsx)(z,{}),type:"default",size:"small",style:{padding:"0 8px",minWidth:"32px",height:"32px"},onClick:()=>{f(new Map);const o=t.slice(0,e+1);R((e=>e.map((e=>e.id===p?(0,s.A)((0,s.A)({},e),{},{messages:o,_version:Date.now()}):e)))),u(p),(async()=>{try{await(0,l.f)(o,n.content,(0,m.F)(N||[]),p,f,v,b,C,x.has(p),(e=>S(p,e)))}catch(e){v(!1),b(p),console.error("Error resubmitting message:",e)}})(),_("")}})})};return(0,j.jsxs)("div",{style:{position:"relative"},children:[q&&(0,j.jsx)("div",{style:{position:"fixed",top:"var(--header-height)",left:"var(--folder-panel-width)",right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1e3},children:(0,j.jsx)(w.A,{size:"large",tip:X})}),(0,j.jsxs)("div",{style:{opacity:h?.5:1,minHeight:"50px"},className:"conversation-messages-container",children:[Y&&(0,j.jsxs)("div",{style:{position:"sticky",top:0,backgroundColor:"rgba(0, 0, 0, 0.7)",color:"#fff",padding:"8px 16px",borderRadius:"4px",margin:"8px 0",display:"flex",alignItems:"center",gap:"8px",zIndex:1e3},children:[(0,j.jsx)(w.A,{size:"small"}),(0,j.jsx)("span",{children:X})]}),D.map(((e,s)=>{const a=c?s:t.length-1-s,l=a+1,r=l<t.length,d=r?t[l]:null,g=x.has(p),m=O(p),h="human"===e.role&&!g&&!m&&(a===t.length-1||r&&"assistant"!==(null===d||void 0===d?void 0:d.role)),u="system"===e.role&&e.modelChange?"".concat(e.modelChange.from,"->").concat(e.modelChange.to):e.content;var v,f;"system"!==e.role||P.current.has(u)||(P.current.add(u),console.log("Rendering system message:",{content:e.content,hasModelChange:Boolean(e.modelChange),modelChangeFrom:null===(v=e.modelChange)||void 0===v?void 0:v.from,modelChangeTo:null===(f=e.modelChange)||void 0===f?void 0:f.to,messageIndex:s,totalMessages:(null===D||void 0===D?void 0:D.length)||0}));return(0,j.jsx)("div",{className:"message ".concat(e.role||"").concat(e.muted?" muted":"").concat(h?" needs-response":""),children:"system"===e.role&&e.modelChange?(0,j.jsx)(V,{previousModel:e.modelChange.from,changeKey:e.modelChange.changeKey,newModel:e.modelChange.to}):e.content?(0,j.jsxs)(j.Fragment,{children:["human"===e.role&&(0,j.jsxs)("div",{style:{display:i===a?"none":"flex",justifyContent:"space-between"},children:[(0,j.jsx)("div",{className:"message-sender",children:"You:"}),(0,j.jsxs)("div",{style:{display:"flex",gap:"8px",alignItems:"center",marginRight:"8px"},children:[U(a),G(a),h&&Q(a),(0,j.jsx)(A,{index:a,isInline:!0})]})]}),"human"===e.role&&i===a?(0,j.jsx)(A,{index:a,isInline:!1}):"human"===e.role&&e.content?(0,j.jsx)("div",{className:"message-content",children:(0,j.jsx)(o.Suspense,{fallback:(0,j.jsx)("div",{children:"Loading content..."}),children:(0,j.jsx)(T,{markdown:e.content,enableCodeApply:n,isStreaming:y||x.has(p)})})}):"assistant"===e.role&&e.content&&(0,j.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[(0,j.jsx)("div",{className:"message-sender",children:"AI:"}),(0,j.jsx)("div",{style:{display:"flex",gap:"8px",alignItems:"center",marginRight:"8px"},children:U(a)}),Q(a)]}),"assistant"===e.role&&e.content&&(0,j.jsx)("div",{className:"message-content",children:(0,j.jsx)(o.Suspense,{fallback:(0,j.jsx)("div",{children:"Loading content..."}),children:(0,j.jsx)(T,{markdown:e.content,enableCodeApply:n,isStreaming:y||x.has(p)})})})]}):null},"message-".concat(e.id||s))}))]})]})}))}}]);
//# sourceMappingURL=68418.1af5f0de.chunk.js.map