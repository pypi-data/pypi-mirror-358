!function(e,t,r,s,n,i,o,l){var f="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},a="function"==typeof f[s]&&f[s],u=a.i||{},h=a.cache||{},p="undefined"!=typeof module&&"function"==typeof module.require&&module.require.bind(module);function _(t,r){if(!h[t]){if(!e[t]){if(n[t])return n[t];var i="function"==typeof f[s]&&f[s];if(!r&&i)return i(t,!0);if(a)return a(t,!0);if(p&&"string"==typeof t)return p(t);var o=Error("Cannot find module '"+t+"'");throw o.code="MODULE_NOT_FOUND",o}u.resolve=function(r){var s=e[t][1][r];return null!=s?s:r},u.cache={};var l=h[t]=new _.Module(t);e[t][0].call(l.exports,u,l,l.exports,f)}return h[t].exports;function u(e){var t=u.resolve(e);return!1===t?{}:_(t)}}_.isParcelRequire=!0,_.Module=function(e){this.id=e,this.bundle=_,this.require=p,this.exports={}},_.modules=e,_.cache=h,_.parent=a,_.distDir=void 0,_.publicUrl=void 0,_.devServer=void 0,_.i=u,_.register=function(t,r){e[t]=[function(e,t){t.exports=r},{}]},Object.defineProperty(_,"root",{get:function(){return f[s]}}),f[s]=_;for(var g=0;g<t.length;g++)_(t[g]);if(r){var d=_(r);"object"==typeof exports&&"undefined"!=typeof module?module.exports=d:"function"==typeof define&&define.amd&&define(function(){return d})}}({"5liWw":[function(e,t,r,s){var n,i,o=e("@parcel/transformer-js/src/esmodule-helpers.js");o.defineInteropFlag(r),o.export(r,"RULE",()=>l),o.export(r,"shuffle_array",()=>_),o.export(r,"initial_seating",()=>c),o.export(r,"compute_issues",()=>R);var l=((n={})[n.R1_PREDATOR_PREY=0]="R1_PREDATOR_PREY",n[n.R2_OPPONENT_ALWAYS=1]="R2_OPPONENT_ALWAYS",n[n.R3_AVAILABLE_VPS=2]="R3_AVAILABLE_VPS",n[n.R4_OPPONENT_TWICE=3]="R4_OPPONENT_TWICE",n[n.R5_FIFTH_SEAT=4]="R5_FIFTH_SEAT",n[n.R6_SAME_POSITION=5]="R6_SAME_POSITION",n[n.R7_SAME_SEAT=6]="R7_SAME_SEAT",n[n.R8_STARTING_TRANSFERS=7]="R8_STARTING_TRANSFERS",n[n.R9_SAME_POSITION_GROUP=8]="R9_SAME_POSITION_GROUP",n),f=((i=f||{})[i.OPPONENT=0]="OPPONENT",i[i.PREY=1]="PREY",i[i.PREDATOR=2]="PREDATOR",i[i.GRAND_PREY=3]="GRAND_PREY",i[i.GRAND_PREDATOR=4]="GRAND_PREDATOR",i[i.CROSS_TABLE=5]="CROSS_TABLE",i[i.NEIGHBOUR=6]="NEIGHBOUR",i[i.NON_NEIGHBOUR=7]="NON_NEIGHBOUR",i[i.ROUNDS_PLAYED=0]="ROUNDS_PLAYED",i[i.VPS=1]="VPS",i[i.TRS=2]="TRS",i[i.SEAT_1=3]="SEAT_1",i[i.SEAT_2=4]="SEAT_2",i[i.SEAT_3=5]="SEAT_3",i[i.SEAT_4=6]="SEAT_4",i[i.SEAT_5=7]="SEAT_5",i);let a=new Map([[4,[[],[1,1,0,0,0,0,1,0],[1,0,0,0,0,1,0,1],[1,0,1,0,0,0,1,0]]],[5,[[],[1,1,0,0,0,0,1,0],[1,0,0,1,0,0,0,1],[1,0,0,0,1,0,0,1],[1,0,1,0,0,0,1,0]]]]),u=new Map([[4,[[1,4,1,1,0,0,0,0],[1,4,2,0,1,0,0,0],[1,4,3,0,0,1,0,0],[1,4,4,0,0,0,1,0]]],[5,[[1,5,1,1,0,0,0,0],[1,5,2,0,1,0,0,0],[1,5,3,0,0,1,0,0],[1,5,4,0,0,0,1,0],[1,5,4,0,0,0,0,1]]]]);function h(e,t){return e.map((e,r)=>e.map((e,s)=>e.map((e,n)=>e+t[r][s][n])))}class p{mapping=new Map;reverse=new Map;constructor(e){var t=0;for(let r of e)this.mapping.has(r)||(this.reverse.set(t,r),this.mapping.set(r,t++))}measure(e,t){let r=Array.from({length:this.mapping.size},e=>Array.from({length:this.mapping.size},e=>Array(8).fill(0)));for(let[n,i]of e.entries())if((!t||t.includes(n))&&u.has(i.length))for(let[e,t]of i.entries()){let n=this.mapping.get(t);r[n][n]=u.get(i.length)[e].slice();for(var s=1;s<i.length;s++){let t=this.mapping.get(i[(e+s)%i.length]);t>n||(r[n][t]=a.get(i.length)[s].slice())}}return r}measure_rounds(e){var t=void 0;for(let r of e){let e=this.measure(r);t=t?h(t,e):e}return t}issues(e){let t=Array.from({length:9},e=>[]);var r=0,s=0,n=0,i=0;for(let[t,o]of e.entries()){let e=o[t],l=e[0];l>0&&(r+=e[1]/l,s+=e[2]/l,n++,i=i<l?l:i)}for(let[o,l]of(r/=n,s/=n,e.entries()))for(let[e,f]of l.entries()){if(e>o)break;if(e===o){let e=f[0];Math.abs(r-f[1]/e)>1/e&&t[2].push([this.reverse.get(o)]),Math.abs(s-f[2]/e)>2/e&&t[7].push([this.reverse.get(o)]),f[3]>1&&t[6].push([this.reverse.get(o)]),f[4]>1&&t[6].push([this.reverse.get(o)]),f[5]>1&&t[6].push([this.reverse.get(o)]),f[6]>1&&t[6].push([this.reverse.get(o)]),f[7]>1&&(t[6].push([this.reverse.get(o)]),t[4].push([this.reverse.get(o)]))}else for(let[r,s]of f.entries())s>1&&(0==r?(n>20&&t[3].push([this.reverse.get(o),this.reverse.get(e)]),s>=i&&i>2&&t[1].push([this.reverse.get(o),this.reverse.get(e)])):r<=2?(t[0].push([this.reverse.get(o),this.reverse.get(e)]),t[5].push([this.reverse.get(o),this.reverse.get(e)])):r<=5?t[5].push([this.reverse.get(o),this.reverse.get(e)]):n>20&&t[8].push([this.reverse.get(o),this.reverse.get(e)]))}return t}fast_score(e){let t=Array(9).fill(0);var r=0,s=0,n=0,i=0;for(let[t,o]of e.entries()){let e=o[t],l=e[0];l>0&&(r+=e[1]/l,s+=e[2]/l,n++,i=i<l?l:i)}for(let[o,l]of(r/=n,s/=n,e.entries()))for(let[e,n]of l.entries()){if(e>o)break;if(e===o){let e=n[0];Math.abs(r-n[1]/e)>1/e&&t[2]++,Math.abs(s-n[2]/e)>2/e&&t[7]++,n[3]>1&&t[6]++,n[4]>1&&t[6]++,n[5]>1&&t[6]++,n[6]>1&&t[6]++,n[7]>1&&(t[6]++,t[4]++)}else for(let[e,r]of n.entries())r>1&&(0==e?(t[3]++,r>=i&&t[1]++):e<=2?(t[0]++,t[5]++):e<=5?t[5]++:t[8]++)}return t}}function _(e){for(let t=e.length-1;t>=0;t--){let r=Math.floor(Math.random()*(t+1));[e[t],e[r]]=[e[r],e[t]]}}function g(e){let t=e.length-4*(5-(e.length%5||5));var r=0;let s=[];for(;r<e.length;){let n=r<t?5:4,i=e.slice(r,r+n);if(i.length<4)throw Error("Invalid players count");s.push(i),r+=n}return s}class d{seat_index=new Map;player_index=new Map;seating;constructor(e){this.seating=e.map(e=>e.slice());var t=0;for(let[r,s]of e.entries())for(let[e,n]of s.entries())this.player_index.set(n,t),this.seat_index.set(t,[r,e]),t++}random_swap(e){let t=this.player_index.get(e);for(var r=t;r==t;)r=Math.floor(Math.random()*this.seat_index.size);this.swap(t,r)}shuffle(){for(var e=this.seat_index.size-1;e>=0;e--){let t=e,r=Math.floor(Math.random()*(e+1));this.swap(t,r)}}swap(e,t){let[r,s]=[this.seat_index.get(e),this.seat_index.get(t)],[n,i]=[this.seating[r[0]][r[1]],this.seating[s[0]][s[1]]];this.seating[r[0]][r[1]]=i,this.seating[s[0]][s[1]]=n,this.player_index.set(n,t),this.player_index.set(i,e)}}function c(e,t){if(t=t.slice(),e.length<=0)return _(t),g(t);let r=new Set(t),s=new Set(t);for(let t of e)for(let e of t)for(let t of e)s.add(t);let n=new p(s),i=n.measure_rounds(e);if(_(t),t.length<1)return g(t);for(var o=new d(g(t)),l=n.issues(h(i,n.measure(o.seating))),f=0;f<1e3;f++){var a=new d(o.seating);let e=new Set;for(let t of l)for(let s of t){let t=s.filter(e=>r.has(e));t.length<1||(t.length<2?e.add(s[0]):e.add(s[Math.floor(Math.random()*s.length)]))}for(let t of e)a.random_swap(t);let t=n.issues(h(i,n.measure(a.seating)));if(0>function(e,t){let r=e.length<t.length?e.length:t.length;for(var s=0;s<r;s++){let r=e[s].length,n=t[s].length;if(r<n)return -1;if(r>n)return 1}return 0}(t,l)&&(l=t,o=a),!l.some(e=>e.length>0))break}return console.log("best seating found",o.seating,l),o.seating}function R(e){let t=new Set;for(let r of e)for(let e of r)for(let r of e)t.add(r);let r=new p(t),s=r.measure_rounds(e);return r.issues(s)}},{"@parcel/transformer-js/src/esmodule-helpers.js":"k3151"}],k3151:[function(e,t,r,s){r.interopDefault=function(e){return e&&e.__esModule?e:{default:e}},r.defineInteropFlag=function(e){Object.defineProperty(e,"__esModule",{value:!0})},r.exportAll=function(e,t){return Object.keys(e).forEach(function(r){"default"===r||"__esModule"===r||Object.prototype.hasOwnProperty.call(t,r)||Object.defineProperty(t,r,{enumerable:!0,get:function(){return e[r]}})}),t},r.export=function(e,t,r){Object.defineProperty(e,t,{enumerable:!0,get:r})}},{}]},["5liWw"],"5liWw","parcelRequire94c2",{});
//# sourceMappingURL=seating.js.map
