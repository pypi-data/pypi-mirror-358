# Makefile for Flask Graylog Examples

.PHONY: help install run test-logging graylog-up graylog-down clean

# Default target
help:
	@echo "Flask Graylog Examples"
	@echo "====================="
	@echo ""
	@echo "Available commands:"
	@echo "  install        - Install dependencies"
	@echo "  run            - Run the example Flask application"
	@echo "  test-logging   - Run logging tests"
	@echo "  graylog-up     - Start Graylog services with Docker"
	@echo "  graylog-down   - Stop Graylog services"
	@echo "  quick-start    - Full setup and run (Graylog + Flask)"
	@echo "  clean          - Clean up generated files"

# Install dependencies
install:
	@echo "ðŸ“¦ Installing dependencies..."
	pip3 install -r requirements.txt
	@if [ ! -f ".env" ]; then cp .env.example .env; echo "âœ… Created .env file"; fi

# Run the Flask application
run: install
	@echo "ðŸŒ¶ï¸ Starting Flask application..."
	@echo "ðŸ“‹ Application will be available at: http://127.0.0.1:5000"
	@echo "ðŸ“‹ Make sure Graylog is running (use 'make graylog-up')"
	python3 app.py

# Run logging tests
test-logging: install
	@echo "ðŸ§ª Running logging tests..."
	python3 test_logging.py

# Start Graylog services
graylog-up:
	@echo "ðŸ³ Starting Graylog services with Docker Compose..."
	docker-compose up -d
	@echo "â³ Waiting for services to start..."
	@sleep 10
	@echo "âœ… Graylog services started!"
	@echo "ðŸ“‹ Graylog web interface: http://127.0.0.1:9000"
	@echo "ðŸ“‹ Login: admin / admin"
	@echo "ðŸ“‹ Remember to create a GELF UDP input on port 12201"

# Stop Graylog services
graylog-down:
	@echo "ðŸ›‘ Stopping Graylog services..."
	docker-compose down
	@echo "âœ… Graylog services stopped"

# Full quick start
quick-start:
	@echo "ðŸš€ Flask Graylog Quick Start"
	@echo "==========================="
	@./run_example.sh

# Clean up
clean:
	@echo "ðŸ§¹ Cleaning up..."
	@rm -f .env
	@find . -name "*.pyc" -delete
	@find . -name "__pycache__" -type d -exec rm -rf {} + 2>/dev/null || true
	@echo "âœ… Cleanup complete"
