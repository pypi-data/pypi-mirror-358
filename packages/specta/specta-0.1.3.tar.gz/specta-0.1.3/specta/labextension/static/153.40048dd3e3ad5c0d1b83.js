"use strict";(self.webpackChunkjupyter_specta=self.webpackChunkjupyter_specta||[]).push([[153],{153:(e,t,o)=>{o.r(t),o.d(t,{ISpectaDocTracker:()=>D,ISpectaLayoutRegistry:()=>A,SPECTA_CELL_VISIBLE_TAG:()=>W,createFileBrowser:()=>q,default:()=>V,hideAppLoadingIndicator:()=>I,isSpectaApp:()=>M,registerDocumentFactory:()=>j});var n=o(560),s=o(963),a=o(88),i=o(767),r=o(424),l=o(689),c=o(313),d=o(305),u=o(375),p=o(484),m=o(256),h=o(345),g=o.n(h);const y=e=>{var t=function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(n=Object.getOwnPropertySymbols(e);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(e,n[s])&&(o[n[s]]=e[n[s]])}return o}(e,[]);return g().createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 -960 960 960",width:"24px"},t),g().createElement("path",{d:"m370-80-16-128q-13-5-24.5-12T307-235l-119 50L78-375l103-78q-1-7-1-13.5v-27q0-6.5 1-13.5L78-585l110-190 119 50q11-8 23-15t24-12l16-128h220l16 128q13 5 24.5 12t22.5 15l119-50 110 190-103 78q1 7 1 13.5v27q0 6.5-2 13.5l103 78-110 190-118-50q-11 8-23 15t-24 12L590-80H370Zm70-80h79l14-106q31-8 57.5-23.5T639-327l99 41 39-68-86-65q5-14 7-29.5t2-31.5q0-16-2-31.5t-7-29.5l86-65-39-68-99 42q-22-23-48.5-38.5T533-694l-13-106h-79l-14 106q-31 8-57.5 23.5T321-633l-99-41-39 68 86 64q-5 15-7 30t-2 32q0 16 2 31t7 30l-86 65 39 68 99-42q22 23 48.5 38.5T427-266l13 106Zm42-180q58 0 99-41t41-99q0-58-41-99t-99-41q-59 0-99.5 41T342-480q0 58 40.5 99t99.5 41Zm-2-140Z"}))},v=(0,h.forwardRef)((({icon:e,onClick:t,title:o,disabled:n,className:s},a)=>g().createElement("button",{ref:a,className:`jp-Button specta-icon-button ${null!=s?s:""}`,title:o,disabled:n,onClick:t},e))),f=()=>g().createElement("div",{className:"specta-divider"}),_=e=>{var t,o,n,s,a;const{themeManager:i,layoutRegistry:r}=e,[l,c]=(0,h.useState)([...null!==(t=null==i?void 0:i.themes)&&void 0!==t?t:[]]),[d,u]=(0,h.useState)(null!==(o=null==i?void 0:i.theme)&&void 0!==o?o:"light"),[p,m]=(0,h.useState)(null!==(n=null==r?void 0:r.allLayouts())&&void 0!==n?n:[]),[y,v]=(0,h.useState)(null!==(a=null===(s=null==r?void 0:r.selectedLayout)||void 0===s?void 0:s.name)&&void 0!==a?a:"default");(0,h.useEffect)((()=>{let e;if(i&&(e=(e,t)=>{t.newValue.length>0||(c([...i.themes]),i.theme&&u(i.theme))},i.themeChanged.connect(e)),r){const e=(e,t)=>{m(r.allLayouts())};r.layoutAdded.connect(e)}return()=>{i&&e&&i.themeChanged.disconnect(e)}}),[i,r]);const _=(0,h.useCallback)((e=>{var t;const o=null===(t=e.currentTarget)||void 0===t?void 0:t.value;o&&(null==i||i.setTheme(o),u(o))}),[i]),w=(0,h.useCallback)((e=>{var t;const o=null===(t=e.currentTarget)||void 0===t?void 0:t.value;o&&r&&(r.setSelectedLayout(o),v(o))}),[r]);return g().createElement("div",{style:{padding:"0 10px"}},g().createElement("p",{style:{marginTop:0,marginBottom:"5px",fontSize:"1rem"}},"SETTINGS"),g().createElement(f,null),r&&g().createElement("div",null,g().createElement("label",{htmlFor:""},"Select layout"),g().createElement("div",{className:"jp-select-wrapper"},g().createElement("select",{className:" jp-mod-styled specta-topbar-theme",onChange:w,value:y},p.map((e=>g().createElement("option",{key:e,value:e,style:{background:"var(--jp-layout-color2)"}},e.charAt(0).toUpperCase()+e.slice(1))))))),i&&g().createElement("div",null,g().createElement("label",{htmlFor:""},"Select theme"),g().createElement("div",{className:"jp-select-wrapper"},g().createElement("select",{className:" jp-mod-styled specta-topbar-theme",onChange:_,value:d},l.map((e=>g().createElement("option",{key:e,value:e,style:{background:"var(--jp-layout-color2)"}},e)))))))};function w(e){var t,o;const n=g().useMemo((()=>{var t,o,n,s,a,i,r,l;return{background:null!==(o=null===(t=e.config)||void 0===t?void 0:t.background)&&void 0!==o?o:"var(--jp-layout-color2)",title:null!==(s=null===(n=e.config)||void 0===n?void 0:n.title)&&void 0!==s?s:"Specta",themeToggle:Boolean(null===(a=e.config)||void 0===a?void 0:a.themeToggle),kernelActivity:Boolean(null===(i=e.config)||void 0===i?void 0:i.kernelActivity),textColor:null!==(l=null===(r=e.config)||void 0===r?void 0:r.textColor)&&void 0!==l?l:"var(--jp-ui-font-color1)"}}),[e.config]),[s,a]=(0,h.useState)(!1),i=(0,h.useRef)(null),r=(0,h.useRef)(null);return(0,h.useEffect)((()=>{const e=e=>{r.current&&!r.current.contains(e.target)&&i.current&&!i.current.contains(e.target)&&a(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)}),[]),g().createElement("div",{className:"specta-topbar",style:{background:null!==(t=n.background)&&void 0!==t?t:"var(--jp-layout-color2)"}},g().createElement("div",{className:"specta-topbar-left"},g().createElement("div",null,n.icon&&g().createElement("img",{style:{width:"50px"},src:n.icon})),g().createElement("div",{className:"specta-topbar-title",style:{color:null!==(o=n.textColor)&&void 0!==o?o:"var(--jp-ui-font-color1)"}},n.title)),g().createElement("div",{className:"specta-topbar-right"},g().createElement(v,{ref:i,onClick:()=>a(!s),icon:g().createElement(y,{fill:"var(--jp-ui-font-color2)",height:24,width:24})}),s&&g().createElement("div",{ref:r,className:"jp-Dialog-content specta-config-dialog"},g().createElement("div",{className:"specta-config-arrow"}),g().createElement(_,{themeManager:e.themeManager,layoutRegistry:e.layoutRegistry}))))}class C extends u.DocumentWidget{constructor(e){super(e)}dispose(){this.content.dispose(),super.dispose()}}class b extends u.ABCWidgetFactory{constructor(e){super(e),this._spectaWidgetFactory=e.spectaWidgetFactory}createNewWidget(e){const t=new m.Panel;if(t.addClass("jp-specta-notebook-panel"),!M()){const e=p.ReactWidget.create(h.createElement(w,null));t.addWidget(e)}return e.ready.then((async()=>{const o=await this._spectaWidgetFactory.createNew({context:e});o&&t.addWidget(o)})),new C({context:e,content:t})}}var k=o(559),E=o(442);function S({bars:e=5}){return g().createElement("div",{className:"skeleton-bar-chart vertical"},g().createElement("div",{className:"skeleton-label"},"Executing cell"),Array.from({length:e}).map(((e,t)=>g().createElement("div",{key:t,className:"bar vertical-bar",style:{animationDelay:.4*t+"s"}}))))}function x(){return g().createElement("div",{className:"skeleton-line-chart"},g().createElement("div",{className:"skeleton-label"},"Executing cell"),g().createElement("svg",{viewBox:"0 0 100 40",preserveAspectRatio:"none"},g().createElement("polyline",{points:"0,30 20,20 40,25 60,15 80,10 100,20"})))}function L(){return Math.random()<.5?g().createElement(x,null):g().createElement(S,null)}class N extends m.Panel{constructor({cellIdentity:e,cell:t,sourceCell:o,info:n}){var s;super(),this._info={},this._placeholder=void 0,this.removeClass("lm-Widget"),this.removeClass("p-Widget"),this.addClass("specta-cell-output");const a=new m.Panel;a.addClass("specta-cell-content"),t.addClass("specta-item-widget"),o&&a.addWidget(o),a.addWidget(t),this.addWidget(a),this._cellOutput=t,this.cellIdentity=e,this._info=null!=n?n:{},"code"===(null===(s=n.cellModel)||void 0===s?void 0:s.cell_type)&&(this._placeholder=p.ReactWidget.create(g().createElement(L,null)),this._placeholder.addClass("specta-cell-placeholder"),this.addWidget(this._placeholder))}get cellOutput(){return this._cellOutput}get info(){return this._info}removePlaceholder(){var e;this._placeholder&&(null===(e=this._placeholder)||void 0===e||e.dispose())}}var R,T=o(262);class O{constructor(e){this.options=e,this._isDisposed=!1,this._context=e.context}get isDisposed(){return this._isDisposed}dispose(){var e,t;this.isDisposed||(this._isDisposed=!0,null===(e=this._context)||void 0===e||e.dispose(),null===(t=this._notebookPanel)||void 0===t||t.dispose())}get rendermime(){return this.options.rendermime}get cells(){var e;return null===(e=this._context)||void 0===e?void 0:e.model.cells}get context(){return this._context}get panel(){return this._notebookPanel}async initialize(){var e,t;const o=new T.PromiseDelegate;await(null===(e=this._context)||void 0===e?void 0:e.sessionContext.ready);const n=()=>{o.resolve(),this._notebookPanel=function(e){const{context:t,rendermime:o,editorServices:n}=e,s=n.factoryService.newInlineEditor,i=new a.Notebook({rendermime:o,contentFactory:new a.Notebook.ContentFactory({editorFactory:s}),mimeTypeService:n.mimeTypeService});return new a.NotebookPanel({content:i,context:t})}({context:this._context,rendermime:this.options.rendermime,editorServices:this.options.editorServices}),this.options.tracker.widgetAdded.emit(this._notebookPanel)},s=null===(t=this._context.sessionContext.session)||void 0===t?void 0:t.kernel;if(!s||"unknown"===s.status)return this._context.sessionContext.connectionStatusChanged.connect(((e,t)=>{var o;"connected"===t&&(null===(o=this._context.sessionContext.session)||void 0===o?void 0:o.kernel)&&n()}),this),o.promise;n()}createCell(e){var t,o;let n;const s={cellModel:e.toJSON()};switch(e.type){case"code":{e.setMetadata("editable",!1);const a=new k.CodeCell({model:e,rendermime:this.options.rendermime,contentFactory:this.options.contentFactory,editorConfig:{lineNumbers:!1,lineWrap:!1,tabFocusable:!1,editable:!1}});a.loadEditableState();const i=new E.OutputAreaModel({trusted:!0}),r=new E.SimplifiedOutputArea({model:i,rendermime:this.options.rendermime});let l;(null!==(o=null===(t=null==e?void 0:e.metadata)||void 0===t?void 0:t.tags)&&void 0!==o?o:[]).includes(W)&&(l=a),n=new N({cellIdentity:e.id,cell:r,sourceCell:l,info:s});break}case"markdown":{const t=new k.MarkdownCell({model:e,rendermime:this.options.rendermime,contentFactory:this.options.contentFactory,editorConfig:this.options.editorConfig.markdown});t.initializeState(),t.inputHidden=!1,t.rendered=!0,R.removeElements(t.node,"jp-Collapser"),R.removeElements(t.node,"jp-InputPrompt"),n=new N({cellIdentity:e.id,cell:t,info:s});break}default:{const t=new k.RawCell({model:e,contentFactory:this.options.contentFactory,editorConfig:this.options.editorConfig.raw});t.inputHidden=!1,R.removeElements(t.node,"jp-Collapser"),R.removeElements(t.node,"jp-InputPrompt"),n=new N({cellIdentity:e.id,cell:t,info:s});break}}return n}async executeCell(e,t){if("code"!==e.type||!this._context)return;const o=t.cellOutput,n=e.sharedModel.source,s=await E.SimplifiedOutputArea.execute(n,o,this._context.sessionContext);return o.future.done.then((()=>{t.removePlaceholder()})),s}}!function(e){e.removeElements=function(e,t){const o=e.getElementsByClassName(t);for(let e=0;e<o.length;e++)o[e].remove()}}(R||(R={}));class P extends m.Panel{constructor(e){super(),this._ready=new T.PromiseDelegate,this._outputs=[],this.node.id=e.id,this.title.label=e.label,this.title.closable=!0,this._model=e.model,this._spectaAppConfig=e.spectaConfig,this._layoutRegistry=e.layoutRegistry,this._host=new m.Panel,this._host.addClass("specta-output-host"),this.addWidget(this._host),this.node.style.overflow="auto",M()||this.addSpinner(),this._model.initialize().then((()=>{this.render().catch(console.error).then((()=>window.dispatchEvent(new Event("resize"))))})),this._layoutRegistry.selectedLayoutChanged.connect(this._onSelectedLayoutChanged,this)}get ready(){return this._ready.promise}get model(){return this._model}addSpinner(){const e=this._loaderHost=new m.Widget;e.addClass("specta-loader-host");const t=document.createElement("div");t.className="specta-loader",e.node.appendChild(t);const o=document.createElement("div");o.className="specta-loading-indicator-text",o.textContent="Loading Specta",e.node.appendChild(o),this.addWidget(e)}dispose(){this.isDisposed||(this._model.dispose(),super.dispose())}async render(){var e,t,o,n;const s=null!==(e=this._model.cells)&&void 0!==e?e:[],a=null!==(o=null===(t=this._spectaAppConfig)||void 0===t?void 0:t.layout)&&void 0!==o?o:"default";for(const e of s){if(0===e.sharedModel.source.length)continue;const t=this._model.createCell(e);this._model.executeCell(e,t),this._outputs.push(t)}const i=null!==(n=this._layoutRegistry.get(a))&&void 0!==n?n:this._layoutRegistry.getDefaultLayout();await i.render({host:this._host,items:this._outputs,notebook:this._model.context.model.toJSON(),readyCallback:async()=>{this._loaderHost?(this._loaderHost.node.style.opacity="0",setTimeout((()=>{var e;null===(e=this.layout)||void 0===e||e.removeWidget(this._loaderHost)}),100)):I()}})}onCloseRequest(e){this._model.dispose(),super.onCloseRequest(e)}_onSelectedLayoutChanged(e,t){[...this._host.widgets].forEach((e=>{var t;null===(t=this._host.layout)||void 0===t||t.removeWidget(e)})),t.layout.render({host:this._host,items:this._outputs,notebook:this._model.context.model.toJSON(),readyCallback:async()=>{}})}}class F{constructor(e){this._options=e}async createNew(e){const{context:t}=e,o=this._options.rendermime.clone({resolver:t.urlResolver}),n=new O({context:t,manager:this._options.manager,rendermime:o,tracker:this._options.tracker,contentFactory:this._options.contentFactory,mimeTypeService:this._options.mimeTypeService,editorConfig:a.StaticNotebook.defaultEditorConfig,notebookConfig:a.StaticNotebook.defaultNotebookConfig,editorServices:this._options.editorServices});return new P({id:T.UUID.uuid4(),label:"",model:n,layoutRegistry:this._options.spectaLayoutRegistry,spectaConfig:this._options.spectaConfig})}}const W="specta:visible";function j(e){const{factoryName:t,app:o,rendermime:n,tracker:s,editorServices:a,contentFactory:i,spectaTracker:r,spectaLayoutRegistry:l,spectaConfig:c}=e,d=new F({manager:o.serviceManager,rendermime:n,tracker:s,contentFactory:i,mimeTypeService:a.mimeTypeService,editorServices:a,spectaLayoutRegistry:l,spectaConfig:c}),u=new b({name:t,modelName:"notebook",fileTypes:["notebook"],spectaWidgetFactory:d,preferKernel:!0,canStartKernel:!0,autoStartDefault:!0,shutdownOnClose:!0});o.docRegistry.addWidgetFactory(u),u.widgetCreated.connect(((e,t)=>{t.context.pathChanged.connect((()=>{r.save(t)})),r.add(t)}))}function q(e){const{docManager:t}=e,o=new c.FilterFileBrowserModel({manager:t,auto:!0}),n=new d.VoilaFileBrowser({id:"filebrowser",model:o,restore:!1,urlFactory:e=>{const t=l.PageConfig.getBaseUrl();let o=l.PageConfig.getOption("appUrl");o.endsWith("/")||(o=`${o}/`);const n=new URL(l.URLExt.join(t,o));return n.searchParams.set("path",e),l.PageConfig.getOption("query").split("&").filter(Boolean).forEach((e=>{const[t,o]=e.split("=");n.searchParams.set(t,o)})),n.toString()},title:"Select items to open with Specta."});return n.showFileCheckboxes=!1,n.showLastModifiedColumn=!1,n.addClass("specta-file-browser"),n}function I(){const e=document.getElementById("specta-loader-host"),t=document.getElementById("specta-loader-spinner");e&&t&&(e.style.opacity="0",setTimeout((()=>{t.remove(),e.remove(),document.body.classList.remove("jp-mod-dark","jp-mod-light")}),1e3))}function M(){return!!document.querySelector('meta[name="specta-config"]')}const A=new T.Token("specta:ISpectaLayoutRegistry"),D=new T.Token("exampleDocTracker");var B=o(186);const U={id:"specta:notebook-doc",autoStart:!0,requires:[i.IRenderMimeRegistry,a.INotebookTracker,s.IEditorServices,a.NotebookPanel.IContentFactory,A],activate:(e,t,o,s,a,i)=>{var r;const c=new n.WidgetTracker({namespace:"specta"});return j({factoryName:"specta",app:e,rendermime:t,tracker:o,editorServices:s,contentFactory:a,spectaTracker:c,spectaLayoutRegistry:i,spectaConfig:JSON.parse(null!==(r=l.PageConfig.getOption("spectaConfig"))&&void 0!==r?r:"{}")}),c},provides:D},H={id:"specta/application-extension:opener",autoStart:!0,requires:[r.IDocumentManager,D,B.IKernelSpecManager],activate:async(e,t)=>{if(!M())return;const o=new URLSearchParams(window.location.search).get("path");if(o){const n=t.openOrReveal(o,"specta");n&&e.shell.add(n,"main")}else{const o=q({docManager:t});e.shell.add(o,"main",{rank:100}),I()}}};var J=o(602);class z{async render(e){const{host:t,items:o,readyCallback:n}=e;for(const e of o){const o=e.info.cellModel,n=e.info;null==o||o.cell_type,n.hidden||t.addWidget(e)}await n()}}class Z extends m.Panel{constructor(){super(),this.addClass("specta-article-host-widget"),this._outputs=new m.Panel,this._outputs.addClass("specta-article-outputs-panel"),this.addWidget(this._outputs)}addOutput(e){this._outputs.addWidget(e)}}class ${async render(e){const{host:t,items:o,readyCallback:n}=e,s=new Z;for(const e of o){const t=e.info.cellModel,o=e.info;null==t||t.cell_type,o.hidden||s.addOutput(e)}t.addWidget(s),await n()}}class K{constructor(){this._registry=new Map,this._layoutAdded=new J.Signal(this),this._selectedLayoutChanged=new J.Signal(this);const e=new z;this._registry=new Map,this._registry.set("default",e),this._registry.set("article",new $),this._selectedLayout={name:"default",layout:e}}get layoutAdded(){return this._layoutAdded}get selectedLayout(){return this._selectedLayout}get selectedLayoutChanged(){return this._selectedLayoutChanged}get(e){return this._registry.get(e)}getDefaultLayout(){return this._registry.get("default")}setSelectedLayout(e){if(!this._registry.has(e))throw new Error(`Layout with name ${e} does not exist`);this._selectedLayout={name:e,layout:this._registry.get(e)},this._selectedLayoutChanged.emit(this._selectedLayout)}register(e,t){if(this._registry.has(e))throw new Error(`Layout with name ${e} already exists`);this._registry.set(e,t),this._layoutAdded.emit(e)}allLayouts(){return Array.from(this._registry.keys())}}const V=[U,H,{id:"specta:layout-registry",autoStart:!0,provides:A,activate:e=>{var t,o;const n=new K,s=null!==(o=JSON.parse(null!==(t=l.PageConfig.getOption("spectaConfig"))&&void 0!==t?t:"{}").layout)&&void 0!==o?o:"default";return n.setSelectedLayout(s),n}},{id:"specta:topba",description:"Specta topbar extension",autoStart:!0,requires:[n.IThemeManager,A],activate:(e,t,o)=>{var n;if(!M())return;const s=JSON.parse(null!==(n=l.PageConfig.getOption("spectaConfig"))&&void 0!==n?n:"{}"),a=p.ReactWidget.create(h.createElement(w,{config:s.topBar,themeManager:t,layoutRegistry:o}));a.id="specta-topbar-widget",a.addClass("specta-topbar-element"),e.shell.add(a,"top"),a.parent&&(a.parent.node.style.boxShadow="rgba(0 0 0 / 20%) 0 2px 4px -1px, rgba(0 0 0 / 14%) 0 4px 5px 0, rgba(0 0 0 / 12%) 0 1px 10px 0")}}]}}]);