"use strict";(self.webpackChunkjupyterlab_multicontents_templates=self.webpackChunkjupyterlab_multicontents_templates||[]).push([[147],{147:(e,t,n)=>{n.r(t),n.d(t,{default:()=>x});var a=n(313),s=n(560),o=n(186),l=n(345),i=n.n(l),r=n(689);async function c(e="",t={}){const n=o.ServerConnection.makeSettings(),a=r.URLExt.join(n.baseUrl,"jupyterlab_multicontents_templates",e);let s;try{s=await o.ServerConnection.makeRequest(a,t,n)}catch(e){throw new o.ServerConnection.NetworkError(e)}let l=await s.text();if(l.length>0)try{l=JSON.parse(l)}catch(e){console.log("Not a JSON response body.",s)}if(!s.ok)throw new o.ServerConnection.ResponseError(s,l.message||l);return l}class m extends i().Component{constructor(e){super(e),this.state={items:null,expandChild:!1,loading:!1}}render(){let e=(this.state.items||[]).map((e=>"directory"===e.type?i().createElement(m,{name:e.name,path:e.path,isRoot:!1,onSelect:this.props.onSelect,onContextMenu:this.props.onContextMenu}):"notebook"===e.type?i().createElement("li",{className:"template-item template-notebook"},i().createElement("a",{onClick:()=>this.props.onSelect(e),onContextMenu:()=>this.props.onContextMenu(e)},i().createElement("div",null,i().createElement("span",{className:"jp-multicontents-templates-item-icon"}),i().createElement("span",null,e.name)))):void 0));return this.state.loading&&(e=[i().createElement("li",null,i().createElement("div",{className:"loader"}))]),this.props.isRoot?i().createElement("ul",{className:"template-folder multicontents-templates-ul"}," ",e," "):i().createElement("li",{className:"template-item"},i().createElement("a",{onClick:()=>this.toggle()},i().createElement("div",null,i().createElement("span",{className:null===this.state.items?"jp-multicontents-templates-folded-folder-icon":"jp-multicontents-templates-expanded-folder-icon"}),i().createElement("span",null,this.props.name))),i().createElement("ul",{className:"multicontents-templates-ul"},e," "))}componentDidMount(){this.props.isRoot&&this.expand()}toggle(){const e=!this.state.expandChild;this.props.onSelect({name:this.props.path,path:this.props.path,type:"directory"}),this.setState({expandChild:e}),e?this.expand():this.setState({items:null})}expand(){null===this.state.items&&(this.setState({loading:!0}),c("list",{method:"PUT",body:JSON.stringify({path:this.props.path})}).then((e=>{this.setState({items:e.content,loading:!1})})).catch((e=>{console.error(`Error: ${e}`),this.setState({loading:!1})})))}}class p extends s.ReactWidget{constructor(e,t){super(),this.addClass("jp-ReactWidget"),this.title.iconClass="jp-multicontents-templates-icon",this.title.caption="Templates",this.title.closable=!0,this.onSelect=e,this.onContextMenu=t}render(){return i().createElement("div",{className:"multicontents-templates"},i().createElement("h1",null," Templates "),i().createElement(m,{isRoot:!0,onSelect:this.onSelect,onContextMenu:this.onContextMenu}))}}class h extends i().Component{constructor(e){super(e),this.state={targetPath:null}}render(){return i().createElement("div",null,i().createElement("label",null,"Save to:"),i().createElement("input",{value:this.state.targetPath,onChange:this.handleChange.bind(this),className:"multicontents-save-input"}),i().createElement(m,{isRoot:!0,onSelect:this.onSelect.bind(this)}))}change(e){this.setState({targetPath:e}),this.props.valueFunc(e)}onSelect(e){let t;t="directory"===e.type?e.path+"/"+this.props.srcNotebook.name:e.path,this.change(t)}handleChange(e){this.change(e.target.value)}}class u extends s.ReactWidget{constructor(e){super(),this.srcNotebook=e}render(){return i().createElement("div",null,i().createElement(h,{srcNotebook:this.srcNotebook,valueFunc:this.setValue}))}setValue(e){console.log(`Updated value: ${e}`),u.value=e}getValue(){return u.value}}class d extends s.ReactWidget{constructor(e,t,n){super(),this.name=t,this.path=e,this.importFunc=n}render(){const e=o.ServerConnection.makeSettings(),t=encodeURIComponent(this.path),n=r.URLExt.join(e.baseUrl,"jupyterlab_multicontents_templates",`preview?path=${t}`);return i().createElement("div",{style:{width:"100%",height:"100%"}},i().createElement("div",null,i().createElement("input",{type:"button",value:"Import",style:{margin:"2px",padding:"2px 5px 2px 5px",color:"white",backgroundColor:"#0a6de6",border:"2px solid #0a6de6",borderRadius:"2px"},onClick:()=>this.importFunc(this.path)})),i().createElement("iframe",{style:{width:"100%",height:"100%"},src:n}))}}class g extends s.MainAreaWidget{constructor(e,t,n){super({content:new d(e,t,n)}),this.id="MulticontentsTemplates-preview",this.title.label=`Preview: ${t}`,this.title.closable=!0}}class b extends i().Component{constructor(e){super(e),this.state={shareURL:null},c("share-link",{method:"PUT",body:JSON.stringify({path:this.props.path})}).then((e=>{this.setState({shareURL:new URL(e.path,window.location.href).href})}))}render(){return this.state.shareURL&&s.Clipboard.copyToSystem(this.state.shareURL),i().createElement("div",{className:"share-link"},i().createElement("div",null,"Share with this link: (Already copied to clipboard)"),i().createElement("div",{className:"share-link-url"},i().createElement("input",{onClick:e=>{e.target.select()},className:"share-link-input",value:this.state.shareURL})))}}class y extends s.ReactWidget{constructor(e){super(),this.path=e.path}render(){return i().createElement(b,{path:this.path})}}const x={id:"jupyterlab_multicontents_templates:plugin",autoStart:!0,requires:[a.IFileBrowserFactory,a.IDefaultFileBrowser],activate:(e,t,n)=>{const a=new p((t=>{"notebook"===t.type&&e.commands.execute("multicontentTemplates:preview",{path:t.path,name:t.name})}),(t=>{e.commands.execute("multicontentTemplates:set-context",{path:t.path,name:t.name})})),{tracker:l}=t;let i=null;a.id="template:list",e.shell.add(a,"left"),e.commands.addCommand("multicontentTemplates:preview",{caption:"Preview Template Notebook",execute:t=>{null!==i&&i.close(),i=new g(String(t.path),String(t.name),(t=>{e.commands.execute("multicontentTemplates:import",{path:t})})),i.isAttached||e.shell.add(i,"main"),e.shell.activateById(i.id)}}),e.commands.addCommand("multicontentTemplates:import",{caption:"import notebook",execute:t=>{const a=String(t.path),s=o.ServerConnection.makeSettings();let l="",r=function(e){const t=e.indexOf("_");if(-1===t)return e.toLowerCase();let n=e.slice(0,t);const a=e.slice(t);return n=n.toLowerCase(),n.endsWith("ies")&&(n=n.slice(0,-3)+"y"),n.endsWith("s")&&(n=n.slice(0,-1)),n+a}(a.replace("/","_"));c("content",{method:"PUT",body:JSON.stringify({path:a})}).then((t=>{const a=n.model.path;return new Promise((n=>{e.commands.execute("docmanager:new-untitled",{path:a,type:"notebook"}).then((async e=>{l=e.path;const t=[],n=`${s.baseUrl}api/contents`,i=await o.ServerConnection.makeRequest(n,{method:"GET"},s);JSON.parse(await i.text()).content.forEach((e=>{"notebook"===e.type&&t.push(e.name)}));const c=r.split(".")[0];let m=1,p=r;for(;t.includes(p);){const e=c.match(/_\d+$/)?"":"_";p=`${c.replace(/_\d+$/,"")}${e}${m}.ipynb`,m++}return r=a.length>0?`${a}/${p}`:p,e})).then((async e=>{const t=`${s.baseUrl}api/contents/${l}`,n={method:"PATCH",body:JSON.stringify({path:`${r}`})};return await o.ServerConnection.makeRequest(t,n,s),e})).then((()=>(i.close(),e.commands.execute("docmanager:open",{factory:"Notebook",path:r})))).then((e=>e.context.ready.then((()=>{e.model.fromJSON(t.content),n(e)})))).then((()=>e.commands.execute("docmanager:save")))}))}))}}),e.commands.addCommand("multicontentTemplates:publish",{label:"Publish Notebook",iconClass:"jp-multicontents-templates-icon",execute:e=>{const t=l.currentWidget.selectedItems().next();(0,s.showDialog)({title:"Publish Location",body:new u(t.value),buttons:[s.Dialog.cancelButton(),s.Dialog.okButton({label:"Publish"})]}).then((e=>{"Publish"===e.button.label&&c("publish",{method:"PUT",body:JSON.stringify({source_path:t.value.path,target_path:e.value})}).then((e=>{(0,s.showDialog)({title:"Success!",body:`successfully saved template to: ${e.path}`,buttons:[s.Dialog.okButton()]})})).catch((e=>{(0,s.showDialog)({title:"Error",body:e.message,buttons:[s.Dialog.okButton()]})}))}))}}),e.contextMenu.addItem({command:"multicontentTemplates:publish",selector:'.jp-DirListing-item[data-file-type="notebook"]',rank:3});const r=new URLSearchParams(window.location.search);if(r.get("template-preview")){const t=r.get("template-preview");c("decode-link",{method:"PUT",body:JSON.stringify({path:t})}).then((t=>{const n=t.path,a=t.path.split("/").pop();console.log(`Found preview path: ${n}`),Promise.all([e.restored]).then((()=>{e.commands.execute("multicontentTemplates:preview",{path:n,name:a})}))}))}let m;e.commands.addCommand("multicontentTemplates:set-context",{label:"set context",execute:e=>{m={path:String(e.path),name:String(e.name)}}}),e.commands.addCommand("multicontentTemplates:share-templates",{label:"Share Template",execute:e=>{(0,s.showDialog)({title:"Share URL",body:new y({path:String(m.path),name:String(m.name),type:"notebook"}),buttons:[s.Dialog.okButton()]})}}),e.contextMenu.addItem({command:"multicontentTemplates:share-templates",selector:".template-notebook"}),console.log("JupyterLab extension jupyterlab_multicontents_templates is activated!")}}}}]);