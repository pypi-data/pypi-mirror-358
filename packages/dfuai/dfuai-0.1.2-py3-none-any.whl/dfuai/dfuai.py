import pandas as pd
from openai import OpenAI

def dfuai(filepath="./test.csv", i=0, model="deepseek-chat", api="sk-335fad925ff4488088735bc65856a772", base_url="https://api.deepseek.com"):
    """
    This function processes the diabetic foot data, sends the data to a GPT model,
    and saves the output to a text file.

    Parameters:
    - filepath (str): Path to the input CSV file (default is "./test.csv").
    - i (int): Index of the row to process from the CSV file (default is 0).
    - model (str): The model to use for the GPT completion (default is "gpt-4o").
    - api (str): API key for OpenAI or DeepSeek (default is "sk-335fad925ff4488088735bc65856a772").
    - base_url (str): Base URL for the DeepSeek API (default is "https://api.deepseek.com").
    """
    #import pandas as pd
    #from openai import OpenAI
    # Initialize the OpenAI client
    client = OpenAI(api_key=api, base_url=base_url)

    # Define the prompt to send to the model
    prompt = """“As a diabetes expert, especially proficient in the diagnosis of diabetic foot, 
    please review the laboratory and clinical characteristics data of diabetic foot in the first part that I have uploaded. 
    In the data, the ‘GROUP’ column indicates that 0 represents mild or moderate diabetic foot, 
    and 1 represents severe diabetic foot. If you can identify it, please answer ‘yes’ and then speculate whether the data 
    in the second part corresponds to severe diabetic foot. Below is the data for the first part: 
   GROUP	PAD	CRP	HbA1c	DKD	ESR	ALB	SBP	X25OHD
    1	0	0	1	0	0	0	1	1
    1	0	1	1	0	0	0	1	1
    1	1	1	1	1	1	0	0	1
    1	1	1	1	1	1	1	0	1
    1	1	0	1	1	0	0	0	1
    1	0	0	1	1	1	0	0	1
    1	0	1	1	0	1	0	1	1
    1	1	1	1	1	0	0	0	1
    1	1	0	1	1	0	0	0	1
    1	0	1	1	1	0	0	1	1
    0	1	0	0	0	0	1	1	1
    1	1	1	1	1	0	1	0	1
    1	1	1	0	1	0	0	1	1
    1	1	0	1	1	0	0	1	1
    1	1	0	0	0	1	0	1	0
    1	1	0	0	1	1	1	0	1
    1	1	0	1	0	1	0	1	1
    1	0	1	1	0	0	0	0	1
    0	1	0	0	0	0	0	0	1
    1	1	0	1	1	0	1	0	1
    1	1	1	0	0	0	1	0	1
    1	1	0	1	0	0	0	1	0
    1	1	0	1	0	1	0	0	1
    0	0	0	0	0	0	1	0	1
    0	0	0	0	1	0	1	0	1
    1	0	1	1	0	0	0	0	1
    1	1	0	1	1	1	0	0	1
    1	0	1	1	0	0	1	1	1
    0	1	0	0	0	0	0	1	0
    1	0	0	1	0	1	0	0	0
    1	1	1	0	1	1	0	0	1
    0	1	0	0	1	0	1	0	1
    1	1	0	1	0	0	0	0	1
    0	1	0	1	0	0	0	0	1
    1	1	0	1	1	0	0	1	1
    0	0	0	0	0	0	0	0	1
    0	1	0	0	1	0	0	0	1
    1	1	0	1	1	0	0	0	1
    1	1	1	1	1	1	1	0	1
    1	1	0	1	0	0	0	0	1
    1	1	0	1	0	1	0	0	0
    0	0	0	0	0	0	0	0	1
    0	1	0	1	0	0	0	0	1
    1	1	0	1	1	0	0	0	1
    0	0	0	0	0	0	1	1	0
    1	1	0	0	1	0	0	1	1
    1	1	1	1	1	1	0	0	0
    1	1	0	1	0	1	1	0	1
    1	1	0	1	1	1	0	0	1
    0	0	0	1	0	0	1	1	0
    0	1	0	1	0	0	0	0	0
    1	1	0	0	0	1	1	1	0
    1	0	1	1	1	1	0	1	1
    0	1	0	1	0	0	0	0	1
    1	1	0	1	0	0	1	0	0
    1	0	1	0	1	0	0	0	1
    0	1	0	0	0	0	1	1	0
    0	0	0	1	1	0	1	0	1
    0	0	0	0	1	1	0	0	0
    1	1	1	0	0	0	0	1	1
    1	1	1	1	0	1	0	0	1
    1	1	0	0	1	1	1	1	1
    1	1	1	0	1	0	1	1	0
    1	0	0	1	1	0	0	0	1
    1	1	0	0	1	1	0	0	1
    1	1	1	1	1	0	0	0	1
    1	0	1	1	1	0	1	0	1
    0	0	0	1	1	0	0	0	1
    1	1	1	1	1	0	1	0	1
    1	1	0	1	1	0	0	1	1
    1	1	0	0	0	1	0	1	1
    0	1	0	1	1	0	0	0	1
    1	1	0	1	0	0	0	0	0
    1	0	1	1	0	0	0	0	1
    1	1	1	1	1	0	0	0	1
    1	1	1	0	1	1	0	0	1
    1	1	0	1	1	0	1	0	0
    1	1	1	0	0	0	1	0	1
    1	1	1	1	1	0	1	0	1
    1	1	1	1	1	1	0	0	0
    1	0	0	0	0	0	0	0	0
    1	1	1	0	1	1	1	0	1
    1	1	1	1	0	0	0	0	1
    1	1	1	1	1	0	1	0	1
    1	1	0	1	0	1	0	0	1
    1	0	1	0	0	0	0	0	1
    1	1	0	1	0	0	1	0	1
    1	1	1	1	0	1	0	1	1
    1	1	1	0	1	0	0	0	1
    0	1	0	0	0	0	1	0	0
    1	1	0	1	1	0	0	0	1
    1	1	0	0	0	1	1	1	0
    1	1	1	1	1	1	0	0	1
    0	1	0	1	0	0	1	1	0
    0	0	0	1	0	0	1	0	1
    1	0	0	1	1	0	1	0	1
    1	1	0	1	1	0	0	0	0
    1	0	0	1	0	0	0	1	1
    1	1	0	0	0	1	1	0	1
    1	1	1	1	1	1	0	0	1
    1	1	1	0	0	0	1	0	1
    1	1	1	1	0	1	0	1	1
    1	1	1	0	1	0	1	0	1
    1	1	1	0	0	0	0	0	1
    1	1	1	1	0	0	1	1	1
    1	1	1	0	1	1	0	0	0
    1	1	1	0	0	1	0	0	1
    0	0	0	1	0	0	1	1	0
    0	0	0	0	0	0	1	0	1
    1	1	1	1	0	0	0	0	1
    1	1	0	1	1	1	0	0	1
    0	0	0	1	1	0	1	0	1
    1	1	1	0	0	1	1	0	1
    1	1	1	0	0	0	0	1	1
    1	1	0	1	1	0	0	0	1
    1	1	0	1	0	1	0	1	0
    0	1	0	0	0	0	0	0	0
    0	1	0	0	0	0	0	0	1
    0	1	0	0	0	0	1	1	1
    1	0	0	1	1	0	0	0	1
    0	0	0	0	0	1	1	0	0
    1	0	0	1	0	1	0	0	1
    0	0	0	0	0	0	1	0	1
    1	1	0	1	1	1	0	0	1
    1	1	0	0	0	1	1	0	1
    1	0	0	1	1	1	1	0	1
    1	0	0	1	0	1	0	0	1
    1	0	0	1	0	1	1	0	1
    0	0	0	1	0	1	1	0	1
    1	1	0	0	0	0	1	1	1
    0	1	0	0	1	0	1	1	0
    0	0	0	0	0	1	1	0	0
    1	1	0	0	1	1	1	0	1
    1	1	0	1	0	0	1	0	1
    1	1	0	1	0	1	1	0	1
    1	1	0	0	0	0	0	0	1
    0	0	0	0	0	0	1	0	1
    0	0	0	1	0	1	0	1	0
    1	1	0	1	0	0	1	0	1
    1	1	1	1	1	1	1	0	1
    0	0	0	0	0	1	0	0	1
    0	0	0	0	0	0	1	0	1
    1	1	0	1	1	0	1	1	1
    0	0	0	0	1	0	1	0	1
    1	1	0	1	0	0	1	0	1
    1	1	1	1	0	0	1	1	1
    1	1	0	1	1	1	1	0	1
    1	1	1	1	0	0	0	0	1
    1	1	0	0	0	0	0	0	1
    0	1	0	1	1	1	1	1	0
    1	1	0	0	1	1	1	0	0
    1	1	0	0	1	1	1	0	1
    1	1	0	0	0	1	1	0	1
    1	1	0	0	0	0	1	1	0
    1	1	0	1	1	0	0	0	0
    1	0	0	1	0	0	1	0	1
    1	1	1	1	1	0	0	1	1
    1	0	0	1	1	0	1	0	1
    0	1	0	0	0	0	1	1	1
    0	0	0	0	0	0	0	0	1
    1	1	0	1	1	1	0	0	1
    1	0	1	0	0	0	0	0	1
    1	0	0	0	1	0	1	1	1
    1	1	0	0	1	1	1	0	1
    0	1	0	0	1	0	1	0	1
    1	1	1	0	0	0	1	0	1
    1	1	0	1	0	0	0	0	1
    0	0	0	0	1	0	0	1	1
    1	1	1	1	0	1	0	0	1
    0	0	0	1	0	0	0	1	1
    0	0	0	1	0	0	0	0	1
    0	0	0	0	0	0	0	0	1
    1	1	0	0	1	1	0	0	1
    1	1	0	1	1	0	0	0	1
    1	1	1	1	1	1	0	0	1
    1	0	0	1	1	1	0	1	0
    1	0	0	1	1	0	0	0	1
    0	1	0	0	1	0	1	0	1
    1	1	0	0	1	1	0	0	1
    1	1	0	1	1	0	0	0	1
    1	1	0	0	0	1	1	0	1
    1	0	0	0	0	1	1	1	1
    1	1	0	1	0	1	1	1	1
    0	1	0	0	0	0	1	0	1
    0	0	0	0	0	1	1	0	0
    0	1	0	0	0	0	1	1	1
    1	1	0	1	1	1	0	0	1
    1	1	0	1	0	0	1	0	1
    1	1	0	1	0	1	1	0	1
    1	1	0	1	1	1	0	0	1
    0	1	0	0	0	0	1	0	1
    0	0	0	0	0	0	1	0	1
    1	0	0	1	0	0	0	1	1
    0	1	0	0	1	0	1	1	1
    1	0	0	0	0	0	1	0	1
    1	1	0	0	0	1	0	0	1
    1	1	0	1	1	0	1	0	1
    1	1	0	0	0	0	0	0	1
    0	0	0	0	1	0	0	0	1
    0	0	0	1	1	1	1	1	1
    0	0	0	0	0	0	0	1	1
    1	0	0	1	0	1	0	0	1
    0	1	0	0	1	0	0	0	1
    1	0	0	1	1	0	1	0	1
    0	1	0	0	0	0	1	1	1
    0	0	0	1	0	0	0	1	1
    0	1	0	1	0	0	0	0	0
    1	1	1	1	1	1	0	1	1
    1	0	1	0	1	0	1	0	0
    0	0	0	0	0	0	1	1	1
    0	0	0	0	0	0	1	0	1
    1	0	1	1	1	0	1	1	1
    1	1	0	1	0	1	0	1	0
    0	0	0	0	1	0	0	0	1
    1	0	1	0	1	0	1	1	1
    1	1	0	0	0	1	0	0	1
    1	1	0	1	0	0	0	0	1
    1	1	1	1	0	0	1	0	1
    1	1	1	0	1	0	1	1	1
    1	0	0	1	0	0	1	0	0
    0	0	0	0	0	1	0	0	1
    1	0	0	1	0	0	1	1	1
    0	0	0	1	0	0	0	1	0
    0	0	0	0	1	0	1	1	1
    0	0	0	0	0	0	1	0	0
    1	1	1	0	0	0	1	0	1
    0	1	0	0	1	0	1	0	1
    0	0	0	0	0	0	0	0	1
    0	0	0	1	1	0	1	0	1
    1	1	1	0	1	0	0	0	1
    0	1	0	1	0	0	0	0	1
    0	1	0	0	1	0	1	0	1
    1	1	0	1	0	1	1	0	1
    1	1	0	0	0	1	0	0	1
    1	1	1	1	0	0	1	0	0
    1	0	1	1	1	0	0	0	1
    1	1	1	1	0	1	1	0	0
    1	0	0	1	1	1	0	0	1
    1	1	0	0	1	1	1	1	1
    1	1	0	1	0	0	0	1	0
    1	1	0	0	1	1	1	1	1
    1	1	0	0	1	1	0	1	0
    1	0	0	1	0	0	1	0	1
    1	0	0	0	0	0	1	0	1
    1	1	1	0	0	0	1	0	1
    1	0	1	1	1	0	1	1	1
    1	0	0	1	0	1	1	0	1
    1	0	1	0	0	1	1	0	0
    1	1	0	0	0	1	1	1	1
    0	0	0	0	0	0	1	0	1
    1	0	0	1	0	1	0	0	0
    1	1	0	0	1	1	1	1	1
    1	1	0	0	0	0	0	1	0
    0	0	0	0	0	0	1	0	1
    0	0	0	0	1	0	0	0	1
    1	1	0	1	1	0	1	0	1
    1	1	0	0	0	1	0	0	1
    1	1	0	1	0	0	0	0	1
    1	1	0	1	0	0	1	0	0
    1	1	0	0	1	1	1	1	1
    0	0	0	0	0	0	0	0	1
    1	0	0	1	0	0	1	0	0
    0	1	0	0	0	0	1	0	0
    1	1	0	0	0	1	0	0	0
    1	1	0	0	1	0	1	0	1
    0	1	0	0	0	0	0	1	1
    1	1	0	0	0	0	1	0	1
    1	1	0	1	0	1	0	0	1
    1	1	0	0	0	1	1	0	1
    1	1	0	1	0	0	0	1	1
    1	1	1	0	0	0	0	0	1
    0	1	1	0	0	0	1	1	0
    1	0	0	0	0	0	0	0	1
    0	0	0	0	1	0	0	1	0
    1	1	0	0	1	1	1	1	1
    1	0	0	0	1	0	1	0	0
    0	0	0	0	1	0	0	1	0
    0	0	0	0	0	0	0	0	0
    1	1	1	1	0	0	1	0	1
    1	1	0	1	0	1	1	0	1
    1	1	0	1	0	1	0	0	1
    0	1	0	1	1	0	1	1	1
    1	1	0	1	1	0	0	1	0
    0	1	0	1	0	0	1	0	1
    1	1	1	1	0	0	1	0	1
    1	1	0	1	1	0	1	0	1
    0	0	0	0	0	0	0	1	1
    1	0	0	0	0	0	0	0	1
    0	1	0	0	0	0	1	0	1
    0	0	0	0	1	0	1	1	1
    1	0	1	0	0	0	0	1	1
    1	1	0	1	1	0	0	0	1
    1	1	0	1	0	1	0	0	1
    1	0	0	0	0	0	1	0	1
    1	0	1	1	0	0	0	0	1
    0	1	0	0	1	0	0	1	1
    1	1	0	0	0	1	1	1	0
    0	0	0	0	0	0	1	1	1
    0	1	0	0	1	0	1	1	0
    0	0	0	0	0	0	1	1	1
    1	1	0	1	0	0	0	1	1
    1	1	1	0	0	0	0	0	1
    1	1	0	0	0	1	1	1	1
    0	0	0	0	1	1	0	1	1
    1	1	1	1	1	0	0	0	1
    1	1	0	1	0	0	0	0	1
    1	1	0	1	0	0	1	1	1
    0	0	0	0	1	0	0	1	1
    1	0	0	0	1	0	1	0	1
    1	1	0	1	1	0	1	0	0
    0	0	0	0	1	1	0	0	1
    0	0	0	1	1	0	1	0	1
    0	0	0	0	0	0	1	1	0
    1	1	0	1	1	1	0	0	1
    0	0	0	0	0	0	1	0	1
    0	0	0	1	0	0	1	0	1
    0	0	0	0	0	0	1	0	1
    1	1	0	1	0	1	0	0	1
    1	0	0	1	0	1	1	0	1
    0	0	0	0	0	0	1	1	1
    1	1	0	1	0	0	1	0	1
    1	1	0	1	0	0	1	0	1
    1	1	1	1	0	0	1	0	1
    1	1	0	0	1	1	1	0	1
    1	0	0	0	1	0	1	0	1
    0	1	0	0	0	0	0	0	1
    1	0	0	0	1	0	0	0	1
    0	0	0	1	0	0	1	1	1
    0	0	0	0	0	0	1	0	1
    1	1	0	1	0	1	1	1	1
    1	1	0	1	0	1	0	1	0
    1	0	0	1	0	0	0	0	0
    0	1	0	0	0	0	1	1	1
    1	1	0	1	0	0	1	0	1
    0	0	0	0	0	0	1	1	1
    0	1	0	1	1	0	1	1	1
    0	0	0	1	0	0	0	0	0
    0	0	0	0	1	0	1	0	1
    1	1	1	0	1	0	1	0	1
    1	1	1	1	1	0	1	1	1
    1	1	0	0	1	1	1	1	1
    1	1	0	1	1	0	0	0	1
    0	0	1	0	0	0	1	0	1
    0	0	0	0	0	0	0	0	0
    0	0	0	0	0	0	1	0	1
    1	1	1	1	0	0	1	0	1
    1	1	0	1	1	1	0	1	0
    1	0	0	0	1	0	0	0	1
    1	0	1	1	1	0	0	0	0
    1	1	1	1	1	0	0	0	1
    0	0	0	0	0	0	1	1	0
    1	1	1	0	0	0	1	0	1
    1	1	0	1	1	1	0	0	1
    0	0	0	1	1	0	0	0	1
    1	0	0	1	0	0	0	1	1
    1	1	0	1	1	1	0	0	1
    1	1	0	0	0	1	0	0	1
    0	0	0	0	0	0	1	0	0
    0	1	0	0	0	0	1	0	1
    0	1	0	0	0	0	1	0	1
    1	1	1	1	1	0	1	0	1
    1	1	0	1	1	0	1	1	1
    0	0	0	0	0	1	1	1	1
    1	1	1	1	0	0	1	1	1
    0	1	0	0	0	0	0	0	1
    1	1	0	0	1	1	1	0	1
    1	0	1	0	1	0	1	1	1
    1	1	1	1	0	0	0	1	1
    1	1	1	1	1	0	1	1	1
    1	1	1	1	0	0	0	0	0
    1	1	0	1	0	1	0	0	0
    1	0	0	1	1	0	1	0	1
    1	1	0	0	1	1	1	0	1
    0	1	0	0	0	0	0	0	1
    0	1	0	1	0	0	1	1	1
    0	0	0	0	0	0	1	0	1
    1	1	0	1	0	0	1	0	1
    0	0	0	1	0	0	1	0	1
    1	1	0	1	0	1	0	1	0
    1	0	0	1	0	0	0	0	0
    0	1	0	0	0	0	1	1	1
    1	1	0	1	0	0	1	0	1
    0	0	0	1	1	0	1	1	1
    0	1	0	0	1	0	1	0	1
    1	1	1	0	0	0	1	0	1
    0	0	0	0	0	0	0	0	1
    0	0	0	0	1	0	0	1	1
    1	1	0	0	0	1	1	1	0
    0	0	0	0	0	0	1	1	1
    0	0	0	0	0	0	1	1	0
    0	0	0	1	0	0	0	0	1
    1	1	1	0	1	0	0	1	1
    0	0	0	0	0	0	1	1	1
    0	0	0	0	0	0	1	1	1
    1	1	0	0	1	1	0	0	1
    1	1	0	1	0	0	1	0	0
    1	0	0	1	0	0	1	0	0
    0	1	0	0	0	0	1	0	0
    1	1	0	0	0	1	0	0	0
    1	1	1	1	1	1	0	0	1
    1	1	0	0	1	0	1	0	1
    0	1	0	0	0	0	1	1	0
    1	0	1	1	1	1	0	0	1
    0	0	0	1	0	0	1	1	0
    0	0	0	1	0	0	1	0	1
    1	1	0	1	1	0	0	0	0
    1	1	0	0	0	1	1	0	1
    1	1	1	1	1	1	0	0	1
    1	1	1	0	1	0	1	0	1
    1	1	1	1	0	1	0	1	1
    1	1	1	0	0	0	1	0	1
    1	1	1	0	0	0	0	0	1
    1	1	1	0	1	0	0	0	1
    1	1	1	1	0	0	1	1	1
    1	1	1	0	0	0	1	0	1
    1	0	1	0	1	1	0	0	0
    1	1	1	1	1	1	0	1	1
    1	1	1	0	0	1	0	0	1
    0	1	0	1	0	0	1	1	0
    1	1	1	1	0	1	1	0	1
    0	1	0	0	0	0	1	1	0
    1	1	1	0	1	0	0	1	1
    0	0	0	0	1	0	1	1	1
    0	0	0	0	0	0	1	1	1
    1	1	0	0	1	1	0	0	1
    Below is the data for the second part: """

    # Load the CSV data into a DataFrame
    test = pd.read_csv(filepath)

    # Extract the row at index 'i' (default is the first row)
    first_row = test.iloc[i]
    num = test.loc[:,"id"][i]

    # Create the data string by combining the column names and their corresponding values from the row
    result = ' '.join([f"{col}:{first_row[col]}" for col in test.columns])

    # Print index and row data for debugging purposes
    print(i)
    print(result)

    # Send the data to the GPT model for processing
    chat_completion = client.chat.completions.create(
        messages=[
            {
                "role": "user",
                "content": f"{prompt}{result},",
            }
        ],
        model=model,
    )

    # Output the result from the model
    r1 = chat_completion.choices[0].message.content
    print(r1)

    # Save the result to a text file
    with open(f"第{i}个样本的{num}_output.txt", "w", encoding="utf-8") as file:
        file.write(r1)