Metadata-Version: 2.4
Name: easyscan-server
Version: 0.1.4
Summary: EasyScan Server - A FastAPI-based server for EasyScan
Requires-Python: >=3.13
Description-Content-Type: text/markdown
License-File: LICENSE
Requires-Dist: fakeredis>=2.30.1
Requires-Dist: fastapi[standard]>=0.115.12
Requires-Dist: redis>=6.2.0
Requires-Dist: textual>=3.5.0
Requires-Dist: uvicorn>=0.34.3
Dynamic: license-file

# EasyScan Server

ä¸€ä¸ªåŸºäºFastAPIçš„URLçŸ­é“¾æ¥æœåŠ¡ï¼Œæ”¯æŒå®æ—¶äºŒç»´ç ç”Ÿæˆå’ŒServer-Sent Events (SSE) æ¨é€æ›´æ–°ã€‚

## ğŸš€ åŠŸèƒ½ç‰¹æ€§

- **URLçŸ­é“¾æ¥æœåŠ¡**: ç”ŸæˆçŸ­é“¾æ¥å¹¶æ”¯æŒé‡å®šå‘
- **å®æ—¶äºŒç»´ç **: åŠ¨æ€ç”ŸæˆäºŒç»´ç ï¼Œæ”¯æŒå®æ—¶æ›´æ–°
- **Server-Sent Events**: å®æ—¶æ¨é€URLå’Œåç§°å˜æ›´
- **Rediså­˜å‚¨**: æ”¯æŒRediså’ŒFakeRedisï¼ˆå¼€å‘/æµ‹è¯•ï¼‰
- **RESTful API**: å®Œæ•´çš„REST APIæ¥å£
- **Dockeræ”¯æŒ**: å®¹å™¨åŒ–éƒ¨ç½²
- **å¯é€‰åç§°**: ä¸ºURLæ·»åŠ è‡ªå®šä¹‰åç§°

## ğŸ“¦ å®‰è£…

### ä½¿ç”¨ pip å®‰è£…

```bash
pip install easyscan-server
```

### ä»æºç å®‰è£…

```bash
git clone https://github.com/LiYulin-s/easyscan-server.git
cd easyscan-server
pip install -e .
```

## ğŸƒ å¿«é€Ÿå¼€å§‹

### å¯åŠ¨æœåŠ¡å™¨

```bash
# ä½¿ç”¨é»˜è®¤é…ç½®å¯åŠ¨
python -m easyscan_server

# è‡ªå®šä¹‰ä¸»æœºå’Œç«¯å£
python -m easyscan_server --host 0.0.0.0 --port 8080
```

### ä½¿ç”¨Docker

#### ä»GitHub Container Registryæ‹‰å–ï¼ˆæ¨èï¼‰

```bash
# æ‹‰å–æœ€æ–°ç‰ˆæœ¬
docker pull ghcr.io/liyulin-s/easyscan-server:latest

# è¿è¡Œå®¹å™¨
docker run -p 8000:8000 ghcr.io/liyulin-s/easyscan-server:latest

# æˆ–è€…æ‹‰å–æŒ‡å®šç‰ˆæœ¬
docker pull ghcr.io/liyulin-s/easyscan-server:v0.1.2
docker run -p 8000:8000 ghcr.io/liyulin-s/easyscan-server:v0.1.2
```

#### æœ¬åœ°æ„å»º

```bash
# æ„å»ºé•œåƒ
docker build -t easyscan-server .

# è¿è¡Œå®¹å™¨
docker run -p 8000:8000 easyscan-server
```

## ğŸ”§ é…ç½®

### ç¯å¢ƒå˜é‡

- `USE_REAL_REDIS`: è®¾ç½®æ­¤å˜é‡ä»¥ä½¿ç”¨çœŸå®çš„Redisï¼ˆå¦åˆ™ä½¿ç”¨FakeRedisï¼‰
- `REDIS_URL`: Redisè¿æ¥URLï¼ˆé»˜è®¤: `redis://localhost:6379`ï¼‰

### ç¤ºä¾‹é…ç½®

```bash
# ä½¿ç”¨çœŸå®Redis
export USE_REAL_REDIS=1
export REDIS_URL=redis://localhost:6379

# å¯åŠ¨æœåŠ¡
python -m easyscan_server
```

## ğŸš€ CI/CD è‡ªåŠ¨åŒ–

æœ¬é¡¹ç›®åŒ…å«å®Œæ•´çš„ CI/CD æµç¨‹ï¼š

### è‡ªåŠ¨å‘å¸ƒ

- **PyPIå‘å¸ƒ**: å½“æ¨é€ç¬¦åˆ `v*.*.*` æ ¼å¼çš„æ ‡ç­¾æ—¶ï¼Œè‡ªåŠ¨æ„å»ºå¹¶å‘å¸ƒPythonåŒ…åˆ°PyPI
- **Dockeré•œåƒ**: è‡ªåŠ¨æ„å»ºå¤šæ¶æ„Dockeré•œåƒå¹¶æ¨é€åˆ°GitHub Container Registry

### å‘å¸ƒæµç¨‹

1. æ›´æ–° `pyproject.toml` ä¸­çš„ç‰ˆæœ¬å·
2. åˆ›å»ºå¹¶æ¨é€ç‰ˆæœ¬æ ‡ç­¾ï¼š
   ```bash
   git tag v0.1.3
   git push origin v0.1.3
   ```
3. GitHub Actionså°†è‡ªåŠ¨ï¼š
   - æ„å»ºPythonåŒ…å¹¶å‘å¸ƒåˆ°PyPI
   - æ„å»ºDockeré•œåƒï¼ˆæ”¯æŒ amd64 å’Œ arm64ï¼‰å¹¶æ¨é€åˆ°GHCR

### æ‰‹åŠ¨è§¦å‘

ä¹Ÿå¯ä»¥åœ¨GitHub Actionsé¡µé¢æ‰‹åŠ¨è§¦å‘Dockeré•œåƒæ„å»ºã€‚

## ğŸ“š API æ–‡æ¡£

### åˆ›å»ºçŸ­é“¾æ¥

```http
POST /
Content-Type: application/json

{
    "url": "https://example.com",
    "name": "ç¤ºä¾‹ç½‘ç«™"
}
```

**å“åº”:**
```json
{
    "key": "abc123def456",
    "url": "https://example.com",
    "name": "ç¤ºä¾‹ç½‘ç«™",
    "success": true
}
```

### è·å–URLä¿¡æ¯

```http
GET /{key}
```

**å“åº”:**
```json
{
    "key": "abc123def456",
    "url": "https://example.com",
    "name": "ç¤ºä¾‹ç½‘ç«™"
}
```

### æ›´æ–°ç°æœ‰é“¾æ¥

```http
POST /{key}
Content-Type: application/json

{
    "url": "https://newexample.com",
    "name": "æ–°ç¤ºä¾‹ç½‘ç«™"
}
```

### é‡å®šå‘åˆ°ç›®æ ‡URL

```http
GET /{key}/redirect
```

### æŸ¥çœ‹äºŒç»´ç é¡µé¢

```http
GET /{key}/qrcode
```

### Server-Sent Events

```http
GET /sse/{key}
```


## ğŸ—ï¸ é¡¹ç›®ç»“æ„

```
easyscan-server/
â”œâ”€â”€ __init__.py
â”œâ”€â”€ __main__.py          # ç¨‹åºå…¥å£ç‚¹
â”œâ”€â”€ main.py             # FastAPIåº”ç”¨ä¸»æ–‡ä»¶
â”œâ”€â”€ domain.py           # æ•°æ®å±‚å’Œä¸šåŠ¡é€»è¾‘
â”œâ”€â”€ type.py             # Pydanticæ¨¡å‹å®šä¹‰
â””â”€â”€ templates/
    â””â”€â”€ qrcode.html     # äºŒç»´ç é¡µé¢æ¨¡æ¿
```

## ğŸ§ª å¼€å‘

### è®¾ç½®å¼€å‘ç¯å¢ƒ

```bash
# å…‹éš†ä»“åº“
git clone https://github.com/LiYulin-s/easyscan-server.git
cd easyscan-server

# å®‰è£…ä¾èµ–
pip install -e .

# è¿è¡Œå¼€å‘æœåŠ¡å™¨
python -m easyscan_server --host 0.0.0.0 --port 8000
```

### ä¾èµ–é¡¹

- **FastAPI**: Webæ¡†æ¶
- **Uvicorn**: ASGIæœåŠ¡å™¨
- **Redis**: æ•°æ®å­˜å‚¨
- **FakeRedis**: æµ‹è¯•ç”¨Redisæ¨¡æ‹Ÿå™¨
- **Pydantic**: æ•°æ®éªŒè¯
- **Jinja2**: æ¨¡æ¿å¼•æ“
- **Typer**: CLIå·¥å…·

## ğŸ³ Docker éƒ¨ç½²

### å¿«é€Ÿå¼€å§‹

#### ä»GitHub Container Registryéƒ¨ç½²ï¼ˆæ¨èï¼‰

```bash
# åŸºæœ¬éƒ¨ç½² - ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬
docker run -p 8000:8000 ghcr.io/liyulin-s/easyscan-server:latest

# ä½¿ç”¨æŒ‡å®šç‰ˆæœ¬
docker run -p 8000:8000 ghcr.io/liyulin-s/easyscan-server:v0.1.2
```

#### æœ¬åœ°æ„å»ºéƒ¨ç½²

```bash
# å…‹éš†å¹¶æ„å»º
git clone https://github.com/LiYulin-s/easyscan-server.git
cd easyscan-server
docker build -t easyscan-server .
docker run -p 8000:8000 easyscan-server
```

### ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

#### ä½¿ç”¨çœŸå®Rediséƒ¨ç½²

```bash
# å¯åŠ¨Rediså®¹å™¨
docker run -d --name redis redis:alpine

# å¯åŠ¨EasyScan Serverå¹¶è¿æ¥Redis
docker run -p 8000:8000 \
  -e USE_REAL_REDIS=1 \
  -e REDIS_URL=redis://redis:6379 \
  --link redis:redis \
  ghcr.io/liyulin/easyscan-server:latest
```

#### Docker Composeéƒ¨ç½²

åˆ›å»º `docker-compose.yml` æ–‡ä»¶ï¼š

```yaml
version: '3.8'
services:
  redis:
    image: redis:alpine
    restart: unless-stopped
    ports:
      - "6379:6379"
    volumes:
      - redis_data:/data
  
  easyscan-server:
    image: ghcr.io/liyulin-s/easyscan-server:latest
    restart: unless-stopped
    ports:
      - "8000:8000"
    environment:
      - USE_REAL_REDIS=1
      - REDIS_URL=redis://redis:6379
    depends_on:
      - redis

volumes:
  redis_data:
```

å¯åŠ¨æœåŠ¡ï¼š

```bash
docker-compose up -d
```

### å¤šæ¶æ„æ”¯æŒ

Docker é•œåƒæ”¯æŒå¤šç§æ¶æ„ï¼š
- `linux/amd64` (x86_64)
- `linux/arm64` (ARM64/Apple Silicon)

Docker ä¼šè‡ªåŠ¨é€‰æ‹©é€‚åˆæ‚¨ç³»ç»Ÿçš„æ¶æ„ç‰ˆæœ¬ã€‚

### é•œåƒæ ‡ç­¾è¯´æ˜

- `latest`: æœ€æ–°ç¨³å®šç‰ˆæœ¬
- `vX.Y.Z`: å…·ä½“ç‰ˆæœ¬å·ï¼ˆå¦‚ `v0.1.2`ï¼‰
- `vX.Y`: ä¸»è¦ç‰ˆæœ¬å·ï¼ˆå¦‚ `v0.1`ï¼‰
- `vX`: å¤§ç‰ˆæœ¬å·ï¼ˆå¦‚ `v0`ï¼‰

## ğŸ“ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ GNU Affero General Public License v3.0 è®¸å¯è¯ã€‚è¯¦è§ [LICENSE](LICENSE) æ–‡ä»¶ã€‚

## ğŸ¤ è´¡çŒ®

æ¬¢è¿è´¡çŒ®ï¼è¯·é˜…è¯»æˆ‘ä»¬çš„è´¡çŒ®æŒ‡å—å¹¶æäº¤Pull Requestã€‚

## ğŸ“ æ”¯æŒ

å¦‚æœæ‚¨é‡åˆ°é—®é¢˜æˆ–æœ‰åŠŸèƒ½å»ºè®®ï¼Œè¯·åˆ›å»ºä¸€ä¸ª [Issue](https://github.com/your-username/easyscan-server/issues)ã€‚

## ğŸ™ é¸£è°¢

æ„Ÿè°¢ä»¥ä¸‹å¼€æºé¡¹ç›®å’ŒæŠ€æœ¯ä¸ºEasyScan Serveræä¾›æ”¯æŒï¼š

### æ ¸å¿ƒæŠ€æœ¯
- **[FastAPI](https://fastapi.tiangolo.com/)** - ç°ä»£ã€å¿«é€Ÿçš„Python Webæ¡†æ¶
- **[Uvicorn](https://www.uvicorn.org/)** - é«˜æ€§èƒ½ASGIæœåŠ¡å™¨
- **[Redis](https://redis.io/)** - å†…å­˜æ•°æ®ç»“æ„å­˜å‚¨
- **[Pydantic](https://pydantic-docs.helpmanual.io/)** - æ•°æ®éªŒè¯å’Œè®¾ç½®ç®¡ç†

### å¼€å‘å·¥å…·
- **[Typer](https://typer.tiangolo.com/)** - æ„å»ºCLIåº”ç”¨çš„ç°ä»£åº“
- **[Jinja2](https://jinja.palletsprojects.com/)** - ç°ä»£ä¸”è®¾è®¡å‹å¥½çš„æ¨¡æ¿å¼•æ“
- **[FakeRedis](https://github.com/cunla/fakeredis-py)** - Redisçš„Pythonæ¨¡æ‹Ÿå™¨ï¼Œç”¨äºæµ‹è¯•

### å‰ç«¯æŠ€æœ¯
- **[QRCode.js](https://github.com/davidshimjs/qrcodejs)** - JavaScriptäºŒç»´ç ç”Ÿæˆåº“
- **[Server-Sent Events](https://developer.mozilla.org/en-US/docs/Web/API/Server-sent_events)** - å®æ—¶æ•°æ®æ¨é€æŠ€æœ¯

### éƒ¨ç½²å’Œæ‰“åŒ…
- **[Docker](https://www.docker.com/)** - å®¹å™¨åŒ–å¹³å°
- **[GitHub Container Registry](https://docs.github.com/en/packages/working-with-a-github-packages-registry/working-with-the-container-registry)** - Dockeré•œåƒæ‰˜ç®¡æœåŠ¡
- **[uv](https://github.com/astral-sh/uv)** - ç°ä»£PythonåŒ…ç®¡ç†å™¨
- **[GitHub Actions](https://github.com/features/actions)** - CI/CDè‡ªåŠ¨åŒ–

ç‰¹åˆ«æ„Ÿè°¢æ‰€æœ‰å¼€æºç¤¾åŒºçš„è´¡çŒ®è€…ä»¬ï¼Œæ˜¯ä½ ä»¬è®©è¿™ä¸ªé¡¹ç›®æˆä¸ºå¯èƒ½ï¼ ğŸš€

---

**EasyScan Server** - è®©URLåˆ†äº«å˜å¾—ç®€å•å¿«æ·ï¼ ğŸš€
