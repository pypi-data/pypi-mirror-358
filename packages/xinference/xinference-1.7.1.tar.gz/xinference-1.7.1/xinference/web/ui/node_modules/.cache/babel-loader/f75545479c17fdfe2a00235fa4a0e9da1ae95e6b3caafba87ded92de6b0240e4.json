{"ast":null,"code":"import _toConsumableArray from\"/home/runner/work/inference/inference/xinference/web/ui/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _slicedToArray from\"/home/runner/work/inference/inference/xinference/web/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import FilterNoneIcon from'@mui/icons-material/FilterNone';import{Alert,Snackbar,Tooltip}from'@mui/material';import ClipboardJS from'clipboard';import React,{useEffect,useRef,useState}from'react';import{useTranslation}from'react-i18next';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function CopyComponent(_ref){var modelData=_ref.modelData,predefinedKeys=_ref.predefinedKeys;var _useTranslation=useTranslation(),t=_useTranslation.t;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isCopySuccess=_useState2[0],setIsCopySuccess=_useState2[1];var copyRef=useRef(null);var generateCommandLineStatement=function generateCommandLineStatement(params){var args=Object.entries(params).filter(function(_ref2){var _ref3=_slicedToArray(_ref2,2),key=_ref3[0],value=_ref3[1];return predefinedKeys.includes(key)&&value!==null&&value!==undefined||!predefinedKeys.includes(key);}).map(function(_ref4){var _ref5=_slicedToArray(_ref4,2),key=_ref5[0],value=_ref5[1];if(key==='gpu_idx'&&Array.isArray(value)){return\"--gpu-idx \".concat(value.join(','));}else if(key==='peft_model_config'&&typeof value==='object'){var peftArgs=[];if(value.lora_list){peftArgs.push.apply(peftArgs,_toConsumableArray(value.lora_list.map(function(lora){return\"--lora-modules \".concat(lora.lora_name,\" \").concat(lora.local_path);})));}if(value.image_lora_load_kwargs){peftArgs.push.apply(peftArgs,_toConsumableArray(Object.entries(value.image_lora_load_kwargs).map(function(_ref6){var _ref7=_slicedToArray(_ref6,2),k=_ref7[0],v=_ref7[1];return\"--image-lora-load-kwargs \".concat(k,\" \").concat(v);})));}if(value.image_lora_fuse_kwargs){peftArgs.push.apply(peftArgs,_toConsumableArray(Object.entries(value.image_lora_fuse_kwargs).map(function(_ref8){var _ref9=_slicedToArray(_ref8,2),k=_ref9[0],v=_ref9[1];return\"--image-lora-fuse-kwargs \".concat(k,\" \").concat(v);})));}return peftArgs.join(' ');}else if(key==='quantization_config'&&typeof value==='object'){var _peftArgs=[];_peftArgs.push.apply(_peftArgs,_toConsumableArray(Object.entries(value).map(function(_ref10){var _ref11=_slicedToArray(_ref10,2),k=_ref11[0],v=_ref11[1];return\"--quantization-config \".concat(k,\" \").concat(v===null?'none':v);})));return _peftArgs.join(' ');}else if(predefinedKeys.includes(key)){var newKey;if(key==='model_size_in_billions'){newKey='--size-in-billions';}else if(key==='download_hub'){newKey=\"--download_hub\";}else{newKey=\"--\".concat(key.replace(/_/g,'-'));}return\"\".concat(newKey,\" \").concat(value===false?'false':value===null?'none':value);}else{return\"--\".concat(key,\" \").concat(value===false?'false':value===null?'none':value);}}).join(' ');return\"xinference launch \".concat(args);};useEffect(function(){var _text=generateCommandLineStatement(modelData);var clipboard=new ClipboardJS(copyRef.current,{text:function text(){return _text;}});clipboard.on('success',function(e){e.clearSelection();setIsCopySuccess(true);});var handleClick=function handleClick(event){event.stopPropagation();copyRef.current.focus();};var copy=copyRef.current;copy.addEventListener('click',handleClick);return function(){clipboard.destroy();copy.removeEventListener('click',handleClick);};},[modelData]);return/*#__PURE__*/_jsxs(\"div\",{style:{marginInline:'10px',lineHeight:'14px'},children:[/*#__PURE__*/_jsx(Tooltip,{title:t('launchModel.copyToCommandLine'),placement:\"top\",children:/*#__PURE__*/_jsx(\"div\",{ref:copyRef,children:/*#__PURE__*/_jsx(FilterNoneIcon,{className:\"copyToCommandLine\"})})}),/*#__PURE__*/_jsx(Snackbar,{anchorOrigin:{vertical:'top',horizontal:'center'},open:isCopySuccess,autoHideDuration:1500,onClose:function onClose(){return setIsCopySuccess(false);},children:/*#__PURE__*/_jsx(Alert,{severity:\"success\",variant:\"filled\",sx:{width:'100%'},children:t('components.copySuccess')})})]});}export default CopyComponent;","map":{"version":3,"names":["FilterNoneIcon","Alert","Snackbar","Tooltip","ClipboardJS","React","useEffect","useRef","useState","useTranslation","jsx","_jsx","jsxs","_jsxs","CopyComponent","_ref","modelData","predefinedKeys","_useTranslation","t","_useState","_useState2","_slicedToArray","isCopySuccess","setIsCopySuccess","copyRef","generateCommandLineStatement","params","args","Object","entries","filter","_ref2","_ref3","key","value","includes","undefined","map","_ref4","_ref5","Array","isArray","concat","join","peftArgs","lora_list","push","apply","_toConsumableArray","lora","lora_name","local_path","image_lora_load_kwargs","_ref6","_ref7","k","v","image_lora_fuse_kwargs","_ref8","_ref9","_ref10","_ref11","newKey","replace","text","clipboard","current","on","e","clearSelection","handleClick","event","stopPropagation","focus","copy","addEventListener","destroy","removeEventListener","style","marginInline","lineHeight","children","title","placement","ref","className","anchorOrigin","vertical","horizontal","open","autoHideDuration","onClose","severity","variant","sx","width"],"sources":["/home/runner/work/inference/inference/xinference/web/ui/src/scenes/launch_model/components/copyComponent.js"],"sourcesContent":["import FilterNoneIcon from '@mui/icons-material/FilterNone'\nimport { Alert, Snackbar, Tooltip } from '@mui/material'\nimport ClipboardJS from 'clipboard'\nimport React, { useEffect, useRef, useState } from 'react'\nimport { useTranslation } from 'react-i18next'\n\nfunction CopyComponent({ modelData, predefinedKeys }) {\n  const { t } = useTranslation()\n  const [isCopySuccess, setIsCopySuccess] = useState(false)\n  const copyRef = useRef(null)\n\n  const generateCommandLineStatement = (params) => {\n    const args = Object.entries(params)\n      .filter(\n        ([key, value]) =>\n          (predefinedKeys.includes(key) &&\n            value !== null &&\n            value !== undefined) ||\n          !predefinedKeys.includes(key)\n      )\n      .map(([key, value]) => {\n        if (key === 'gpu_idx' && Array.isArray(value)) {\n          return `--gpu-idx ${value.join(',')}`\n        } else if (key === 'peft_model_config' && typeof value === 'object') {\n          let peftArgs = []\n          if (value.lora_list) {\n            peftArgs.push(\n              ...value.lora_list.map(\n                (lora) => `--lora-modules ${lora.lora_name} ${lora.local_path}`\n              )\n            )\n          }\n          if (value.image_lora_load_kwargs) {\n            peftArgs.push(\n              ...Object.entries(value.image_lora_load_kwargs).map(\n                ([k, v]) => `--image-lora-load-kwargs ${k} ${v}`\n              )\n            )\n          }\n          if (value.image_lora_fuse_kwargs) {\n            peftArgs.push(\n              ...Object.entries(value.image_lora_fuse_kwargs).map(\n                ([k, v]) => `--image-lora-fuse-kwargs ${k} ${v}`\n              )\n            )\n          }\n          return peftArgs.join(' ')\n        } else if (key === 'quantization_config' && typeof value === 'object') {\n          let peftArgs = []\n          peftArgs.push(\n            ...Object.entries(value).map(\n              ([k, v]) =>\n                `--quantization-config ${k} ${v === null ? 'none' : v}`\n            )\n          )\n          return peftArgs.join(' ')\n        } else if (predefinedKeys.includes(key)) {\n          let newKey\n          if (key === 'model_size_in_billions') {\n            newKey = '--size-in-billions'\n          } else if (key === 'download_hub') {\n            newKey = `--download_hub`\n          } else {\n            newKey = `--${key.replace(/_/g, '-')}`\n          }\n          return `${newKey} ${\n            value === false ? 'false' : value === null ? 'none' : value\n          }`\n        } else {\n          return `--${key} ${\n            value === false ? 'false' : value === null ? 'none' : value\n          }`\n        }\n      })\n      .join(' ')\n\n    return `xinference launch ${args}`\n  }\n\n  useEffect(() => {\n    const text = generateCommandLineStatement(modelData)\n    const clipboard = new ClipboardJS(copyRef.current, {\n      text: () => text,\n    })\n\n    clipboard.on('success', (e) => {\n      e.clearSelection()\n      setIsCopySuccess(true)\n    })\n\n    const handleClick = (event) => {\n      event.stopPropagation()\n      copyRef.current.focus()\n    }\n\n    const copy = copyRef.current\n    copy.addEventListener('click', handleClick)\n\n    return () => {\n      clipboard.destroy()\n      copy.removeEventListener('click', handleClick)\n    }\n  }, [modelData])\n\n  return (\n    <div style={{ marginInline: '10px', lineHeight: '14px' }}>\n      <Tooltip title={t('launchModel.copyToCommandLine')} placement=\"top\">\n        <div ref={copyRef}>\n          <FilterNoneIcon className=\"copyToCommandLine\" />\n        </div>\n      </Tooltip>\n      <Snackbar\n        anchorOrigin={{ vertical: 'top', horizontal: 'center' }}\n        open={isCopySuccess}\n        autoHideDuration={1500}\n        onClose={() => setIsCopySuccess(false)}\n      >\n        <Alert severity=\"success\" variant=\"filled\" sx={{ width: '100%' }}>\n          {t('components.copySuccess')}\n        </Alert>\n      </Snackbar>\n    </div>\n  )\n}\n\nexport default CopyComponent\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}