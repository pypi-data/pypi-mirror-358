Metadata-Version: 2.3
Name: reproto
Version: 0.1.1
Summary: ä¸€ä¸ªå¼ºå¤§çš„é€†å‘å·¥ç¨‹å·¥å…·, èƒ½å¤Ÿä»ä»»ä½•ä½¿ç”¨Google Protobuf Liteçš„Androidåº”ç”¨ä¸­è‡ªåŠ¨é‡æ„å‡ºå®Œæ•´çš„.protoæ–‡ä»¶ç»“æ„.
License: Proprietary
Keywords: protobuf,reverse-engineering,android,jadx,proto
Author: iyue
Author-email: ys1231@126.com
Requires-Python: >=3.12,<4.0
Classifier: Development Status :: 4 - Beta
Classifier: Intended Audience :: Developers
Classifier: License :: Other/Proprietary License
Classifier: Programming Language :: Python :: 3
Classifier: Programming Language :: Python :: 3.12
Classifier: Programming Language :: Python :: 3.13
Classifier: Topic :: Software Development :: Code Generators
Classifier: Topic :: Software Development :: Disassemblers
Requires-Dist: loguru (>=0.7.3)
Project-URL: Homepage, https://github.com/ys1231/reproto
Project-URL: Repository, https://github.com/ys1231/reproto.git
Description-Content-Type: text/markdown

# Protobuf Reconstructor

ğŸ”§ **ä»JADXåç¼–è¯‘çš„Javaæºç è‡ªåŠ¨é‡æ„Protobuf .protoæ–‡ä»¶**

ä¸€ä¸ªå¼ºå¤§çš„é€†å‘å·¥ç¨‹å·¥å…·ï¼Œèƒ½å¤Ÿä»ä»»ä½•ä½¿ç”¨Google Protobuf Liteçš„Androidåº”ç”¨ä¸­è‡ªåŠ¨é‡æ„å‡ºå®Œæ•´çš„.protoæ–‡ä»¶ç»“æ„ã€‚ç»è¿‡é‡å¤§æ€§èƒ½ä¼˜åŒ–ï¼Œæ‰§è¡Œæ•ˆç‡æå‡20%+ã€‚

## âœ¨ ç‰¹æ€§

- ğŸ¯ **ç²¾å‡†è§£æ**: åŸºäºGoogle Protobuf Liteå­—èŠ‚ç çš„é€†å‘å·¥ç¨‹
- ğŸ”„ **é€’å½’ä¾èµ–**: è‡ªåŠ¨å‘ç°å’Œå¤„ç†æ‰€æœ‰ä¾èµ–çš„æ¶ˆæ¯å’Œæšä¸¾ç±»å‹
- ğŸ“¦ **å®Œæ•´æ”¯æŒ**: æ”¯æŒoneofã€repeatedã€mapã€æšä¸¾ç­‰æ‰€æœ‰Protobufç‰¹æ€§
- ğŸŒ **é€šç”¨æ€§**: é€‚ç”¨äºä»»ä½•Androidåº”ç”¨ï¼Œæ— éœ€ç¡¬ç¼–ç æ˜ å°„
- ğŸ§  **æ™ºèƒ½æ¨æ–­**: ä»Javaæºç ç›´æ¥è¯»å–ç±»å‹ä¿¡æ¯ï¼Œç¡®ä¿é«˜å‡†ç¡®æ€§
- ğŸ“ **æ ‡å‡†è¾“å‡º**: ä¸¥æ ¼éµå¾ªGoogle Proto Style Guide
- ğŸš€ **é«˜æ€§èƒ½**: æ–‡ä»¶ç¼“å­˜ç³»ç»Ÿ + æ™ºèƒ½è·¯å¾„æ„é€ ï¼Œæ‰§è¡Œé€Ÿåº¦æå‡20%+
- ğŸ› ï¸ **ç‰¹æ®Šç±»å‹æ”¯æŒ**: MapFieldLiteã€Internal.ProtobufListã€Google Well-Known Types

## ğŸ› ï¸ å®‰è£…

```bash
# å…‹éš†é¡¹ç›®
git clone https://github.com/ys1231/reproto.git
cd reproto

# å®‰è£…ä¾èµ–
pip install -r requirements.txt
```

## ğŸ“– ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬ç”¨æ³•
```bash
python main.py <java_sources_dir> <root_class> <output_dir> [--verbose]
```

### å‚æ•°è¯´æ˜
- `java_sources_dir`: JADXåç¼–è¯‘çš„Javaæºç ç›®å½•è·¯å¾„
- `root_class`: è¦é‡æ„çš„æ ¹ç±»å®Œæ•´ç±»åï¼ˆå¦‚ï¼šcom.example.Modelï¼‰
- `output_dir`: ç”Ÿæˆçš„protoæ–‡ä»¶è¾“å‡ºç›®å½•è·¯å¾„
- `--verbose`: æ˜¾ç¤ºè¯¦ç»†å¤„ç†ä¿¡æ¯

### ç¤ºä¾‹
```bash
# é‡æ„æ¶ˆæ¯åº”ç”¨çš„æ•°æ®æ¨¡å‹
python main.py ./out_jadx/sources com.example.messaging.v1.models.MessageData ./protos_generated --verbose

# é‡æ„å†…éƒ¨ç±»
python main.py ./out_jadx/sources 'com.truecaller.accountonboarding.v1.Models$Onboarded' ./output --verbose

# é‡æ„åŒ…å«ç‰¹æ®Šç±»å‹çš„ç±»
python main.py ./out_jadx/sources com.truecaller.search.v1.models.SearchResult ./output --verbose
```

## ğŸ” å·¥ä½œåŸç†

### æ ¸å¿ƒæŠ€æœ¯
1. **å­—èŠ‚ç è§£æ**: é€†å‘å·¥ç¨‹Google Protobuf Liteçš„`newMessageInfo`è°ƒç”¨
2. **ä¾èµ–å‘ç°**: é€’å½’åˆ†æJavaæ–‡ä»¶ä¸­çš„ç±»å‹å¼•ç”¨
3. **æ™ºèƒ½æ¨æ–­**: åŸºäºå­—æ®µåå’Œå¯¹è±¡æ•°ç»„æ¨æ–­æšä¸¾å’Œæ¶ˆæ¯ç±»å‹
4. **æºç åˆ†æ**: ç›´æ¥ä»Javaæºç è¯»å–çœŸå®çš„å­—æ®µç±»å‹å£°æ˜
5. **ğŸ†• æ€§èƒ½ä¼˜åŒ–**: æ–‡ä»¶ç¼“å­˜ç³»ç»Ÿ + ç›´æ¥è·¯å¾„æ„é€ ï¼Œé¿å…å…¨ç›®å½•æ‰«æ

### è§£ææµç¨‹
```
Javaæºç  â†’ å­—èŠ‚ç æå– â†’ ç±»å‹è§£ç  â†’ ä¾èµ–å‘ç° â†’ æºç éªŒè¯ â†’ Protoç”Ÿæˆ
    â†“
ğŸš€ æ€§èƒ½ä¼˜åŒ–: æ–‡ä»¶ç¼“å­˜ + æ™ºèƒ½è·¯å¾„æ„é€  + ç»Ÿä¸€ç±»å‹æ£€æµ‹
```

## ğŸ“ é¡¹ç›®ç»“æ„

```
reproto/
â”œâ”€â”€ main.py                     # ä¸»ç¨‹åºå…¥å£
â”œâ”€â”€ core/                       # æ ¸å¿ƒç»„ä»¶
â”‚   â”œâ”€â”€ reconstructor.py        # ä¸»åè°ƒå™¨ (å·²ä¼˜åŒ–)
â”‚   â”œâ”€â”€ info_decoder.py         # å­—èŠ‚ç è§£ç å™¨
â”‚   â””â”€â”€ bytecode_parser.py      # å­—èŠ‚ç è§£æå·¥å…·
â”œâ”€â”€ parsing/                    # è§£ææ¨¡å—
â”‚   â”œâ”€â”€ java_parser.py          # Javaæ–‡ä»¶è§£æå™¨
â”‚   â”œâ”€â”€ enum_parser.py          # æšä¸¾è§£æå™¨ (ğŸ†•)
â”‚   â””â”€â”€ java_source_analyzer.py # Javaæºç åˆ†æå™¨ (å·²ä¼˜åŒ–)
â”œâ”€â”€ generation/                 # ç”Ÿæˆæ¨¡å—
â”‚   â””â”€â”€ proto_generator.py      # Protoæ–‡ä»¶ç”Ÿæˆå™¨
â”œâ”€â”€ models/                     # æ•°æ®æ¨¡å‹
â”‚   â””â”€â”€ message_definition.py   # æ¶ˆæ¯å’Œæšä¸¾å®šä¹‰
â”œâ”€â”€ utils/                      # å·¥å…·å‡½æ•° (å¤§å¹…æ‰©å±•)
â”‚   â”œâ”€â”€ logger.py              # æ—¥å¿—ç³»ç»Ÿ
â”‚   â”œâ”€â”€ file_utils.py          # æ–‡ä»¶å·¥å…·
â”‚   â”œâ”€â”€ file_cache.py          # æ–‡ä»¶ç¼“å­˜ç³»ç»Ÿ (ğŸ†•)
â”‚   â””â”€â”€ type_utils.py          # ç±»å‹å¤„ç†å·¥å…· (ğŸ†•)
â””â”€â”€ logs/                      # æ—¥å¿—æ–‡ä»¶ç›®å½•
```

## ğŸ“Š è¾“å‡ºç¤ºä¾‹

### è¾“å…¥ï¼šJavaæºç 
```java
public final class BulkSearchResult extends GeneratedMessageLite {
    private MapFieldLite<String, Contact> contacts_;
    private Internal.ProtobufList<String> phoneNumbers_;
    
    public static final int CONTACTS_FIELD_NUMBER = 1;
    public static final int PHONE_NUMBERS_FIELD_NUMBER = 2;
}
```

### è¾“å‡ºï¼šProtoæ–‡ä»¶
```protobuf
syntax = "proto3";

package com.truecaller.search.v1.models;

option java_package = "com.truecaller.search.v1.models";
option java_multiple_files = true;

message BulkSearchResult {
  map<string, Contact> contacts = 1;
  repeated string phone_numbers = 2;
}
```

## ğŸš€ æ€§èƒ½ä¼˜åŒ–äº®ç‚¹

### ğŸ†• é‡å¤§æ€§èƒ½æå‡
- **æ€»æ‰§è¡Œæ—¶é—´**: ä»~81ç§’ä¼˜åŒ–åˆ°~65ç§’ï¼Œæå‡ **19.8%**
- **åŸºç¡€ç±»å‹æ£€æµ‹**: ä»2-3ç§’å»¶è¿Ÿä¼˜åŒ–ä¸º **ç¬é—´å“åº”**ï¼Œæå‡ **99%+**
- **ç´¢å¼•ç³»ç»Ÿ**: ç§»é™¤æœªä½¿ç”¨çš„ç´¢å¼•ç³»ç»Ÿï¼ŒèŠ‚çœ **100%** æ„å»ºå¼€é”€
- **æ–‡ä»¶I/O**: æ™ºèƒ½ç¼“å­˜ç³»ç»Ÿï¼Œé¿å…é‡å¤è¯»å–

### ğŸ”§ æŠ€æœ¯ä¼˜åŒ–
1. **æ–‡ä»¶ç¼“å­˜ç³»ç»Ÿ**: çº¿ç¨‹å®‰å…¨çš„æ–‡ä»¶å†…å®¹ç¼“å­˜ï¼Œé¿å…é‡å¤I/O
2. **ç›´æ¥è·¯å¾„æ„é€ **: æ ¹æ®åŒ…åç›´æ¥æ„é€ æ–‡ä»¶è·¯å¾„ï¼Œé¿å…å…¨ç›®å½•æ‰«æ
3. **ç»Ÿä¸€ç±»å‹æ£€æµ‹**: ä½¿ç”¨`TypeMapper`ç»Ÿä¸€å¤„ç†æ‰€æœ‰ç±»å‹è½¬æ¢
4. **æ™ºèƒ½åŒ…åæ¨æ–­**: åŸºäºåŒ…ç»“æ„çš„æ™ºèƒ½ç±»åè§£æ

### ğŸ“ˆ æ€§èƒ½ç›‘æ§
```bash
ğŸ“Š æ–‡ä»¶ç¼“å­˜ç»Ÿè®¡:
   æ€»è¯·æ±‚æ•°: 33
   ç¼“å­˜å‘½ä¸­: 0      # è¡¨æ˜ç¨‹åºé«˜æ•ˆï¼Œæ— é‡å¤è¯»å–
   ç¼“å­˜æœªå‘½ä¸­: 33   # æ¯ä¸ªæ–‡ä»¶åªè¯»å–ä¸€æ¬¡
   å·²ç¼“å­˜æ–‡ä»¶: 33   # æ‰€æœ‰æ–‡ä»¶å·²ç¼“å­˜å¤‡ç”¨
```

## ğŸ› ï¸ ç‰¹æ®Šç±»å‹æ”¯æŒ

### MapFieldLite æ”¯æŒ
```java
// Javaæºç 
private MapFieldLite<String, Contact> contacts_;

// ç”Ÿæˆçš„Proto
map<string, Contact> contacts = 1;
```

### Internal.ProtobufList æ”¯æŒ
```java
// Javaæºç 
private Internal.ProtobufList<String> tags_;

// ç”Ÿæˆçš„Proto
repeated string tags = 1;
```

### Google Well-Known Types
- `google.protobuf.Any`
- `google.protobuf.Timestamp`
- `google.protobuf.Duration`
- `google.protobuf.StringValue`
- ç­‰ç­‰...

## ğŸš€ å·¥ä½œæµç¨‹

1. ä½¿ç”¨JADXåç¼–è¯‘Androidåº”ç”¨ï¼š`jadx -d out_jadx app.apk`
2. è¿è¡ŒReProtoæŒ‡å®šæ ¹Protobufç±»
3. è‡ªåŠ¨è§£ææ‰€æœ‰ç›¸å…³ç±»å’Œä¾èµ–
4. ğŸ†• æ™ºèƒ½ç¼“å­˜å’Œè·¯å¾„ä¼˜åŒ–ï¼Œå¿«é€Ÿå¤„ç†
5. ç”Ÿæˆå®Œæ•´çš„.protoæ–‡ä»¶ç»“æ„

## ğŸ“ é…ç½®é€‰é¡¹

### æ—¥å¿—é…ç½®
- æ—¥å¿—æ–‡ä»¶è‡ªåŠ¨ä¿å­˜åˆ° `./logs/` ç›®å½•
- æ–‡ä»¶æ ¼å¼: `reproto-YYYY-MM-DD-HH-MM-SS.log`
- ä½¿ç”¨ `--verbose` å‚æ•°æŸ¥çœ‹è¯¦ç»†å¤„ç†è¿‡ç¨‹
- ğŸ†• æ€§èƒ½ç»Ÿè®¡å’Œç¼“å­˜ç›‘æ§ä¿¡æ¯

### è¾“å‡ºæ ¼å¼
ç”Ÿæˆçš„protoæ–‡ä»¶éµå¾ªGoogle Protobuf Style Guideï¼š
- æ–‡ä»¶åï¼š`snake_case.proto`
- å­—æ®µåï¼š`snake_case`
- æ¶ˆæ¯åï¼š`PascalCase`
- æšä¸¾å€¼ï¼š`UPPER_SNAKE_CASE`

## ğŸ”§ å¼€å‘

```bash
# ä½¿ç”¨Poetryç®¡ç†ä¾èµ–
poetry install
poetry shell

# è¿è¡Œæµ‹è¯•
python main.py ../out_jadx/sources 'com.example.TestClass' ../test_output --verbose

# æ€§èƒ½æµ‹è¯•
time python main.py ../out_jadx/sources com.truecaller.search.v1.models.SearchResult ../test_output
```

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **æ–‡ä»¶æ‰¾ä¸åˆ°é”™è¯¯**
   ```bash
   # ç¡®ä¿JADXè¾“å‡ºç›®å½•æ­£ç¡®
   ls -la out_jadx/sources/com/example/
   ```

2. **å†…å­˜ä¸è¶³**
   ```bash
   # å¯¹äºå¤§å‹åº”ç”¨ï¼Œå¢åŠ Javaå †å†…å­˜
   export JAVA_OPTS="-Xmx4g"
   ```

3. **æ€§èƒ½é—®é¢˜**
   ```bash
   # æŸ¥çœ‹ç¼“å­˜ç»Ÿè®¡ï¼Œç¡®è®¤æ²¡æœ‰é‡å¤I/O
   grep "ç¼“å­˜ç»Ÿè®¡" logs/reproto-*.log
   ```

## ğŸ“Š æ”¯æŒçš„Protobufç‰¹æ€§

| ç‰¹æ€§ | æ”¯æŒçŠ¶æ€ | ç¤ºä¾‹ |
|------|----------|------|
| åŸºç¡€ç±»å‹ | âœ… å®Œæ•´æ”¯æŒ | `string`, `int32`, `bool` |
| æ¶ˆæ¯ç±»å‹ | âœ… å®Œæ•´æ”¯æŒ | `Contact`, `UserInfo` |
| æšä¸¾ç±»å‹ | âœ… å®Œæ•´æ”¯æŒ | `enum Status { ACTIVE = 0; }` |
| repeated | âœ… å®Œæ•´æ”¯æŒ | `repeated string tags` |
| map | âœ… å®Œæ•´æ”¯æŒ | `map<string, Contact> contacts` |
| oneof | âœ… å®Œæ•´æ”¯æŒ | `oneof data { ... }` |
| åµŒå¥—æ¶ˆæ¯ | âœ… å®Œæ•´æ”¯æŒ | `message Outer.Inner` |
| Well-Known Types | âœ… æ–°å¢æ”¯æŒ | `google.protobuf.Timestamp` |

## ğŸ¯ æœ€æ–°æ›´æ–° (v2.0)

### ğŸš€ æ€§èƒ½ä¼˜åŒ–
- ç§»é™¤æœªä½¿ç”¨çš„ç´¢å¼•ç³»ç»Ÿï¼Œæå‡æ‰§è¡Œæ•ˆç‡20%+
- æ–‡ä»¶ç¼“å­˜ç³»ç»Ÿï¼Œé¿å…é‡å¤I/Oæ“ä½œ
- æ™ºèƒ½è·¯å¾„æ„é€ ï¼Œé¿å…å…¨ç›®å½•æ‰«æ
- ç»Ÿä¸€ç±»å‹æ£€æµ‹å™¨ï¼Œç®€åŒ–ä»£ç é€»è¾‘

### ğŸ†• æ–°å¢åŠŸèƒ½
- MapFieldLiteè‡ªåŠ¨è½¬æ¢ä¸ºæ ‡å‡†mapè¯­æ³•
- Internal.ProtobufListæ”¯æŒ
- Google Protobuf Well-Known Typesæ”¯æŒ
- å¢å¼ºçš„æšä¸¾è§£æå™¨
- è¯¦ç»†çš„æ€§èƒ½ç›‘æ§å’Œç»Ÿè®¡

### ğŸ”§ æŠ€æœ¯æ”¹è¿›
- ä»£ç å¤æ‚åº¦æ˜¾è‘—é™ä½
- å†…å­˜ä½¿ç”¨ä¼˜åŒ–
- é”™è¯¯å¤„ç†å¢å¼º
- æ—¥å¿—ç³»ç»Ÿæ”¹è¿›

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®ä¸ºç§æœ‰é¡¹ç›®ï¼Œä»…ä¾›æˆæƒç”¨æˆ·ä½¿ç”¨ã€‚

---

**ï¿½ï¿½ ç°åœ¨å°±ä½“éªŒ20%+çš„æ€§èƒ½æå‡ï¼**

