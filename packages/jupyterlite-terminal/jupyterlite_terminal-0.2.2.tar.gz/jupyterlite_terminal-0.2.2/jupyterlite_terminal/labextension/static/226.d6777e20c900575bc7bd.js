"use strict";(self.webpackChunk_jupyterlite_terminal=self.webpackChunk_jupyterlite_terminal||[]).push([[226],{312:(t,e,s)=>{s.d(e,{X:()=>r});class r{isTerminal(){return!1}async readAsync(t){return[]}read(t){return[]}}},763:(t,e,s)=>{var r;s.d(e,{X:()=>r}),function(t){t.MAIN=0,t.WORKER=1,t.LENGTH=2,t.START=3,t.maxChars=64}(r||(r={}))},952:(t,e,s)=>{s.d(e,{J:()=>n});var r=s(1315);class n extends r.S{pipe;constructor(t){super(),this.pipe=t}readAll(){const t=this.pipe.allContent;return this.pipe.clear(),t}}},1203:(t,e,s)=>{s.d(e,{_:()=>r});class r{input;constructor(t){this.input=t}isTerminal(){return this.input.isTerminal()}async readAsync(t){const e=await this.input.readAsync(t);return String.fromCharCode(...e)}}},1315:(t,e,s)=>{s.d(e,{S:()=>r});class r{isTerminal(){return!1}async readAsync(t){return this.read(t)}read(t){if(void 0===this._buffer&&(this._buffer=this.readAll(),this._index=0),this._index<this._buffer.length){const t=this._buffer[this._index++],e=[];for(let s=0;s<t.length;s++)e.push(t.charCodeAt(s));return e}return[]}_buffer;_index=0}},2251:(t,e,s)=>{s.d(e,{y:()=>r});class r{flush(){}supportsAnsiEscapes(){return!1}write(t){}}},2958:(t,e,s)=>{s.d(e,{z:()=>n});var r=s(1315);class n extends r.S{fileSystem;path;constructor(t,e){super(),this.fileSystem=t,this.path=e}readAll(){const{FS:t}=this.fileSystem;return t.readFile(this.path,{encoding:"utf8"})}}},3226:(t,e,s)=>{s.d(e,{g:()=>nt});var r={};s.r(r),s.d(r,{AliasCommand:()=>j,BuiltinCommand:()=>T,CdCommand:()=>q,ClearCommand:()=>X,CockleConfigCommand:()=>J,ExitCommand:()=>Z,ExportCommand:()=>V,HistoryCommand:()=>et});var n=s(8301),i=s(7262),o=s(4133);class a{outputCallback;constructor(t){this.outputCallback=t}async canEnable(){await(this._available?.promise)}async disable(){this._enabled=!1,this._clear(),this._available?.resolve()}async enable(){this._enabled=!0,this._available=new i.PromiseDelegate}get enabled(){return this._enabled}setTermios(t){this.termios.set(t),this._writeColumn=0}get termios(){return this._termios}utf8ArrayToString(t){return void 0===this._utf8Decoder&&(this._utf8Decoder=new TextDecoder("utf8")),this._utf8Decoder.decode(t)}write(t){let e=[];e="string"==typeof t?this._processWriteChars(t.split("").map((t=>t.charCodeAt(0)))):this._processWriteChars(t),this.outputCallback(String.fromCharCode(...e))}_maybeEchoToOutput(t){const e=(this.termios.c_lflag&o.Uq.ECHO)>0,s=(this.termios.c_lflag&o.Uq.ECHONL)>0;if(!e&&!s)return;const r=[];for(const s of t)switch(s){case 10:r.push(10);break;case 4:break;default:e&&r.push(s)}r.length>0&&this.write(r)}_processReadChars(t){const e=[];for(const s of t)switch(s){case 13:0===(this.termios.c_iflag&o.tc.IGNCR)&&((this.termios.c_iflag&o.tc.ICRNL)>0?e.push(10):e.push(13));break;case 10:(this.termios.c_iflag&o.tc.INLCR)>0?e.push(13):e.push(10);break;default:e.push(s)}return e}_processWriteChars(t){const{c_oflag:e}=this.termios;let s=!1,r=0;const n=[];for(let i=0;i<t.length;i++){const a=t[i];switch(s||27!==a||(s=!0,r=i),a){case 10:if(0===this._writeColumn&&(e&o.OJ.ONOCR)>0)break;this._writeColumn=0,(e&o.OJ.ONLCR)>0?n.push(13,10):n.push(10);break;default:!s&&a>=32&&this._writeColumn++,n.push(a)}s&&i>r+2&&(a>=65&&a<=90||a>=97&&a<=122)&&(s=!1)}return n}_readFromBuffer(t){if(null===t){const t=this._readBuffer;return this._readBuffer=[],t}{const e=this._readBuffer.slice(0,t);return this._readBuffer.splice(0,e.length),e}}_available;_enabled=!1;_termios=new o.Gc;_writeColumn=0;_utf8Decoder;_readBuffer=[]}class l extends a{constructor(t,e,s,r){super(t),this._utils=new n.F(e,s,r)}poll(t){if(!this._enabled)throw new Error("ServiceWorkerWorkerIO.poll when disabled");let e=this._readBuffer.length>0;if(!e&&t>0){const s=this._utils.getStdin(t);this._postRead(s),e=!0}return 4|(e?1:0)}read(t){if(!this._enabled)throw new Error("ServiceWorkerWorkerIO.read when disabled");if(null!==t&&t<=0)return[];if(this._readBuffer.length>0)return this._readFromBuffer(t);const e=this._utils.getStdin(0);return this._postRead(e),this._readFromBuffer(t)}async readAsync(t,e){if(!this._enabled)throw new Error("ServiceWorkerWorkerIO.readAsync when disabled");if(null!==t&&t<=0)return[];if(this._readBuffer.length>0)return this._readFromBuffer(t);const s=await this._utils.getStdinAsync(e);return this._postRead(s),this._readFromBuffer(t)}_clear(){}_postRead(t){const e=t.split("").map((t=>t.charCodeAt(0))),s=this._processReadChars(e);this._readBuffer.push(...s),this._maybeEchoToOutput(s)}_utils}var h=s(763);class c extends a{constructor(t,e){super(e);const s=h.X.maxChars+3;this._sharedArrayBuffer=t,this._intArray=new Int32Array(this._sharedArrayBuffer,0,s)}poll(t){if(!this._enabled)throw new Error("SharedArrayBufferWorkerIO.poll when disabled");return this._readBuffer.length>0?5:(t<0&&(t=1/0),4|("not-equal"===Atomics.wait(this._intArray,h.X.MAIN,this._readCount,t)?1:0))}read(t){if(!this._enabled)throw new Error("SharedArrayBufferWorkerIO.read when disabled");return null!==t&&t<=0?[]:this._readBuffer.length>0?this._readFromBuffer(t):(Atomics.wait(this._intArray,h.X.MAIN,this._readCount),this._postRead(t))}async readAsync(t,e){if(!this._enabled)throw new Error("SharedArrayBufferWorkerIO.readAsync when disabled");if(null!==t&&t<=0)return[];if(this._readBuffer.length>0)return this._readFromBuffer(t);const{async:s,value:r}=Atomics.waitAsync(this._intArray,h.X.MAIN,this._readCount,e>0?e:1/0);return s&&await r,this._postRead(t)}_postRead(t){if(Atomics.load(this._intArray,h.X.MAIN)===this._readCount)return[];const e=this._loadFromSharedArrayBuffer();return this._readCount++,Atomics.store(this._intArray,h.X.WORKER,this._readCount),Atomics.notify(this._intArray,h.X.WORKER,1),this._readBuffer=this._processReadChars(e),this._maybeEchoToOutput(this._readBuffer),this._readFromBuffer(t)}_clear(){this._intArray[h.X.MAIN]=0,this._intArray[h.X.WORKER]=0,this._readCount=0}_loadFromSharedArrayBuffer(){const t=Atomics.load(this._intArray,h.X.LENGTH),e=[];for(let s=0;s<t;s++)e.push(Atomics.load(this._intArray,h.X.START+s));return e}_sharedArrayBuffer;_intArray;_readCount=0}class u{setMainIO;setWorkerIO;constructor(t,e){this.setMainIO=t,this.setWorkerIO=e,this._map.set("sab",{longName:"shared array buffer",available:!1}),this._map.set("sw",{longName:"service worker",available:!1})}available(t){return this._getByShortName(t).available}get enabled(){return this._enabled}get shortNames(){return Array(...this._map.keys())}longName(t){return this._getByShortName(t).longName}setAvailable(t,e){this._getByShortName(t).available=e}setEnabled(t){if(this._map.has(t))return void this._enable(t);const e=Object.entries(this._map).find((([e,s])=>s.longName===t));if(void 0===e)throw new Error(`Unknown StdinContext name '${t}'`);this._enable(e[0])}_enable(t){if(t!==this._enabled){if(!this._getByShortName(t).available)throw new Error(`StdinContext '${t}' is not available`);this._enabled=t,this._initialised?(this.setWorkerIO(t),this.setMainIO(t)):this._initialised=!0}}_getByShortName(t){const e=this._map.get(t);if(void 0===e)throw new Error(`Unknown shortName '${t}' passed to StdinContext`);return e}_map=new Map;_enabled="";_initialised=!1}var d=s(7450),m=s(9399);class _ extends Map{constructor(t){super(),t?(this.set("PS1",m.Q.styleGreen+"js-shell:"+m.Q.styleReset+" "),this.set("TERM","xterm-256color"),this.set("TERMINFO","/usr/local/share/terminfo")):this.set("PS1","js-shell: ")}copyFromCommand(t){for(const e of t){const t=e.split("="),s=t.shift();s&&!this._ignore.has(s)&&this.set(s,t.join("="))}}copyIntoCommand(t,e){for(const[s,r]of this.entries())(e||"TERM"!==s)&&(t[s]=r)}getNumber(t){const e=this.get(t);if(null===e)return null;const s=Number(e);return isNaN(s)?null:s}getPrompt(){return this.get("PS1")??"$ "}get color(){return this.has("TERM")}_ignore=new Set(["USER","LOGNAME","HOME","LANG","_"])}var f=s(7095),p=s(3482);class g{add(t){this._current=null,!t.trim()||this._ignoreInitialWhitespace&&t.startsWith(" ")||this._ignoreDuplicates&&t===this.at(-1)||(this._history.length>=this._maxSize&&this._history.shift(),this._history.push(t))}at(t){return this._history.at(t)??null}clear(){this._current=null,this._history=[]}scrollCurrent(t){return this._current=t?null===this._current?null:this._current+1:null===this._current?this._history.length-1:this._current-1,null!==this._current&&(this._current<0?this._current=0:this._current>=this._history.length&&(this._current=null)),null===this._current?null:this.at(this._current)}setMaxSize(t){this._maxSize=Math.max(t,0),this._history.length>this._maxSize&&(this._current=null,this._history=this._history.slice(this._maxSize))}write(t){for(let e=0;e<this._history.length;e++){const s=String(e).padStart(5," ");t.write(`${s}  ${this._history[e]}\n`)}}_history=[];_current=null;_ignoreInitialWhitespace=!0;_ignoreDuplicates=!0;_maxSize=1e3}var w=s(7703),y=s(8316),C=s(4207),S=s(5981),x=s(2958),k=s(312),b=s(2251),v=s(7497),I=s(3291);class O{module;constructor(t){this.module=t}get moduleName(){return this.module.moduleName}names(){return this.module.names}get packageName(){return this.module.packageName}}var N=s(1203);class A extends O{module;constructor(t){super(t),this.module=t}async run(t,e){const s=this.module.loader.getJavaScriptModule(this.packageName,this.moduleName);if(void 0===s)throw new f.xZ(t);if(!Object.prototype.hasOwnProperty.call(s,"run"))throw new f.C2(t);const{args:r,environment:n,fileSystem:i,stdout:o,stderr:a}=e,l={name:t,args:r,environment:n,fileSystem:i,stdin:new N._(e.stdin),stdout:o,stderr:a};try{return await s.run(l)}catch(e){throw console.error(`JavascriptCommandRunner: ${e}`),new f.T6(t)}}}class E extends O{module;constructor(t){super(t),this.module=t}async run(t,e){const{args:s,workerIO:r,fileSystem:n,stdin:i,stdout:o,stderr:a}=e,{wasmBaseUrl:l}=this.module.loader,h=Date.now(),c=this.module.loader.getWasmModule(this.packageName,this.moduleName);if(void 0===c)throw new f.xZ(t);function u(t){const{termios:e}=r;return e.log("Termios get"),e.clone()}function d(t,e,s){return r.setTermios(s),0}function m(t){return[e.environment.getNumber("LINES")??24,e.environment.getNumber("COLUMNS")??80]}function _(t,e){return r.poll(e)}function g(t,e,s,r,n){if(0===r)return 0;let o=i.read(r);return 1===o.length&&4===o[0]&&(o=[]),e.set(o,s),o.length}function w(e,n,i,l,h){if(0===l)return 0;const c=n.slice(i,i+l),u=r.utf8ArrayToString(c),d="/dev/tty1"===e.path;return d&&"touch"===t&&s.length>1||(d?a:o).write(u),l}let y;function C(t){void 0===y&&(y=t)}const S=await c({thisProgram:t,arguments:s,locateFile:t=>(0,I.oq)(l,this.packageName+"/"+t),onExit:t=>C(t),quit:(t,e)=>C(t),preRun:[t=>{if(Object.prototype.hasOwnProperty.call(t,"FS")){const e=t.FS,{mountpoint:s}=n;e.mkdir(s,511),e.mount(n.PROXYFS,{root:s,fs:n.FS},s),e.chdir(n.FS.cwd())}Object.prototype.hasOwnProperty.call(t,"ENV")&&e.environment.copyIntoCommand(t.ENV,o.supportsAnsiEscapes()),Object.prototype.hasOwnProperty.call(t,"TTY")&&(t.TTY.default_tty_ops.ioctl_tcgets=u,t.TTY.default_tty_ops.ioctl_tcsets=d,t.TTY.default_tty_ops.ioctl_tiocgwinsz=m,t.TTY.stream_ops.poll=_,t.TTY.stream_ops.read=g,t.TTY.stream_ops.write=w)}]});if(void 0===y)y=p.y.CANNOT_RUN_COMMAND;else{if(Object.prototype.hasOwnProperty.call(S,"FS")){const t=S.FS;for(const e of[t.streams[1],t.streams[2]])null===e||t.isClosed(e)||t.close(e)}Object.prototype.hasOwnProperty.call(S,"getEnvStrings")&&e.environment.copyFromCommand(S.getEnvStrings())}const x=Date.now();return console.log(`Cockle ${t} load and run time ${x-h} ms`),y}}class R{commandModuleLoader;name;commands;packageName;wasm;constructor(t,e,s,r,n){this.commandModuleLoader=t,this.name=e,this.commands=s,this.packageName=r,this.wasm=n}get loader(){return this.commandModuleLoader}get runner(){return void 0===this._runner&&(this._runner=this.wasm?new E(this):new A(this)),this._runner}get moduleName(){return this.name}get names(){return this.commands}_runner}class B{get(t,e){const s=this.key(t,e);return this._cache.get(s)??void 0}has(t,e){const s=this.key(t,e);return this._cache.has(s)}key(t,e){return[t,e].join("/")}set(t,e,s){const r=this.key(t,e);this._cache.set(r,s)}_cache=new Map}class M{wasmBaseUrl;downloadModuleCallback;constructor(t,e){this.wasmBaseUrl=t,this.downloadModuleCallback=e}getJavaScriptModule(t,e){const s=this._getModule(t,e,!1);return void 0!==s?s:void 0}getWasmModule(t,e){const s=this._getModule(t,e,!0);return void 0!==s?s:void 0}_getModule(t,e,s){let r=this.cache.get(t,e);if(void 0===r){const n=this.cache.key(t,e)+".js",i=(0,I.oq)(this.wasmBaseUrl,n);console.log(`Cockle loading ${s?"WebAssembly":"JavaScript"} module from ${i}`),this.downloadModuleCallback(t,e,!0);try{importScripts(i),r=self.Module}finally{this.downloadModuleCallback(t,e,!1)}void 0!==r&&this.cache.set(t,e,r)}return r}cache=new B}class L{name;version;build_string;channel;platform;wasm;modules;constructor(t,e,s,r,n,i,o){this.name=t,this.version=e,this.build_string=s,this.channel=r,this.platform=n,this.wasm=i,this.modules=o}}class W{name;callExternalCommand;constructor(t,e){this.name=t,this.callExternalCommand=e}get moduleName(){return"<external>"}names(){return[this.name]}get packageName(){return""}async run(t,e){if(t!==this.name)throw new f.xZ(t);const{args:s,environment:r,stdin:n,stdout:i,stderr:o}=e,{exitCode:a,environmentChanges:l}=await this.callExternalCommand(this.name,s,Object.fromEntries(r),n.isTerminal(),i.supportsAnsiEscapes(),o.supportsAnsiEscapes());return void 0!==l&&Object.entries(l).forEach((([t,e])=>{void 0===e?r.delete(t):r.set(t,e)})),a}}class T{get moduleName(){return"<builtin>"}get packageName(){return""}names(){return[this.name]}run(t,e){if(t!==this.name)throw new f.xZ(t);return this._run(e)}}class ${shortName;longName;description;constructor(t,e,s){this.shortName=t,this.longName=e,this.description=s}get isSet(){return this._isSet}get name(){return this.shortName?this.shortName:this.longName}get prefixedName(){return this.shortName?`-${this.shortName}`:`--${this.longName}`}parse(t,e){return this.set(),e}set(){this._isSet=!0}_isSet=!1}class F extends ${constructor(t,e,s){super(t,e,s)}}class D extends F{constructor(t,e,s){super(t,e,s)}get string(){return this._string}parse(t,e){return this.set(),e.length>0&&!e[0].startsWith("-")&&(this._string=e.shift()),e}_string}class Q extends ${minCount;constructor(t=1){if(super("","",""),this.minCount=t,t<0)throw new f.$g("Negative minCount in TrailingStringsOption.constructor")}get length(){return this._strings.length}parse(t,e){this._strings.push(t),this.set();for(const t of e){if(t.startsWith("-"))throw new f.$g("Cannot have named option after parsing a trailing path");this._strings.push(t)}return[]}get strings(){return this._strings}_strings=[]}class P{parse(t){let e=t.slice();const s=this._getStrings();for(;e.length>0;){const t=e.shift();if(t.startsWith("-")&&t.length>1)if(t.startsWith("--")){const s=t.slice(2);e=this._findByLongName(s).parse(t,e)}else{const s=t.slice(1);e=this._findByShortName(s).parse(t,e)}else{if(null===s)throw new f.$g(`Unrecognised option: '${t}'`);e=s.parse(t,e)}}if(s&&s.length<s.minCount)throw new f.$g("Insufficient trailing strings options specified");return this}writeHelp(t){for(const e of this._help())t.write(`${e}\n`)}_findByLongName(t){let e;for(e of Object.values(this))if(e.longName===t)return e;throw new f.$g(`No such longName option '${t}'`)}_findByShortName(t){let e;for(e of Object.values(this))if(e.shortName===t)return e;throw new f.$g(`No such shortName option '${t}'`)}_getStrings(){return"trailingStrings"in this?this.trailingStrings:null}_help(){return[...Object.values(this)].sort(((t,e)=>t.name>e.name?1:-1)).map((t=>{const e=t.prefixedName,s=Math.max(1,12-e.length);return`    ${e}${" ".repeat(s)}${t.description}`}))}}class U extends P{trailingStrings=new Q(0)}class j extends T{get name(){return"alias"}async _run(t){const{aliases:e,args:s,stdout:r}=t,n=(new U).parse(s);if(n.trailingStrings.isSet)for(const t of n.trailingStrings.strings){const s=t.indexOf("=");-1===s?r.write(`${t}='${e.get(t)}'\n`):e.set(t.slice(0,s),t.slice(s+1))}else for(const[t,s]of e.entries())r.write(`${t}='${s}'\n`);return p.y.SUCCESS}}class H extends P{trailingStrings=new Q(0)}class q extends T{get name(){return"cd"}async _run(t){const{args:e}=t,s=(new H).parse(e).trailingStrings.strings;if(s.length<1)return p.y.SUCCESS;if(s.length>1)throw new f.$g("cd: too many arguments");let r=s[0];if("-"===r){const e=t.environment.get("OLDPWD");if(void 0===e)throw new f.$g("cd: OLDPWD not set");r=e,t.stdout.write(`${r}\n`)}const{FS:n}=t.fileSystem,i=n.cwd();return n.chdir(r),t.environment.set("OLDPWD",i),t.environment.set("PWD",n.cwd()),p.y.SUCCESS}}class X extends T{get name(){return"clear"}async _run(t){const{stdout:e}=t;return e.supportsAnsiEscapes()&&e.write(m.Q.eraseScreen+m.Q.eraseSavedLines+m.Q.cursorHome),p.y.SUCCESS}}var Y=s(585),z=s(3694);class G extends P{version=new F("v","version","show cockle version");stdin=new D("s","stdin","synchronous stdin configuration");package=new D("p","package","show package information");module=new D("m","module","show module information");command=new D("c","command","show command information");help=new F("h","help","display this help and exit")}class J extends T{get name(){return"cockle-config"}async _run(t){const{args:e,environment:s,stdout:r}=t,n=(new G).parse(e);if(n.help.isSet)return n.writeHelp(r),p.y.SUCCESS;const i=r.supportsAnsiEscapes()&&s.color?Y.Ju.defaultColorByColumn():void 0,o=0===e.length;return(o||n.version.isSet)&&this._writeVersion(t),(o||n.stdin.isSet)&&this._writeOrSetSyncStdinConfig(t,i,n.stdin.string),(o||n.package.isSet)&&this._writePackageConfig(t,i,n.package.string),(o||n.module.isSet)&&this._writeModuleConfig(t,i,n.module.string),n.command.isSet&&this._writeCommandConfig(t,i,n.command.string),p.y.SUCCESS}_writeCommandConfig(t,e,s){const{commandRegistry:r,stdout:n}=t,i=void 0===s?r.allCommands():[s],o=new Y.Ju({colorByColumn:e,sortByColumn:[0]});o.addHeaderRow(["command","module"]);for(const t of i){const e=r.get(t);if(null===e)throw new f.$g(`Unknown command '${t}'`);o.addRow([t,e.moduleName])}o.write(n)}_writeModuleConfig(t,e,s){const{commandRegistry:r,commandModuleCache:n,stdout:i}=t;let o=r.allModules();if(void 0!==s&&(o=o.filter((t=>t.name===s)),0===o.length))throw new f.$g(`Unknown module '${s}'`);const a=new Y.Ju({colorByColumn:e,sortByColumn:[0,1]});a.addHeaderRow(["module","package","cached"]);for(const t of o)a.addRow([t.name,t.packageName,n.has(t.packageName,t.name)?"yes":""]);a.write(i)}_writeOrSetSyncStdinConfig(t,e,s){const{stdinContext:r,stdout:n}=t;void 0!==s&&r.setEnabled(s);const i=new Y.Ju({colorByColumn:e});i.addHeaderRow(["synchronous stdin","short name","available","enabled"]);const{enabled:o,shortNames:a}=r;for(const t of a)i.addRow([r.longName(t),t,r.available(t)?"yes":"",o===t?"yes":""]);i.write(n)}_writePackageConfig(t,e,s){const{commandRegistry:r,stdout:n}=t;let i=[...r.commandPackageMap.values()];if(void 0!==s&&(i=i.filter((t=>t.name===s)),0===i.length))throw new f.$g(`Unknown package '${s}'`);const o=new Y.Ju({colorByColumn:e,sortByColumn:[0]});o.addHeaderRow(["synchronous stdin","short name","available","enabled"]);for(const t of i)o.addRow([t.name,t.wasm?"wasm":"js",t.version,t.build_string,t.channel]);o.write(n)}_writeVersion(t){const{stdout:e}=t;e.write(`cockle ${z.Z}\n`)}}class Z extends T{get name(){return"exit"}async _run(t){const{stdout:e,terminate:s}=t;return e.write("Terminating shell...\n"),e.flush(),s(),p.y.SUCCESS}}class K extends P{trailingStrings=new Q(0)}class V extends T{get name(){return"export"}async _run(t){const{args:e,environment:s}=t,r=(new K).parse(e);if(r.trailingStrings.isSet)for(const t of r.trailingStrings.strings){const e=t.indexOf("=");if(e>0){const r=t.slice(0,e),n=t.slice(e+1);s.set(r,n)}}return p.y.SUCCESS}}class tt extends P{clear=new F("c","","clear the history by deleting all of the entries");help=new F("","help","display this help and exit")}class et extends T{get name(){return"history"}async _run(t){const{args:e,history:s,stdout:r}=t,n=(new tt).parse(e);return n.help.isSet?n.writeHelp(r):n.clear.isSet?s.clear():s.write(r),p.y.SUCCESS}}class st{callExternalCommand;constructor(t){this.callExternalCommand=t,this.registerBuiltinCommands(r)}allCommands(){const t=Array.from(this._map.keys());return t.sort(),t}allModules(){const t=[];for(const e of this.commandPackageMap.values())t.push(...e.modules);return t.sort(((t,e)=>t.name<e.name?-1:1)),t}get(t){return this._map.get(t)??null}match(t){return[...this._map.keys()].filter((e=>e.startsWith(t))).sort()}registerBuiltinCommands(t){for(const[e,s]of Object.entries(t))if(e.endsWith("Command")&&!e.startsWith("Builtin"))try{const t=new s;t instanceof T&&this._register(t)}catch{}}registerCommandPackage(t){this.commandPackageMap.set(t.name,t);for(const e of t.modules)this._register(e.runner)}registerExternalCommand(t){this._map.set(t,new W(t,this.callExternalCommand))}_register(t){for(const e of t.names())this._map.set(e,t)}_map=new Map;commandPackageMap=new Map}class rt{constructor(t){this._options=t,this._commandModuleLoader=new M(t.wasmBaseUrl,t.downloadModuleCallback),this._fileSystem={FS:void 0,PATH:void 0,ERRNO_CODES:void 0,PROXYFS:void 0,mountpoint:t.mountpoint??"/drive"},this._context={args:[],fileSystem:this._fileSystem,aliases:new d.D,commandRegistry:new st(t.callExternalCommand),environment:new _(t.color),history:new g,terminate:this.terminate.bind(this),stdin:this._dummyInput,stdout:this._dummyOutput,stderr:this._dummyOutput,workerIO:t.workerIO,commandModuleCache:this._commandModuleLoader.cache,stdinContext:t.stdinContext},Object.entries(t.aliases).forEach((([t,e])=>this._context.aliases.set(t,e))),Object.entries(t.environment).forEach((([t,e])=>{void 0===e?this._context.environment.delete(t):this._context.environment.set(t,e)})),t.externalCommandNames.forEach((t=>this._context.commandRegistry.registerExternalCommand(t))),this._stderr=new w.m(this.output.bind(this),this._options.color?m.Q.styleRed:void 0,this._options.color?m.Q.styleReset:void 0)}get aliases(){return this._context.aliases}get environment(){return this._context.environment}async externalInput(t){const e=await this._context.stdin.readAsync(t);return String.fromCharCode(...e)}externalOutput(t,e){(e?this._context.stderr:this._context.stdout).write(t)}get history(){return this._context.history}async initialize(){await this._initWasmPackages(),await this._initFileSystem()}async input(t){if(this._isRunning)switch(t.charCodeAt(0)){case 13:{this.output("\n");const t=this._currentLine;this._currentLine="",this._cursorIndex=0,await this._runCommands(t),await this._outputPrompt();break}case 127:if(this._cursorIndex>0){const t=this._currentLine.slice(this._cursorIndex);this._currentLine=this._currentLine.slice(0,this._cursorIndex-1)+t,this._cursorIndex--,this.output(m.Q.cursorLeft(1)+t+m.Q.eraseEndLine+m.Q.cursorLeft(t.length))}break;case 9:await this._tabComplete();break;case 27:this._escapedInput(t);break;case 4:break;default:if(this._cursorIndex===this._currentLine.length)this._currentLine+=t,this.output(t);else{const e=this._currentLine.slice(this._cursorIndex);this._currentLine=this._currentLine.slice(0,this._cursorIndex)+t+e,this.output(m.Q.eraseEndLine+t+e+m.Q.cursorLeft(e.length))}this._cursorIndex++}}output(t){this._isRunning&&this._context.workerIO.write(t)}async setSize(t,e){const{environment:s}=this;if(t>=1){const e=t.toString();s.set("LINES",e),s.set("LESS_LINES",e)}else s.delete("LINES"),s.delete("LESS_LINES");if(e>=1){const t=e.toString();s.set("COLUMNS",t),s.set("LESS_COLUMNS",t)}else s.delete("COLUMNS"),s.delete("LESS_COLUMNS")}setWorkerIO(t){this._context.workerIO=t}async start(){this._isRunning=!0,await this._outputPrompt()}terminate(){console.log("Cockle ShellImpl.terminate"),this._isRunning=!1,this._options.terminateCallback()}async themeChange(){this._context.workerIO.enabled?this._pendingThemeChange=!0:await this._handleThemeChange()}async _escapedInput(t){const e=t.slice(1);switch(e){case"[A":case"[1A":case"[B":case"[1B":{const t=this.history.scrollCurrent(e.endsWith("B"));this._currentLine=null!==t?t:"",this._cursorIndex=this._currentLine.length,this.output(m.Q.eraseStartLine+`\r${this.environment.getPrompt()}${this._currentLine}`);break}case"[D":case"[1D":this._cursorIndex>0&&(this._cursorIndex--,this.output(m.Q.cursorLeft()));break;case"[C":case"[1C":this._cursorIndex<this._currentLine.length&&(this._cursorIndex++,this.output(m.Q.cursorRight()));break;case"[3~":if(this._cursorIndex<this._currentLine.length){const t=this._currentLine.slice(this._cursorIndex+1);this._currentLine=this._currentLine.slice(0,this._cursorIndex)+t,this.output(m.Q.eraseEndLine+t+m.Q.cursorLeft(t.length))}break;case"[H":case"[1;2H":this._cursorIndex>0&&(this.output(m.Q.cursorLeft(this._cursorIndex)),this._cursorIndex=0);break;case"[F":case"[1;2F":{const{length:t}=this._currentLine;this._cursorIndex<t&&(this.output(m.Q.cursorRight(t-this._cursorIndex)),this._cursorIndex=t);break}case"[1;2D":case"[1;5D":if(this._cursorIndex>0){const t=this._currentLine.slice(0,this._cursorIndex).trimEnd().lastIndexOf(" ")+1;this.output(m.Q.cursorLeft(this._cursorIndex-t)),this._cursorIndex=t}break;case"[1;2C":case"[1;5C":{const{length:t}=this._currentLine;if(this._cursorIndex<t-1){const e=this._currentLine.slice(this._cursorIndex),s=e.trimStart(),r=s.indexOf(" "),n=r<0?t:this._cursorIndex+e.length-s.length+r;this.output(m.Q.cursorRight(n-this._cursorIndex)),this._cursorIndex=n}break}}}_filenameExpansion(t){let e=[],s=0;for(const r of t){if(r.startsWith("-")){s++,e.push(r);continue}if(!r.includes("*")&&!r.includes("?")){e.push(r);continue}const{FS:t}=this._context.fileSystem,n=t.analyzePath(r,!1);if(!n.parentExists){e.push(r);continue}const i=n.parentPath;let o=i;const a=t.cwd();o.startsWith(a)&&(o=o.slice(a.length),o.startsWith("/")&&(o=o.slice(1)));let l=t.readdir(i),h=n.name.replace(/[.+^${}()|[\]\\]/g,"\\$&");h=h.replaceAll("*",".*"),h=h.replaceAll("?",".");const c=new RegExp(`^${h}$`);l=l.filter((t=>t.match(c))),l=l.filter((t=>!t.startsWith("."))),o.length>0&&(l=l.map((t=>o+"/"+t))),e=e.concat(l)}return e.length===s&&(e=t),e}async _handleThemeChange(){await this._options.enableBufferedStdinCallback(!0);const{workerIO:t}=this._options;t.termios.setRawMode(),this.output("]11;?");const e=await t.readAsync(null,100);t.termios.setDefaultShell(),await this._options.enableBufferedStdinCallback(!1),this._pendingThemeChange=!1;const s=String.fromCharCode(...e),r=/^\x1b]11;rgb:([0-9A-Fa-f]{2,})\/([0-9A-Fa-f]{2,})\/([0-9A-Fa-f]{2,})\x1b\\$/.exec(s);if(r){const t=(parseInt(r[1].slice(0,2),16)/255+parseInt(r[2].slice(0,2),16)/255+parseInt(r[3].slice(0,2),16)/255)/3;this._setDarkMode(t<.6)}else console.warn("Unable to determine terminal background color"),this._setDarkMode(void 0)}async _initFileSystem(){const{wasmBaseUrl:t}=this._options,e=this._commandModuleLoader.getWasmModule("cockle_fs","fs");if(void 0===e)return void console.error("Unable to load cockle_fs, shell cannot function");const s=await e({locateFile:e=>(0,I.oq)(t,"cockle_fs/"+e)}),{FS:r,PATH:n,ERRNO_CODES:i,PROXYFS:o}=s,a=this._fileSystem.mountpoint;r.mkdirTree(a,511),this._context.fileSystem.FS=r,this._context.fileSystem.PATH=n,this._context.fileSystem.ERRNO_CODES=i,this._context.fileSystem.PROXYFS=o;const{browsingContextId:l,baseUrl:h,initialDirectories:c,initialFiles:u}=this._options;this._options.initDriveFSCallback({browsingContextId:l,baseUrl:h,fileSystem:this._context.fileSystem,mountpoint:a}),r.chdir(a),this.environment.set("PWD",r.cwd()),c&&c.forEach((t=>r.mkdir(t,509))),u&&Object.entries(u).forEach((([t,e])=>r.writeFile(t,e,{mode:436})))}async _initWasmPackages(){const t=(0,I.oq)(this._options.wasmBaseUrl,"cockle-config.json"),e=await fetch(t);e.ok||console.error(`Failed to fetch ${t}, terminal cannot function without it`);const s=await e.json(),r=Object.keys(s.packages),n="cockle_fs";r.includes(n)||console.error(`cockle-config.json does not include required package '${n}'`);for(const t of r){const e=s.packages[t],r=Object.entries(e.modules).map((([s,r])=>new R(this._commandModuleLoader,s,r.commands?r.commands.split(","):[],t,e.wasm))),n=new L(t,e.version,e.build_string,e.channel,e.platform,e.wasm,r);this._context.commandRegistry.registerCommandPackage(n)}if(Object.hasOwn(s,"aliases"))for(const[t,e]of Object.entries(s.aliases)){const s=e;s.length>0&&this.aliases.set(t,s)}}async _outputPrompt(){this._isRunning&&(this._pendingThemeChange&&await this._handleThemeChange(),this._context.workerIO.write(`\n${this.environment.getPrompt()}`))}async _runCommands(t){if(t.startsWith("!")){const e=parseInt(t.slice(1)),s=this.history.at(e);if(null===s){let t="!"+e+": event not found";return this._options.color&&(t=m.Q.styleBoldRed+t+m.Q.styleReset),this.output(`${t}\n`),void await this._outputPrompt()}t=s}let e;await this._options.enableBufferedStdinCallback(!0),this._context.workerIO.termios.setDefaultWasm(),this.history.add(t);const s=new y.d(this._stdinCallback.bind(this),this._stdinAsyncCallback.bind(this)),r=new w.m(this.output.bind(this)),n=this._stderr;try{const i=(0,v.qg)(t,!0,this.aliases);for(const t of i)if(t instanceof v.Sv)e=await this._runCommand(t,s,r,n);else{if(!(t instanceof v.Ru))throw new f.$g(`Expected CommandNode or PipeNode not ${t}`);{const{commands:e}=t,i=e.length;let o;for(let t=0;t<i;t++){const a=0===t?s:o.input,l=t<i-1?o=new C.n:r;await this._runCommand(e[t],a,l,n)}}}}catch(t){t instanceof f.Ge&&(e=t.exitCode),n.write(t+"\n"),n.flush()}finally{e=e??p.y.GENERAL_ERROR,this.environment.set("?",`${e}`),this._context.workerIO.termios.setDefaultShell(),await this._options.enableBufferedStdinCallback(!1)}}async _runCommand(t,e,s,r){const n=t.name.value,i=this._context.commandRegistry.get(n);if(null===i)throw new f.xZ(n);if(t.redirects){if(t.redirects.length>1)throw new f.$g("Only implemented a single redirect per command");const r=t.redirects[0],n=r.token.value,i=r.target.value;if(">"===n||">>"===n)s=new S.M(this._context.fileSystem,i,">>"===n);else{if("<"!==n)throw new f.$g("Unrecognised redirect "+n);e=new x.z(this._context.fileSystem,i)}}let o=t.suffix.map((t=>t.value));o=this._filenameExpansion(o),this._context.args=o,this._context.stdin=e,this._context.stdout=s,this._context.stderr=r;let a=-1;try{a=await i.run(n,this._context)}finally{r.flush(),s.flush(),this._context.args=[],this._context.stdin=this._dummyInput,this._context.stdout=this._dummyOutput,this._context.stderr=this._dummyOutput}return a}_setDarkMode(t){if(t!==this._darkMode&&(this._darkMode=t,this._options.color)){this._stderr.prefix=t?m.Q.styleBrightRed:m.Q.styleRed;const e=t?m.Q.styleBoldGreen:m.Q.styleGreen;this._context.environment.set("PS1",e+"js-shell:"+m.Q.styleReset+" ")}}_stdinCallback(t){return this._context.workerIO.read(t)}async _stdinAsyncCallback(t){return await this._context.workerIO.readAsync(t,0)}async _tabComplete(){const t=this._currentLine.slice(0,this._cursorIndex);if(t.endsWith(" ")&&t.trim().length>0)return;const e=this._currentLine.slice(this._cursorIndex),s=(0,v.qg)(t,!1),[r,n]=s.length>0?s[s.length-1].lastToken():[null,!0];let i=r?.value??"",o=[];if(n){const t=this._context.commandRegistry.match(i),e=this.aliases.match(i);o=[...new Set([...t,...e])].sort()}else{const{FS:t}=this._context.fileSystem,e=t.analyzePath(i,!1);if(!e.parentExists)return;const s=i;i=e.name;const{exists:r}=e;if(r&&!t.isDir(t.stat(e.path,!1).mode))o=[i];else{const n=r?e.path:e.parentPath;o=t.readdir(n),r?"."===s||".."===s||s.endsWith("/.")||s.endsWith("/..")?o=o.filter((t=>t.startsWith("."))):(o=o.filter((t=>!t.startsWith("."))),s.endsWith("/")||(this._currentLine+="/")):o=o.filter((t=>t.startsWith(i))),o=o.map((e=>t.isDir(t.stat(n+"/"+e,!1).mode)?e+"/":e))}}if(1===o.length){let t=o[0].slice(i.length);t.endsWith("/")||(t+=" "),this._currentLine=this._currentLine.slice(0,this._cursorIndex)+t+e,this._cursorIndex+=t.length,this.output(t+e+m.Q.cursorLeft(e.length))}else if(o.length>1){const t=(0,I.Il)(o,i.length);if(t.length>i.length){const s=t.slice(i.length);this._currentLine=this._currentLine.slice(0,this._cursorIndex)+s+e,this._cursorIndex+=s.length,this.output(s+e+m.Q.cursorLeft(e.length))}else{const t=`\n${(0,I.tp)(o,this.environment.getNumber("COLUMNS")??0).join("\n")}\n${this.environment.getPrompt()}${this._currentLine}`;this.output(t+m.Q.cursorLeft(e.length))}}}_currentLine="";_cursorIndex=0;_darkMode;_isRunning=!1;_pendingThemeChange=!0;_commandModuleLoader;_context;_dummyInput=new k.X;_dummyOutput=new b.y;_fileSystem;_options;_stderr}class nt{async initialize(t,e,s,r,n,i,o){if(this._stdinContext=new u(i,this._setWorkerIO.bind(this)),t.supportsServiceWorker&&(this._serviceWorkerWorkerIO=new l(n,t.baseUrl??"",t.browsingContextId??"",t.shellId),this._stdinContext.setAvailable("sw",!0)),void 0!==t.sharedArrayBuffer&&(this._sharedArrayBufferWorkerIO=new c(t.sharedArrayBuffer,n),this._stdinContext.setAvailable("sab",!0)),this._workerIO=this._sharedArrayBufferWorkerIO??this._serviceWorkerWorkerIO,void 0===this._workerIO)throw new Error("ABORT: does not support SharedArrayBuffer or ServiceWorker!");this._stdinContext.setEnabled(this._workerIO===this._sharedArrayBufferWorkerIO?"sab":"sw"),this._downloadModuleCallback=s,this._enableBufferedStdinCallback=r,this._terminateCallback=o,this._shellImpl=new rt({shellId:t.shellId,color:t.color,mountpoint:t.mountpoint,baseUrl:t.baseUrl,wasmBaseUrl:t.wasmBaseUrl,browsingContextId:t.browsingContextId,aliases:t.aliases,environment:t.environment,externalCommandNames:t.externalCommandNames,initialDirectories:t.initialDirectories,initialFiles:t.initialFiles,callExternalCommand:e,downloadModuleCallback:this._downloadModuleCallback.bind(this),enableBufferedStdinCallback:this.enableBufferedStdin.bind(this),initDriveFSCallback:this.initDriveFS.bind(this),terminateCallback:this._terminateCallback.bind(this),workerIO:this._workerIO,stdinContext:this._stdinContext}),await this._shellImpl.initialize()}async enableBufferedStdin(t){t?(await(this._workerIO?.canEnable()),this._enableBufferedStdinCallback&&await this._enableBufferedStdinCallback(!0),await(this._workerIO?.enable())):(await(this._workerIO?.disable()),this._enableBufferedStdinCallback&&await this._enableBufferedStdinCallback(!1))}async externalInput(t){return this._shellImpl.externalInput(t)}externalOutput(t,e){this._shellImpl?.externalOutput(t,e)}async input(t){this._shellImpl&&await this._shellImpl.input(t)}async setSize(t,e){this._shellImpl&&await this._shellImpl.setSize(t,e)}async start(){this._shellImpl&&await this._shellImpl.start()}async themeChange(){await(this._shellImpl?.themeChange())}_setWorkerIO(t){if("sab"===t&&void 0!==this._sharedArrayBufferWorkerIO)this._workerIO=this._sharedArrayBufferWorkerIO;else{if("sw"!==t||void 0===this._serviceWorkerWorkerIO)throw new Error(`Cannot set WorkerIO to '${t}'`);this._workerIO=this._serviceWorkerWorkerIO}this._shellImpl?.setWorkerIO(this._workerIO)}_shellImpl;_downloadModuleCallback;_enableBufferedStdinCallback;_terminateCallback;_stdinContext;_serviceWorkerWorkerIO;_sharedArrayBufferWorkerIO;_workerIO}},3482:(t,e,s)=>{s.d(e,{y:()=>r});const r={SUCCESS:0,GENERAL_ERROR:1,IMPROPER_USE:2,CANNOT_RUN_COMMAND:126,CANNOT_FIND_COMMAND:127}},3694:(t,e,s)=>{s.d(e,{Z:()=>r});const r="0.1.2"},4207:(t,e,s)=>{s.d(e,{n:()=>i});var r=s(5670),n=s(952);class i extends r.j{flush(){}get input(){return new n.J(this)}}},5670:(t,e,s)=>{s.d(e,{j:()=>r});class r{get allContent(){return this.data.join("")}clear(){this.data=[]}supportsAnsiEscapes(){return!1}write(t){this.data.push(t)}data=[]}},5981:(t,e,s)=>{s.d(e,{M:()=>n});var r=s(5670);class n extends r.j{fileSystem;path;append;constructor(t,e,s){super(),this.fileSystem=t,this.path=e,this.append=s}flush(){const{FS:t}=this.fileSystem;let e=this.allContent;if(this.append)try{e=t.readFile(this.path,{encoding:"utf8"})+e}catch(t){}t.writeFile(this.path,e,{mode:436}),this.clear()}}},7095:(t,e,s)=>{s.d(e,{$g:()=>a,C2:()=>o,Ge:()=>n,T6:()=>l,xZ:()=>i});var r=s(3482);class n extends Error{exitCode;constructor(t,e){super(e),this.exitCode=t}}class i extends n{constructor(t){super(r.y.CANNOT_FIND_COMMAND,`'${t}': command not found`)}}class o extends n{constructor(t){super(r.y.CANNOT_FIND_COMMAND,`'${t}': cannot load command`)}}class a extends n{constructor(t){super(r.y.GENERAL_ERROR,t)}}class l extends n{constructor(t){super(r.y.CANNOT_RUN_COMMAND,`'${t}': cannot run command`)}}},7450:(t,e,s)=>{s.d(e,{D:()=>r});class r extends Map{constructor(){super()}getRecursive(t){let e=this.get(t);for(;void 0!==e;){const s=e.split(" ")[0];if(s===t)break;const r=this.get(s);if(void 0===r)return e;e=r+e.slice(s.length),t=s}return e}match(t){return[...this.keys()].filter((e=>e.startsWith(t)))}}},7497:(t,e,s)=>{s.d(e,{Ru:()=>l,Sv:()=>a,qg:()=>c});var r=s(7095),n=s(9685);const i=";&";class o{}class a extends o{name;suffix;redirects;constructor(t,e,s){super(),this.name=t,this.suffix=e,this.redirects=s}lastToken(){return this.redirects&&this.redirects.length>0?this.redirects[this.redirects.length-1].lastToken():this.suffix.length>0?[this.suffix[this.suffix.length-1],!1]:[this.name,!0]}}class l extends o{commands;constructor(t){super(),this.commands=t}lastToken(){return this.commands.length>0?this.commands[this.commands.length-1].lastToken():[null,!1]}}class h extends o{token;target;constructor(t,e){super(),this.token=t,this.target=e}lastToken(){return[this.target,!1]}}function c(t,e=!0,s){const r=(0,n.q)(t,e,s),o=[],a=[];let h=-1;const c=r.length;function d(){1===a.length?o.push(a[0]):a.length>1&&o.push(new l([...a])),a.length=0}for(let t=0;t<c;t++){const e=r[t];h>=0?i.includes(e.value)?(a.push(u(r.slice(h,t))),d(),h=-1):"|"===e.value&&(a.push(u(r.slice(h,t))),h=-1):i.includes(e.value)||(h=t)}return h>=0&&a.push(u(r.slice(h,c))),d(),o}function u(t){let e=t.slice(1);const s=e.findIndex((t=>{return(e=t.value).startsWith(">")||e.startsWith("<");var e}));if(s>=0){if(e.length!==s+2)throw new r.$g("Redirect should be followed by file to redirect to");const n=new h(e[s],e[s+1]);return e=e.slice(0,s),new a(t[0],e,[n])}return new a(t[0],e)}},7703:(t,e,s)=>{s.d(e,{m:()=>r});class r{outputCallback;constructor(t,e,s){this.outputCallback=t,this.prefix=e,this.suffix=s}flush(){}supportsAnsiEscapes(){return!0}write(t){t.length<1||(void 0!==this.prefix&&(t=this.prefix+t),void 0!==this.suffix&&(t+=this.suffix),this.outputCallback(t))}prefix;suffix}},8301:(t,e,s)=>{s.d(e,{F:()=>i});var r,n=s(3291);!function(t){t[t.ASYNC=0]="ASYNC",t[t.SYNC=1]="SYNC"}(r||(r={}));class i{browsingContextId;shellId;constructor(t,e,s){this.browsingContextId=e,this.shellId=s,this._url=(0,n.oq)(t,"api/stdin/terminal")}getStdin(t){try{const{xhr:e,msg:s}=this._prepareStdinRequest(t,r.SYNC);return e.send(s),this._processStdinReply(e.responseText)}catch(t){return console.error(`Failed to request stdin via service worker: ${t}`),""}}async getStdinAsync(t,e=!1){try{const{xhr:s,msg:n}=this._prepareStdinRequest(t,r.ASYNC,e),i=new Promise(((t,e)=>{s.onload=()=>t(s.responseText),s.onerror=()=>e("XHR error")}));return s.send(n),this._processStdinReply(await i)}catch(t){return console.error(`Failed to request stdin via service worker: ${t}`),""}}_prepareStdinRequest(t,e,s=!1){const n=new XMLHttpRequest;n.open("POST",this._url,e===r.ASYNC);const i={shellId:this.shellId,timeoutMs:t};return s&&(i.test=!0),{xhr:n,msg:JSON.stringify({browsingContextId:this.browsingContextId,data:i})}}_processStdinReply(t){const e=JSON.parse(t);if("error"in e)throw new Error(e.error);if(void 0!==e.text)return e.text??"";throw new Error(`Invalid stdin response: ${e}`)}_url}},8316:(t,e,s)=>{s.d(e,{d:()=>r});class r{stdinCallback;stdinAsyncCallback;constructor(t,e){this.stdinCallback=t,this.stdinAsyncCallback=e}isTerminal(){return!0}async readAsync(t){return await this.stdinAsyncCallback(t)}read(t){return this.stdinCallback(t)}}},9399:(t,e,s)=>{s.d(e,{Q:()=>i});const r="[";function n(t){return Math.min(Math.max(Math.round(t),0),255)}const i={cursorUp:(t=1)=>t>0?r+t+"A":"",cursorDown:(t=1)=>t>0?r+t+"B":"",cursorRight:(t=1)=>t>0?r+t+"C":"",cursorLeft:(t=1)=>t>0?r+t+"D":"",cursorHome:"[H",eraseScreen:"[2J",eraseSavedLines:"[3J",eraseEndLine:"[K",eraseStartLine:"[1K",styleRGB:(t,e,s,i=!0)=>`${r}${i?"38":"48"};2;${n(t)};${n(e)};${n(s)}m`,styleReset:"[1;0m",styleBoldRed:"[1;31m",styleBoldGreen:"[1;32m",styleBrightRed:"[0;91m",styleBrightGreen:"[0;92m",styleBrightYellow:"[0;93m",styleBrightBlue:"[0;94m",styleBrightPurple:"[0;95m",styleBrightCyan:"[0;96m",styleRed:"[0;31m",styleGreen:"[0;32m",styleYellow:"[0;33m",styleBlue:"[0;34m",stylePurple:"[0;35m",styleCyan:"[0;36m",showCursor:"[?25h",hideCursor:"[?25l"}},9685:(t,e,s)=>{s.d(e,{q:()=>i});var r,n=s(7095);function i(t,e=!0,s){const r=new o(t,e,s);return r.run(),r.tokens}!function(t){t[t.None=0]="None",t[t.Delimiter=1]="Delimiter",t[t.DoubleQuote=2]="DoubleQuote",t[t.SingleQuote=3]="SingleQuote",t[t.Whitespace=4]="Whitespace",t[t.Other=5]="Other"}(r||(r={}));class o{throwErrors;aliases;constructor(t,e,s){this.throwErrors=e,this.aliases=s,this._source=t,this._tokens=[]}run(){for(;this._index<=this._source.length;)this._next();if(this.throwErrors&&""!==this._endQuote)throw new n.$g("Tokenize error, expected end quote "+this._endQuote)}get tokens(){return this._tokens}_addToken(){const t=this._offset,e=this._value;if(void 0!==this.aliases&&t!==this._aliasOffset&&(0===this._tokens.length||";&|".includes(this._tokens.at(-1).value.at(-1)))){const s=this.aliases.getRecursive(e);if(void 0!==s){const n=e.length;return this._offset=-1,this._index=t-1,this._aliasOffset=t,this._source=this._source.slice(0,t)+s+this._source.slice(t+n),this._prevChar="",this._prevCharType=r.None,this._value="",this._endQuote="",!1}}return this._tokens.push({offset:t,value:e}),this._endQuote="",!0}_getCharType(t){return" ".includes(t)?r.Whitespace:";&|><".includes(t)?r.Delimiter:"'"===t?r.SingleQuote:'"'===t?r.DoubleQuote:r.Other}_endQuoteFromCharType(t){return t===r.DoubleQuote?'"':t===r.SingleQuote?"'":""}_next(){const t=++this._index,e=t<this._source.length?this._source[t]:" ";let s=this._getCharType(e);const n=this._endQuoteFromCharType(s);this._offset>=0?this._endQuote?e!==this._endQuote?this._value+=e:(this._endQuote="",s=r.Other):n?this._endQuote=n:s===r.Whitespace?this._addToken()&&(this._offset=-1):s!==this._prevCharType||s===r.Delimiter&&e!==this._prevChar?this._addToken()&&(this._offset=t,this._value=e):this._value+=e:s!==r.Whitespace&&(this._offset=t,this._endQuote=this._endQuoteFromCharType(s),this._value=""===this._endQuote?e:""),this._prevChar=e,this._prevCharType=s}_source;_tokens;_prevChar="";_prevCharType=r.None;_index=-1;_offset=-1;_aliasOffset=-1;_value="";_endQuote=""}}}]);