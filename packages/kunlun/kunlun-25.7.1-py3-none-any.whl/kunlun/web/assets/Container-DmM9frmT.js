import{Q as N}from"./QPage-DCOQWS8C.js";import{s as x,Q}from"./notify-DEFy15-Q.js";import{a as f,b as p,Q as V}from"./QCard-DDJQvXhW.js";import{Y as w,O as y,Q as h,R as e,_ as m,C as l,T as t,S as B,W as i,ab as r,Z as C,V as o,U as _,ac as q,aa as L,X as b,a2 as D,a3 as E}from"./index-DL8e7wsY.js";import{Q as T}from"./QToolbar-BQDs1kkk.js";import{_ as A,i as v,g as c,Q as d,j as U}from"./_plugin-vue_export-helper-14mw3PxB.js";import{Q as I,d as F}from"./QSelect-DV3X0g7K.js";import{Q as M}from"./QPopupProxy-BFJjx2ms.js";import{Q as R}from"./use-checkbox-CJl3k6cN.js";import{a as W,T as G}from"./QCardActions-C0mXFwg_.js";import{A as J}from"./AskQuestion-BZp6OOVF.js";const j={name:"ContainerPanel",props:["container","mode"],components:{AskQuestion:J},setup(){return{notify:x()}},data:()=>({username:"autotest",dialog:!1,hours:0,minutes:0,seconds:0}),computed:{containerAction(){return this.container.status==="idle"?"Start Test":this.container.status==="run"?"Stop Test":this.container.status==="stop"||this.container.status==="fail"||this.container.status==="pass"?"Deposit Test":"Start Test"},containerIcon(){return this.container.status==="idle"?"play_arrow":this.container.status==="run"?"highlight_off":this.container.status==="stop"||this.container.status==="fail"||this.container.status==="pass"?"delete_forever":"play_arrow"},containerColor(){return this.container.status==="run"?"bg-yellow-4":this.container.status==="idle"?"":this.container.status==="fail"||this.container.status==="stop"?"bg-red-4":this.container.status==="pass"?"bg-green-4":""},modeIcon(){return this.container.mode==="PRODUCT"?"stars":this.container.mode==="DEVELOP"?"bug_report":"stars"},testTime(){return this.container.test_time?(this.calcTimer(),!0):!1}},watch:{},mounted(){},unmounted(){},methods:{calcTimer(){const n=parseInt(this.container.test_time);this.seconds=this.timerFormat(n%60),this.minutes=this.timerFormat(parseInt(n/60,10)%60),this.hours=this.timerFormat(parseInt(n/3600,10))},timerFormat(n){return n?n>9?n:"0"+n:"00"},containerActionClick(){let n="deposit-test";if(this.container.status==="idle"&&(n="start-test"),this.container.status==="run"){if(this.dialog==!1)return this.dialog=!0,!1;this.dialog=!1,n="stop-test",this.$emit("closeQuestion",this.container.name)}this.$api.post(n,{container:this.container.name,mode:this.mode,username:this.username}).then(s=>{this.notify(s.data.message)}).catch(s=>{console.log(s)})}}},X={class:"row"},Y={class:"col-12"},Z=["href"],H={class:"text-h5 text-weight-light text-black"},K=["href"],$={class:"text-h5 text-weight-light text-black"},tt={class:"text-h5 text-weight-light"};function et(n,s,a,P,O,u){const k=w("AskQuestion");return h(),y(p,{class:L("shadow-4 q-ma-xs "+u.containerColor)},{default:e(()=>[m("div",X,[m("div",Y,[a.container.dense?(h(),y(T,{key:0,class:"q-mt-xs",style:{"padding-bottom":"-5px"}},{default:e(()=>[m("a",{href:"#/autotest/"+a.container.name.replace(":","/").toLowerCase()},[m("span",H,i(a.container.name),1)],8,Z),l(m("span",{class:"text-body1 text-weight-light q-ml-md q-mt-xs"},i(n.hours+":"+n.minutes+":"+n.seconds),513),[[r,u.testTime]]),t(Q),l(t(C,{flat:"",round:"",onClick:u.containerActionClick,size:"1.1em",icon:u.containerIcon},{default:e(()=>[t(f,null,{default:e(()=>[o(i(u.containerAction),1)]),_:1})]),_:1},8,["onClick","icon"]),[[r,a.container.starticon]])]),_:1})):(h(),y(T,{key:1,class:"q-mt-xs",style:{"padding-bottom":"-5px"}},{default:e(()=>[m("a",{href:"#/autotest/"+a.container.name.replace(":","/").toLowerCase()},[m("span",$,i(a.container.name),1)],8,K),t(Q),l(t(_,{size:"1.6em",name:u.modeIcon},{default:e(()=>[t(f,null,{default:e(()=>[o(i(a.container.mode)+", by "+i(a.container.starter),1)]),_:1})]),_:1},8,["name"]),[[r,a.container.status!=="idle"]]),l(t(_,{size:"1.6em",name:"sentiment_very_dissatisfied"},{default:e(()=>[t(f,null,{default:e(()=>s[2]||(s[2]=[o("FAIL")])),_:1})]),_:1},512),[[r,a.container.status==="fail"]]),l(t(_,{size:"1.6em",name:"mood_bad"},{default:e(()=>[t(f,null,{default:e(()=>[o("Stopped by "+i(a.container.stopper),1)]),_:1})]),_:1},512),[[r,a.container.status==="stop"]]),l(t(_,{size:"1.6em",name:"phonelink_lock"},{default:e(()=>[t(f,null,{default:e(()=>s[3]||(s[3]=[o("Wait Queue")])),_:1})]),_:1},512),[[r,a.container.queue==="WAIT"]]),l(t(_,{size:"1.6em",name:"screen_lock_portrait"},{default:e(()=>[t(f,null,{default:e(()=>s[4]||(s[4]=[o("In Queue")])),_:1})]),_:1},512),[[r,a.container.queue==="GOT"]]),l(t(_,{size:"1.6em",name:"sync"},{default:e(()=>[t(f,null,{default:e(()=>s[5]||(s[5]=[o("In Sync Up")])),_:1})]),_:1},512),[[r,a.container.sync]]),l(t(_,{size:"1.6em",name:"sync"},{default:e(()=>[t(f,null,{default:e(()=>s[6]||(s[6]=[o("Recycle")])),_:1})]),_:1},512),[[r,a.container.recycle]]),l(t(C,{flat:"",round:"",onClick:u.containerActionClick,size:"1.1em",icon:u.containerIcon},{default:e(()=>[t(f,null,{default:e(()=>[o(i(u.containerAction),1)]),_:1})]),_:1},8,["onClick","icon"]),[[r,a.container.starticon]])]),_:1})),a.container.dense?B("",!0):(h(),y(v,{key:2,separator:"",dense:"",style:{"margin-top":"-12px"},class:"text-body1 text-weight-light"},{default:e(()=>[t(c,null,{default:e(()=>[l(t(d,null,{default:e(()=>[o(i(n.hours+":"+n.minutes+":"+n.seconds),1)]),_:1},512),[[r,u.testTime]])]),_:1}),t(c,null,{default:e(()=>[t(d,null,{default:e(()=>[o(i(a.container.display1),1)]),_:1})]),_:1}),t(c,null,{default:e(()=>[t(d,null,{default:e(()=>[t(I,null,{default:e(()=>[o(i(a.container.display2),1)]),_:1})]),_:1})]),_:1}),t(c,null,{default:e(()=>[t(d,null,{default:e(()=>[t(I,null,{default:e(()=>[o(i(a.container.display0||a.container.display3),1)]),_:1})]),_:1})]),_:1})]),_:1})),t(M,{"context-menu":"",class:"bg-indigo-1"},{default:e(()=>[t(v,{dense:"",bordered:"",separator:""},{default:e(()=>[l((h(),y(c,null,{default:e(()=>[t(d,null,{default:e(()=>[o(i(a.container.name),1)]),_:1})]),_:1})),[[q]]),t(U,{class:"bg-grey"}),l(t(c,null,{default:e(()=>[t(d,null,{default:e(()=>[o(i(a.container.display1),1)]),_:1})]),_:1},512),[[r,a.container.display1]]),l(t(c,null,{default:e(()=>[t(d,null,{default:e(()=>[o(i(a.container.display2),1)]),_:1})]),_:1},512),[[r,a.container.display2]]),l(t(c,null,{default:e(()=>[t(d,null,{default:e(()=>[o(i(a.container.display3),1)]),_:1})]),_:1},512),[[r,a.container.display3]]),l(t(c,null,{default:e(()=>[t(d,null,{default:e(()=>[o(i(a.container.display4),1)]),_:1})]),_:1},512),[[r,a.container.display4]]),l(t(c,null,{default:e(()=>[t(d,null,{default:e(()=>[o(i(a.container.display5),1)]),_:1})]),_:1},512),[[r,a.container.display5]]),l(t(c,null,{default:e(()=>[t(d,null,{default:e(()=>[o(i(a.container.display6),1)]),_:1})]),_:1},512),[[r,a.container.display6]]),l(t(c,null,{default:e(()=>[t(d,null,{default:e(()=>[o(i(a.container.display0),1)]),_:1})]),_:1},512),[[r,a.container.display0]])]),_:1})]),_:1})])]),l(t(R,{value:60,color:"primary",size:"xs"},null,512),[[r,a.container.progress]]),t(F,{modelValue:n.dialog,"onUpdate:modelValue":s[1]||(s[1]=g=>n.dialog=g),persistent:""},{default:e(()=>[t(p,{style:{width:"500px","max-width":"80vw"}},{default:e(()=>[t(V,null,{default:e(()=>[m("span",tt,i(a.container.name)+": "+i(n.$t("dialog.stop")),1)]),_:1}),t(W,null,{default:e(()=>[t(C,{color:"accent",onClick:u.containerActionClick,label:n.$t("dialog.confirm")},null,8,["onClick","label"]),t(Q),t(C,{color:"primary",onClick:s[0]||(s[0]=g=>n.dialog=!1),label:n.$t("dialog.cancel")},null,8,["label"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(k,{container:a.container},null,8,["container"])]),_:1},8,["class"])}const nt=A(j,[["render",et],["__scopeId","data-v-e2d4467c"]]),at={name:"ContainernPage",components:{Panel:nt,ToolBar:G},setup(){return{notify:x()}},data:()=>({url:"",ws:null,timeOuter:null,containerList:[],station:"",containerName:"",version:"",host:"",mode:"PRODUCT"}),computed:{},mounted(){this.url=window.location.hash.substring(1),this.station=this.url.split("/")[2].toUpperCase(),this.getPlatformInfo(),this.getContainerList(),this.initSocket()},unmounted(){this.ws.close(),this.timeOuter&&clearTimeout(this.timeOuter)},methods:{async initSocket(){const n=this.$hostname.replace("http","ws")+"/ws"+this.url.toUpperCase();this.ws=new WebSocket(n),this.ws.onmessage=this.onMessageSocket,this.ws.onerror=this.onErrorSocket,this.ws.onclose=this.onCloseSocket,this.timeOuter&&clearTimeout(this.timeOuter)},onErrorSocket(){this.notify("WS Connection Lost"),this.timeOuter=setTimeout(()=>{this.initSocket()},3e3)},onSendSocket(n){this.ws.send(JSON.stringify(n))},onCloseSocket(){return!1},onMessageSocket(n){const s=JSON.parse(n.data);s.type==="container"&&this.containerList.forEach(function(a){a.name===s.name&&(a.value=s.data)})},async getContainerList(){this.$api.post("get-all-containers",{station:this.station}).then(n=>{this.containerList=n.data.data,this.notify(n.data.message)}).catch(n=>{console.log(n),this.notify("Get Container List meets Errors")})},closeQuestion(n){n===this.containerName&&(this.containerName="")},async getPlatformInfo(){this.$api.post("get-platform-info").then(n=>{this.version=n.data.version,this.host=n.data.host,document.title=this.host+" | "+this.version}).catch(n=>{console.log(n)})},setMode(n){this.mode=n}}},st={class:"row"},it={class:"col-12"};function ot(n,s,a,P,O,u){const k=w("ToolBar"),g=w("Panel");return h(),y(N,null,{default:e(()=>[m("div",st,[m("div",it,[t(k,{onSetMode:u.setMode},null,8,["onSetMode"])]),(h(!0),b(D,null,E(n.containerList,(S,z)=>(h(),b("div",{class:L("col-"+S.value.col),key:z},[t(g,{container:S.value,mode:n.mode,onCloseQuestion:u.closeQuestion},null,8,["container","mode","onCloseQuestion"])],2))),128))])]),_:1})}const Ct=A(at,[["render",ot]]);export{Ct as default};
